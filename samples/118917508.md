# Problems on neat embeddings solved by rainbow constructions and Monk algebras, a survey of results and methods

CorpusID: 118917508
 
tags: #Mathematics

URL: [https://www.semanticscholar.org/paper/28e88cbe7d6855eee42093e7f3bdb36f84a9f6d9](https://www.semanticscholar.org/paper/28e88cbe7d6855eee42093e7f3bdb36f84a9f6d9)
 
| Is Survey?        | Result          |
| ----------------- | --------------- |
| By Classifier     | False |
| By Annotator      | (Not Annotated) |

---

Problems on neat embeddings solved by rainbow constructions and Monk algebras, a survey of results and methods
3 Feb 2015

Tarek Sayed 
Department of Mathematics
Faculty of Science
Cairo University
GizaEgypt

Ahmed 
Department of Mathematics
Faculty of Science
Cairo University
GizaEgypt

Problems on neat embeddings solved by rainbow constructions and Monk algebras, a survey of results and methods
3 Feb 2015
This paper is a survey of recent results and methods in (Tarskian) algebraic logic.We focus on cylindric algebras. Rainbow constructions are used to solve problems on classes consisting of algebras having a neat embedding property substantially generalizing seminal results of Hodkinson as well as Hirsch and Hodkinson on atom-canonicity and complete representations, respectively. For proving non-atom-canonicity of infinitely many varieties approximating the variety of representable algebras of finite dimension > 2, so called blow up and blur constructions are used. Rainbow constructions are compared to constructions using Monk-like algebras and cases where both constructions work are given. Notions of representability, like complete, weak and strong are lifted from atom structures to atomic algebras and investigated in terms of neat embedding properties. The classical results of Monk and Maddux on non-finite axiomatizability of the classes of representable relation and cylindric algebras of finite dimension > 2 are reproved using also a blow up and blur construction. Applications to omitting types for n-variable fragments of first order logic, for 2 < n < ω, are given. The main results of the paper are summarized in tabular form at the end of the paper.

# Introduction


## An overview

The purpose of this paper is to present recent developments from algebraic logic and logic in an integrated format that is accessible to the non-specialist and informative for the practitioner. Using quite sophisticated (relatively recent) techniques from algebraic logic, (like so-called rainbow constructions and games), our intention is to unify, illuminate and generalize several existing results scattered in the literature, hopefully stimulating further research. We focus on Tarskian algebraic logic, specifically cylindric algebras.

We follow the notation of [2] which is in conformity with the notation adopted in the monograph [5]. In particular, CA α denotes the class of cylindric algebras of dimension α, α an ordinal, RCA α denotes the class of representable CA α s and for any ordinal β > α, Nr α CA β denotes the class of all α-neat reducts of CA β s to be defined in a moment. Three cornerstones in the development of the theory of cylindric algebras due to Tarski, Henkin and Monk, respectively -the last two involving the notion of neat reducts -are the following.

Tarski proved that every locally finite infinite dimensional cylindric algebra of dimension ω (Lf ω ) is representable. Henkin [5, Theorem 3. 2. 10] proved what has become to be known as the the neat embedding theorem, which says that for any ordinal α, SNr α CA α+ω = RCA α , where S denotes the operation of forming subalgebras. This generalize's Tarski's representation theorem substantially, because Lf ω SNr ω CA ω+ω . Monk [16] proved that for any ordinal α > 2 and k ∈ ω, SNr α CA α+k = RCA α . In particular, for each finite n > 2, and k ∈ ω, there is an algebra A k ∈ SNr n CA n+k that is not representable. Any non-trivial ultraproduct of such algebras will be in RCA n . Hence, the variety RCA n (2 < n < ω) is not finitely axiomatizable.

The notion of neat reducts and the related one of neat embeddings are both important in algebraic logic for the very simple reason that they are very much tied to the notion of representability, via the neat embedding theorem of Henkin's. Definition 1. 1. Let α < β be ordinals and B ∈ CA β . Then the α-neat reduct of B, in symbols Nr α B, is the algebra obtained from B, by discarding cylindrifiers and diagonal elements whose indices are in β \ α, and restricting the universe to the set N r α B = {x ∈ B : {i ∈ β : c i x = x} ⊆ α}.

If A ∈ CA α and A ⊆ Nr α B, with B ∈ CA β , then we say that A neatly embed in B, and that B is a β-dilation of A, or simply a dilation of A if β is clear from context. We say that A has a neat embedding property and that A has the neat embedding property if β ≥ α+ω. It is known that A has the neat embedding property ⇐⇒ A ∈ SNr α CA α+ω [4, Theorem 2. 6.35] and by Henkin's neat embedding theorem both are equivalent to A ∈ RCA α .

Monk's result was refined by Hirsch and Hodkinson by showing that for finite n ≥ 3 and k ≥ 1, the variety SNr n CA n+k+1 is not even finitely axiomatizable over SNr n CA n+k answering (the famous) [5,Problem 2.12]. This result was lifted to infinite dimensions by Robin Hirsch and the present author [6], addressing other cylindric-like algebras, as well, like Pinter's substitution algebras and Halmos' quasi-polyadic algebras. Such results will be addressed in some detail in §6 and will be strengthened for cylindric algebras and quasipolyadic equality algebras of infinite dimensions. It is known that for 1 < n < β, n finite, the class Nr n CA β is not first order definable, least a variety [19, Theorem 5. 1.4]; this solves [5,Problem 4.4]. We show in theorem 4.3 that it is not even closed under ≡ ∞,ω , but that it is pseudo-elementary, and that its elementary theory is recursively enumerable.

From now on fix 2 < n < ω. Analogous to the aforementioned results, in what follows we prove several results on classes of algebras having a neat embedding property in connection to the algebraic notion of atom-canonicity and the semantical one of complete represenations. A variety V ⊆ CA n is atom-canonical if whenever A ∈ V is atomic, then the complex algebra of its atom structure, in symbols CmAtA, is also in V . In this case CmAtA is the Dedekind-MacNeille completion of A which is the smallest complete algebra containing A as a dense subalgebra meaning that for all non-zero b ∈ CmAtA, there is a non-zero a ∈ A such that a ≤ b.

As the name suggests, complete representability is a semantical notion. A representation of A ∈ CA n is an injective homomorphism f : A → ℘(V ), where V ⊆ n U for some non-empty set U is a disjoint union of cartesian squares, that is V = i∈I n U i , I is a non-empty indexing set, U i = ∅ and U i ∩ U j = ∅ for all i = j; the operations on ℘(V ) are the concrete operations defined like in cylindric set algebras of dimension n relativized to V . A cylindric set algebra having top element such a V is called a generalized set algebra of dimension n. Definition 1. 2. A complete representation of A ∈ CA n is a representation f of A that preserves arbitrary sums carrying them to set-theoretic unions, that is the representation f : A → ℘(V ) is required to satisfy f ( S) = s∈S f (s) for all S ⊆ A such that S exists.

We denote the class of algebras having a complete represenations (briefly the class of completely representable algebras) by CRCA n . Ordinary representations are not necessarily complete. It is known that if an algebra has a complete representation, then it has to be atomic [9]. It is also known that there are countable atomic RCA n s that have no complete representations. So atomicity is necessary but not sufficient for complete representability. The class CRCA n s is not even elementary [12, Corollary 3. 7.1], this can be distilled from the proof of the first item of theorem 4. 3. Nevertheless algebras having countably many atoms in CRCA n can be characterized via special neat embeddings. To specify such 'special' neat embeddings we need:

Let K be a class of algebras having a Boolean reduct. Then S d K denotes the class of dense sublgebras of algebras in K and S c K denotes the class of complete subalgebras of algebras in K.
For A, B ∈ K, we write A ⊆ d B if A is dense in B. A is a complete subalgebra of B, in symbols A ⊆ c B, if A ⊆ B and for all X ⊆ A, A X = 1 =⇒ B X = 1. We have A ⊆ d B =⇒ A ⊆ c B
, but the converse implication ⇐= is not true in general (it is not true for Boolean algebras) . It is known that if A ∈ CA n has countably many atoms then A ∈ CRCA n ⇐⇒ A ∈ S c Nr n CA ω [19, Theorem 5. 3.6] and theorem 4. 1. It is also known that Nr n CA ω S d Nr n CA ω ⊆ S c Nr n CA ω [23]. The last inclusion is proved to be proper below for n = 3, cf. corollary 5. 3. In particular, if A ∈ CA n is atomic with countably many atoms and A ∈ S d Nr n CA ω , then A ∈ CRCA n . Below we show that the countability condition cannot be omitted. There is an atomic A ∈ CA n having uncountably many atoms such that A ∈ Nr n CA ω , but A / ∈ CRCA n . But it can be easily shown (as done below) that such an algebra belongs to the elementary closure of the class CRCA n re-establishing that CRCA n is not elementary. In fact, it will be shown that any atomic algebra in Nr n CA ω satisfies the so-called Lyndon conditions, which are an infinite set of first order sentences ρ k (k ∈ ω); each ρ k encodes a winning strategy in a k-rounded game denoted by G k to be addressed in a moment. It is known, at least implicitly, that this last elementary class, namely, Mod{ρ k : k ∈ ω} coincides with the elementary closure of CRCA n , cf. theorem 5. 4.

Such a semantical notion (of complete representability) is also closely related to the algebraic notion of atom-canonicity of RCA n which is an important persistence property in modal logic, and to the metalogical property of omitting types in finite variable fragments of first order logic [20, Theorems 3.1.1-2, p.211, Theorems 3. 2.8, 9,10], when non-principal types are omitted with respect to usual Tarskian semantics. The typical question is: given a A ∈ CA n and a family (X i : i ∈ I) of meets (I a non-empty set), is there a representation f : A → ℘(V ) that carries this set of meets to set theoretic intersections, in the sense that f ( X i ) = i∈I f (x) for all i ∈ I?

When the algebra A is countable, |I| ≤ ω and X i = 0 for all ∈ I, this is an algebraic version of an omitting types theorem; the representation f omits the given set of meets (or non-principal types). When it is only one meet consisting of co-atoms, in an atomic algebra, such a representation f will a complete one, and this is equivalent to that f ( X) = x∈X f (x) for all X ⊆ A for which X exists in A [9]. The last condition is an algebraic version of of Vaught's theorem for first order logic, namely, the unique (up to isomorphism) atomic, equivalently prime, model of a countable atomic theory omits all non-principal types.

These connections will be further elaborated upon below in §7. It will be shown that the (seemingly purely algebraic) result of non-atom canonicity of SNr n CA n+k for k ≥ 3, proved in theorem 3.1 implies failure of the omitting types theorems for n-variable fragments of first order logic (2 < n < ω), even if we substantially broaden the class of models omitting a given family of non-principal types, considering so-called n + 3-flat models, in place of ordinary models which are ω-flat. In fact, we prove more. We will show that Vaught's theorem (which is a consequence of the omitting types theorem in first order logic) fails in the (strong) sense that there is an atomic L n theory, such that the non-principal type of co-atoms, cannot be omitted in an n + 3-flat model, a fortiori it cannot be omitted in an ordinary (ω-flat) model.

The chapter [12] is devoted to studying various types of atom structures like completely representable atom structures, atom structures satisfying the Lyndon conditions, the strongly representable atom structures, and weakly representable atom structures, all of dimension n. Now one can lift such notions from working on atom structures (the frame level) to working on the (complex) algebra level restricting his attension to atomic ones, and investigate such notions of represenatbility in term of neat embedding properties. We initiate this task in theorem 5.4, which is likely to be rewarding, but by no means do we end it.


## On the techniques used

We continue to fix finite n > 2. We frequently use games as devised by Hirsch and Hodkinson [10,12] played on so-called atomic networks on a cylindric (rainbow) atom structure (to be defined below). The k-rounded 'usual' atomic game (k ≤ ω) played on an atomic A ∈ CA n between ∀ and ∃ is denoted by G k (AtA) [12,Definition 3.3.2]. We devise 'truncated versions' F m , G m ω of the above games. These games have ω rounds, but the number of nodes in networks used during the play is limited to m where 2 < n < m. F m is like G m ω except that F m , ∀ has the bonus to reuse the m nodes in play. When m ≥ ω, these games reduce to the usual ω-rounded atomic game G ω , definition 2. 5. Then the game F m is related to the existence of m-dilations for an algebra A ∈ CA n in the following sense. Assume that 2 < n < m.

(*) If A ∈ S c Nr n CA m =⇒ ∃ has a winning strategy in F m (AtA). If A is finite and A ∈ SNr n CA m =⇒ ∃ has a winning strategy in F m (AtA), cf. lemma 2. 8.

As a sample of the hitherto obtained results:

(1) A finite algebra D ∈ CA n for which ∃ can win F n+3 (AtD), so that by (the contrapositive of the second part of) (*) D / ∈ SNr n CA n+3 , can be embedded into the Dedekind-MacNeille completion of an atomic (infinite) countable A ∈ RCA n . From this, we conclude that the Dedekind-MacNeille completion of A, namely, CmAtA, is outside SNr n CA n+3 , because the last class is a variety hence closed under S and D ⊆ CmAtA.

Since A ∈ SNr n CA n+k for all k ≥ 3 and CmAtA / ∈ SNr n CA n+3 (⊇ SNr n CA n+k , k ≥ 3), we conclude that SNr n CA n+k is not atom-canonical for all k ≥ 3. This is proved in theorem 3.1.

(2) We construct, for any finite n > 2, an atomic algebra C ∈ RCA n with countably many atoms, such that C = CmAtC, for which ∀ can win F n+3 (AtC) but ∃ can win G k (AtC) for all finite k. It follows from (the contrapositive of the first part of) (*) that C / ∈ S c Nr n CA n+3 . Using ultrapowers followed by an elementary chain argument (a standard procedure in such constructions), we get that C is elementary equivalent to a countable completely representable algebra B [12, Corollary 3. 3.5], so that B ∈ S c Nr n CA ω , cf. [19,Theorem 5.3.6] and theorem 4. 1. We conclude that any class K such that S c Nr n CA ω ⊆ K ⊆ S c Nr n CA n+3 , K is not elementary, because A / ∈ K ⊆ S c Nr n CA n+3 , A ≡ B and B ∈ S c Nr n CA ω ⊆ K. This is proved in the first item of theorem 4.3. In the third item of op.cit we replace the S c on the left by S d .

To prove (1) and (2) we use rainbow constructions for cylindric algebras [9,12]. Throughout the paper we use fairly standard notation, which as indicated above, is in conformity with the notation in [2]. Any deviation from such notation will be explicitly mentioned and any possibly unfamiliar notation will be explained at its first occurrence in the text. We assume familiarity with only the (very) basics of cylindric algebra theory. In this respect the paper is fairly self-contained.

We make the following convention which we have adopted so far and will stick to it till the end of the paper. We denote infinite ordinals by α, β . . . and finite ordinals by n, m . . .. Ordinals which are arbitary meaning that they could be finite or infinite will be denoted by α, β . . ..


## Layout

• In §3 after the preliminaries, we show that for any 2 < n < ω and any k ≥ 3, the variety SNr n CA n+k is not atom-canonical.

• In §4 we show that several classes consisting of algebras having a neat embedding property are not first order definable. As a sample, we show that for any finite n > 1, the class Nr n CA ω is not closed under ≡ ∞,ω and that for any 2 < n < ω, any class K, such that S d Nr n CA ω ⊆ K ⊆ S c Nr n CA n+3 , K is not elementary, cf. theorem 4. 3.

• In §5 we lift various notions of representability formulated for atom structures to atomic algebras, and we investigate such notions in terms of neat embeddings, cf. theorem 5. 4.

• In §6 we compare rainbow algebras to Monk-like algebras, and we reprove Monk's celebrated result on non-finite axiomatizability for both representable relation and cylindric algebras of finite dimension > 2, cf. example 6.2. We strengthen the result in [6] for CAs of infinite dimension, cf. theorem 6.3 and we review the main results in [6] in connection to the famous neat embedding problem [4,Problem 2.12] solved by Hirsch and Hodkinson.

• In the last section, we reep the harvest of the algebraic result proved in theorem 3. 1. Together with variations on the flexible construction in [3], omitting types theorems for the clique guarded (finite variable) fragments of first order logic are investigated, cf. theorem 7. 4. The results of Maddux on non-finite axiomatizability (for representable relation and cylindric algebras) refining Monk's results are reproved.


# Preliminaries

Algebras will be denoted by Gothic letters, and when we write A for an algebra, then we shall be tacitly assuming that A denotes its universe, that is A = A, f A i i∈I where I is a non-empty set and f i (i ∈ I) are the operations in the signature of A interpreted via f A i in A. For better readability, we omit the superscript A and we write simply A = A, f i i∈I .


## Atom structures and complex algebras

We recall the notions of atom structures and complex algebra in the framework of Boolean algebras with operators, briefly BAOs, cf. [ 
Definition 2.1. (Atom Structure) Let A = A, +, −, 0, 1, Ω i : i ∈ I be an atomic BAO with non-Boolean operators Ω i : i ∈ I. Let the rank of Ω i be ρ i . The atom structure AtA of A is a relational structure AtA, R Ω i : i ∈ I
where AtA is the set of atoms of A and R Ω i is a (ρ(i) + 1)-ary relation over AtA defined by
R Ω i (a 0 , · · · , a ρ(i) ) ⇐⇒ Ω i (a 1 , · · · , a ρ(i) ) ≥ a 0 .
Definition 2.2. (Complex algebra) Conversely, if we are given an arbitrary first order structure S = S, r i : i ∈ I where r i is a (ρ(i) + 1)-ary relation over S, called an atom structure, we can define its complex algebra
Cm(S) = ℘(S), ∪, \, φ, S, Ω i i∈I ,
where ℘(S) is the power set of S, and Ω i is the ρ(i)-ary operator defined by Ω i (X 1 , · · · , X ρ(i) ) = {s ∈ S : ∃s 1 ∈ X 1 · · · ∃s ρ(i) ∈ X ρ(i) , r i (s, s 1 , · · · , s ρ(i) )}, for each X 1 , · · · , X ρ(i) ∈ ℘(S).

An atom structure will be denoted by At. An atom structure At has the signature of CA α , α an ordinal, if CmAt has the signature of CA α , in which case we say that At is an α-dimensional atom structure. Definition 2. 3. Let V be a variety of CA n s. Then V is atom-canonical if whenever A ∈ V and A is atomic, then CmAtA ∈ V . The Dedekind-MacNeille completion of A ∈ CA n , is the unique (up to isomorphisms that fix A pointwise) complete B ∈ CA n such that A ⊆ B and A is dense in B.

If A ∈ CA n is atomic, then CmAtA is the Dedekind-MacNeille completion of A. If A ∈ CA n , then its atom structure will be denoted by AtA with domain the set of atoms of A denoted by AtA. We deal only with atom structure having the signature of CA n . Non atom-canonicity can be proved by finding weakly representable atom structures that are not strongly representable.
Definition 2.4. Let α be an ordinal. An atom structure At of dimension α is weakly representable if there is an atomic A ∈ RCA α such that AtA = At. The atom structure At is strongly representable if for all A ∈ CA α , AtA = At =⇒ A ∈ RCA α .
Fix 2 < n < ω. Then these two notions (strong and weak representability) do not coincide for cylindric algebras as proved by Hodkinson [13]. This gives that RCA n is not atom-canonical and that RCA n is not closed under Dedekind-MacNeille completions. In theorem 3.1, we generalize Hodkinson's result by showing that there are two atomic CA n s sharing the same atom structure, one is representable and the other is even outside SNr n CA n+3 ( RCA n ). In particular, there is a CA n outside SNr n CA n+3 having a dense representable subalgebra.


## Atomic games

We need the notions of atomic networks and atomic games [10,12]:
Definition 2.5. Fix finite n > 1.
(1) An n-dimensional atomic network on an atomic algebra A ∈ CA n is a map N : n ∆ → AtA, where ∆ is a non-empty set of nodes, denoted by nodes(N ), satisfying the following consistency conditions:

• If x ∈ n nodes(N ), and i < j < n, then
N (x) ≤ d ij ⇐⇒ x i = x j .
• If x, y ∈ n nodes(N ), i < n and x ≡ i y, then N (x) ≤ c i N (y).

Let i < n. For n-ary sequences x and y and n-dimensional atomic networks M and N , we write x ≡ i y ⇐⇒ y(j) = x(j) for all j = i and we write M ≡ i N ⇐⇒ M (y) = N (y) for all y ∈ n (n \ {i}).

(2) Assume that A ∈ CA n is atomic and that m, k ≤ ω. The atomic game G m k (AtA), or simply G m k , is the game played on atomic networks of A using m nodes and having k rounds [12, Definition 3. 3.2], where ∀ is offered only one move, namely, a cylindrifier move:

• Suppose that we are at round t > 0. Then ∀ picks a previously played network N t (nodes(N t ) ⊆ m), i < n, a ∈ AtA, x ∈ n nodes(N t ), such that N t (x) ≤ c i a. For her response, ∃ has to deliver a network M such that nodes(M ) ⊆ m, M ≡ i N , and there is y ∈ n nodes(M ) that satisfies y ≡ i x, and M (y) = a.
(3) We write G k (AtA), or simply G k , for G m k (AtA) if m ≥ ω.
The atomic game F m (AtA), or simply F m , is like G m ω (AtA) except that ∀ has the advantage to reuse the available n nodes during the play. Now we approach the notion of complete representations as defined in 1.2. It is known [9] that f : A → B is a complete representation of A ⇐⇒ A is atomic and f is atomic, in the sense that x∈AtA f (x) = 1 B . For n < ω (recall that) we denote the class of completely representable CA n s by CRCA n .

Theorem 2. 6. Let 2 < n < ω and A ∈ CA n be atomic with countable many atoms. Then ∃ has a winning strategy in G k (AtA) for all k ∈ ω ⇐⇒ A ≡ B for some B ∈ CRCA n . ∃ has a winning strategy in G ω (AtA) ⇐⇒ A is completely representable. In particular, if A is finite, then ∃ has a winning strategy in G ω (AtA) ⇐⇒ A is representable ⇐⇒ ∃ has a winning strategy in G k (AtA) for all k ∈ ω.
Proof. [12, Theorem 3.3.3].
It is known that for any finite n, the class CRCA n coincides with the class S c Nr n CA ω , (where recall that S c denotes the class of forming complete subalgebras) on algebras having countably many atoms [19,Theorem 5.3.6], cf. theorem 4.1 and the corollary following it. A truncated version of theorem 2.6 is the following lemma. To prove it we need a technical definition.

Definition 2. 7. Let m be a finite ordinal > 0. An s word is a finite string of substitutions (s j i ) (i, j < m), a c word is a finite string of cylindrifications (c i ), i < m; an sc word w, is a finite string of both, namely, of substitutions and cylindrifications. An sc word induces a partial mapŵ : m → m:
•ǫ = Id, • w i j =ŵ • [i|j],
• wc i =ŵ ↾ (m {i}).

Ifā ∈ <m−1 m, we write sā, or s a 0 ...a k−1 , where k = |ā|, for an arbitrary chosen sc word w such thatŵ =ā. Such a w exists by [10, Definition 5.23 Lemma 13.29].

Lemma 2. 8. Assume that 2 < n < m < ω. If A is atomic and A ∈ S c Nr n CA m , then ∃ has a winning strategy in F m (AtA). In particular, if A ∈ Nr n CA ω , then ∃ has a winning strategy in F ω (AtA) and G ω (AtA), and if A is finite and ∀ has a winning strategy in F m (AtA), then A / ∈ SNr n CA m .

Proof. The proof lifts the ideas in [7,Lemma 29,26, 27] formulated for relation algebras to CAs. This is tedious but not too hard. We give (more than) an outline. Fix 2 < n < m.

Assume that C ∈ CA m , A ⊆ c Nr n C is an atomic CA n and N is an A-network with nodes(N ) ⊆ m. Define N + ∈ C by
N + = i 0 ,...,i n−1 ∈nodes(N ) s i 0 ,...,i n−1 N (i 0 , . . . , i n−1 ).
Here the substitution operator is defined as in definition 2.7. For a network N and function θ, the network N θ is the complete labelled graph with nodes θ −1 (nodes(N )) = {x ∈ dom(θ) : θ(x) ∈ nodes(N )}, and labelling defined by
(N θ)(i 0 , . . . , i n−1 ) = N (θ(i 0 ), θ(i 1 ), . . . , θ(i n−1 )),
for i 0 , . . . , i n−1 ∈ θ −1 (nodes(N )). The following can be proved: (1) for all x ∈ C\{0} and all i 0 , . . . , i n−1 < m, there is a ∈ AtA, such that s i 0 ,...,i n−1 a . x = 0, Then using (1) one can show:

(2) for any x ∈ C \ {0} and any finite set I ⊆ m, there is a network N such that nodes(N ) = I and x · N + = 0. Using the above proven facts, one shows that ∃ has a winning strategy in F m ; she can always play a network N with nodes(N ) ⊆ m, such that N + = 0. In the initial round, let ∀ play a ∈ AtA. ∃ plays a network N with N (0, . . . , n − 1) = a. Then N + = a = 0. Recall that here ∀ is offered only one (cylindrifier) move. At a later stage, suppose ∀ plays the cylindrifier move, which we denote by (N, f 0 , . . . , f n−2 , k, b, l). He picks a previously played network N ,
f i ∈ nodes(N ), l < n, k / ∈ {f i : i < n − 2}, such that b ≤ c l N (f 0 , . . . , f i−1 , x, f i+1 , . . . , f n−2 ) and N + = 0. Letā = f 0 . . . f i−1 , k, f i+1 , . . . f n−2 .
Then by second part of (3) we have that c l N + · sāb = 0 and so by first part of (2), there is a network M such that M + · c l N + · sāb = 0. The last part follows by observing that for any C ∈ CA n , if C ∈ SNr n CA m =⇒ C + ∈ S c Nr n CA m (where C + is the canonical extension of C) and if C is finite, then of course C = C + .


## Rainbow constructions

Rainbow constructions involve 'colours' as the name suggests, and quite sophisticated machinery from finite combinatorics and graph theory. For CA n s (2 < n < ω), the rainbow atom structure consists of certain coloured graphs. Here the atoms are graphs. Such coloured graphs (atoms) to be defined below are complete graphs of size at most n whose edges are labelled by the rainbow colours. Some hyperedges are also labelled. While n-coloured graphs will be the atoms of a rainbow CA n , the board of a rainbow game will consist of coloured graphs.

Fix 2 < n < ω.

In general, a coloured graph, with no restriction on its size [9], is a complete graph whose edges are labelled by the rainbow colours, g (greens), r (reds), and w (whites) satisfying certain consistency conditions. The greens are {g i : 1 ≤ i < n − 1} ∪ {g i 0 : i ∈ G} and the reds are {r ij : i, j ∈ R} where G and R are two relational structures. The whites are w i : i ≤ n − 2. In coloured graphs certain triangles are forbidden. For example a green triangle (a triangle whose edges are all green) is forbidden. Not all red triangles are allowed. In consistent (allowed) red triangle the indices 'must match' satisfying a certain 'consistency condition'. Also, in coloured graphs some n − 1 tuples (hyperedges) are labelled by shades of yellow [9]. More specifically the following are forbidden triangles in coloured graphs: (g, g ′ , g * ), (g i , g i , w i ), any 1 ≤ i ≤ n − 2, (g j 0 , g k 0 , w 0 ) any j, k ∈ G, and finally (r ij , r j ′ k ′ , r i * k * ) unless i = i * , j = j ′ and k ′ = k * , and no other triple of colours is forbidden [9, 4.3.3]. Given relational structures G and R the rainbow atom structure of dimension n are equivalence classes of surjective maps a : n → ∆, where ∆ is a coloured graph in the rainbow signature, and the equivalence relation relates two such maps ⇐⇒ they essentially define the same graph [9, 4.3.4]; the nodes are possibly different but the graph structure is the same. We let [a] denote the equivalence class containing a.

The accessibility binary relation corresponding to the ith cylindrifier (i < n) is defined by: [a]T i [b] ⇐⇒ a ↾ n\{i} = b ↾ n\{i}, and the accessibility unary relation corresponding to the ijth diagonal element (i < j < n) is defined by: [a] ∈ D ij ⇐⇒ a(i) = a(j). We refer to the atom [a] (a : n → ∆) as a rainbow atom. We denote the complex algebra of the rainbow atom structure based on G and R by CA G,R . The dimension of CA G,R will be clear from context.

Certain special finite coloured graphs play an essential role (in rainbow games). Such special coloured graphs are called cones: Let i ∈ G, and let M be a coloured graph consisting of n nodes x 0 , . . . , x n−2 , z. We call M an i -cone if M (x 0 , z) = g i 0 and for every 1 ≤ j ≤ m − 2, M (x j , z) = g j , and no other edge of M is coloured green. (x 0 , . . . , x n−2 ) is called the base of the cone, z the apex of the cone and i the tint of the cone.

If A is an (atomic) rainbow CA n , then the atomic games G m k and F m translate to games on coloured graphs, cf. [9, p.27-29]. The typical winning strategy of ∀ in the rainbow game played on coloured graphs played between ∃ and ∀ is bombarding ∃ with i-cones, i ∈ G, having the same base and distinct green tints. To respect the rules of the game ∃ has to choose a red label for appexes of two succesive cones. Eventually, running out of 'suitable reds', ∃ is forced to play an inconsistent triple of reds where indices do not match. Thus ∀ wins on a red clique (a graph all of whose edges are lablled by a red). Such a winning strategy is dictated by a simple Ehrenfeucht-Fraïssé forth game played on the relational structures G and R denoted by EF p r (G, R), here r is the number of rounds and p is the number of pebble pairs [12, Definition 16.2].

3 Atom-canonicity 3


## .1 Blowing up and blurring a finite rainbow algebra

The next theorem refines the seminal result of Hodkinson's [13] which is the limiting case when k = ω. It is fully proved in [22]. We start with an outline. Then we get more technical giving more than the gist of the idea of the proof which is blowing up and blurring a finite rainbow algebra.

Theorem 3.1. Let 2 < n < ω. Then there exists a countable atomic A ∈ RCA n such that CmAtA / ∈ SNr n CA n+3 . In particular, the variety SNr n CA n+k is not atom-canonical for any k ≥ 3.

Model-theoretic outline of proof of theorem 3.1 The outline of proof we present now of the above bolded statement focuses more on explaining the main ideas and is punctuated by some comments. The outline is divided to three parts. In the first part we construct a certain model on which our constrution is based.

(1) The model: Fix 2 < n < ω and 1 ≤ k ≤ ω. We have a rainbow signature L ra [12, Definition 3.6.9 (i)]. The signature L ra has, among other symbols determined by the other colours, n + k green binary relations g i 0 : 1 ≤ i ≤ n + k and ω-many red binary relations r l ij , i < j < n, and l ∈ ω. The other colours are irrelevant for the moment as far as this outline is concerned. The signature is like the rainbow signature in [13], except that here we have n + k many green binary relations. When k = ω the above rainbow signature coincides with the rainbow signature used in constructing the algebra denoted by A in [13,Definition 4.1]. (When k = ω, by n + ω, we mean ordinal addition so that n + ω = ω.) We add to L ra an additional binary relation symbol ρ forming the strict expansion L = L ra ∪ {ρ}. The rainbow construction implemented here can be coded in a theory T expanding the rainbow theory T ra , the latter given in [12, Definition 3. 6
.9(ii)].
The signature L ra of T ra is expanded to the language L forming T , and T stipulates finitely many first order formulas spelling out 'consistency conditions' for the new binary relation ρ in connection to other relation symbols (colours) in L including itself (examples will be given shortly). In the present context, the theory T is a first order theory ⇐⇒ the green binary relations are finite. The presence of countably (infinitely) many green relation symbols makes the rainbow theory an L ω 1 ,ω theory [12, Top of p.83].

A coloured graph is a model of T ra . An n-coloured graph is a coloured graph of size at most n. By an extended coloured graph, we understand a model of T (in L). An n-extended coloured graph is a coloured graph of size at most n allowing ρ as a label. If a, b ∈ ∆, ∆ an extended colured graph, and (a, b) ∈ g for some binary green relation g, say, we say that the edge (a, b) is labelled by g or labelled by a green. This terminology will apply to other relations (colours) in the signature. By a red graph, we mean an extended coloured graph that has an edge labelled by some red. In the signature L ra there are ω-many (distinct) red n-coloured graphs. By a red clique we undertand an extended coloured graph all of whose edges are labelled by a red, possibly ρ. One constructs like in [13], in the spirit of Fräisse constructions, a countable (infinite) n-homogeneous model M of T , as the limit of a play whose board consists of models of T , namely, extended coloured graphs. The triplets (ρ, r, r ′ ) and (ρ, ρ, r) are consistent for any r and r ′ in L ra , meaning that any extended coloured graph played during the game, as well as the limit, can contain the triangles whose edges are labelled by such colours as a subgraph; other red triples are forbidden and all green triangles are forbidden

The limit of the play M is also an extended rainbow graph. Here by n-homogeneity, is meant that every n-coloured graph embeds into M , and that such coloured graphs are uniquely determined by their isomorphism types, regardless of their location in M : If △ ⊆ △ ′ are extended coloured graphs, |△ ′ | ≤ n, and θ : △ → M is an embedding, then θ extends to an embedding θ ′ : △ ′ → M .

By the homogenuity built in M such n-coloured graphs will constitute the atoms of the (relativized) set algebras based on M as specified in a while; the representable algebra, and its non-representable Dedekind-MacNeille completion. This game is played between ∃ and ∀. As is the case with 'rainbow games' [9,10] ∀ challenges ∃ with cones having green tints (g i 0 ), and ∃ wins if she can respond to such moves. This is the only way that ∀ can force a win. ∃ has to respond by labelling appexes of two succesive cones, having the same base played by ∀. By the rules of the game, she has to use a red label. The winning strategy is implemented by ∃ using the red label ρ outside the rainbow signature that comes to her rescue whenever she runs out of 'rainbow reds', so she can respond with extended coloured graphs. It turns out inevitable, that some edges in M are labelled by ρ during the play; in fact these edges labelled by ρ will form an infinite red clique (an infinite complete extended graph whose edges are all labelled by ρ.)

(2) The set algebra and its Dedekind-MacNeille completion based on the model: Now we forget about the red label ρ for a while. All formulas are now taken in the rainbow signature L ra . Having M at hand, one constructs two atomic n-dimensional set algebras based on M , sharing the same atom structure and having the same top element. The first set algebra A is the L n formula set algebra having top element W ⊆ n M to be specified shortly. The second algebra C is the L n ∞,ω formula set algebra having the same top element W . The set W is obtained from n M by discarding assignments whose edges are labelled by ρ,
in symbols W = {ā ∈ n M : M |= ( i<j<n ¬ρ(x i , x j ))(ā)}, For φ ∈ L n ∞,ω , let φ W = {s ∈ W : M |= φ[s]}.
Then A has universe {φ W : φ an L n formula}, and C has universe consisting of all φ W , but now φ is an L n ∞,ω formula. In both cases the operations are the usual concrete operations of cylindric set algebras, read off from the semantics of the connectives, relativized to W . Plainly A ⊆ C.

The atoms for both algebras are determined by so-called MCA formulas [13,Definition 4.3] in the rainbow signature L ra . Every such MCA formula defines a rainbow atom, a surjective map a : n → ∆, so that ∆ is an n-coloured graphs (in the rainbow signature). Now we have AtA = AtC. The common atom structure will be denoted by At in the more technical proof to follow. The n-homogeneity built into M now plays another crucial role. The classical semantics with respect to n M and relativized semantics obtained by restricting assignments to W agree, with respect to first order formulas using n variables, which is not the case with L n ∞,ω formulas taken in the same (rainbow) signature without the red label ρ. This can be proved using n back-and-forth systems induced by any permutation on the set ω ∪ {ρ}, cf. [13,Proposition 3.13]. Hence the set algebra A is isomorphic to a cylindric set algebra having top element n M .

(3) Blowing up and blurring a finite rainbow algebra: When k = ω, Hodkinson [13] proves that C is not representable using a semantical argument [13, §5.2]. So we are certain that CmAtA / ∈ SNr n CA n+m for some finite m > 0, because i>0 SNr n CA n+i = RCA n and CmAtA / ∈ RCA n . But the ω-greens used, do not give us any information on such an m, the dimension of this dilation; for example what is the least such m? When does the Dedekind-MacNeille completion 'stop to be representable?' We proceed differently varying the parameter k. We use a so-called blow up and blur construction, a highly indicative term introduced in [3]. This is a syntactical approach. By choosing k = 1, one can embed a finite algebra D into C such that D is outside SNr n CA n+m , m ≥ 3 and so will be C.

Let us elaborate some more. Assume that k < ω. The Ehrenfeucht-Fraïssé forth game EF n+k n+k (n + k, n) [10, Definition 16.2], is played between ∀ and ∃ on the structures n + k and n viewed as complete irreflexive graphs. It is obvious that ∀ has a winning strategy in n + 1 rounds. In each round 0, 1, . . . , n + 1, ∀ places a new pebble on an element of n + k. The edges relation in n + k is irreflexive so to avoid losing ∃ must respond by placing the other pebble of the pair on an unused element of n + k. After n + 1 rounds there will be no such element, and she loses in the next round. This game can be lifted to the graph game on the finite rainbow algebra CA n+k,n , based on n + k (the greens) and n (reds) where ∀ has a winning strategy in finitely many rounds rounds using n + k + 2 nodes, that is in the game F n+k+2 ω At(CA n+k,n ). In fact, he does not need to reuse nodes, so ∀ actually wins the harder game G n+k+2 ω At(CA n+k,n ). One can embed CA n+k,n into C = CmAtA. It follows by lemma 2.8 that CA n+k,n / ∈ SNr n CA n+k+2 . The smaller k is, the sharper the result we obtain. So take k to be the least possible value, namely, k = 1. In this case the n + 1 greens tell us that CmAtA / ∈ SNr n CA n+m for any m ≥ 3, because now CA n+1,n / ∈ SNr n CA n+3 and CA n+1,n embeds into C by mapping every rainbow atom [a] : n → ∆, ∆ an n-coloured graph in the finite rainbow signature of CA n+1,n to the join of its copies. A copy of [a] : n → ∆ is a rainbow atom in C of the form [b] : n → ∆ ′ where ∆ ′ is isomorphic to ∆ modulo altering superscripts of the reds. In particular, the copy of any [a] : n → ∆ where ∆ is not red is itself.

We say that A and C are obtained by blowing up and blurring CA n+1,n . The algebraic structure of CA n+1,n is blurred in A; CA n+1,n does not embed in A. On the other hand, CA n+1,n is not blurred in C, because CA n+1,n embeds in C.


## More (technical) details

The argument used, as indicated above, is a combination of the rainbow construction in [13] which is implemented model-theoretically, together with the blow up and blur construction used in [3]. Here we proceed 'the other way round'. We start where we ended in the above sketch. We embed the finite (rainbow) algebra D = CA n+1,n / ∈ SNr n CA n+3 in the Dedekind-MacNeille completion of an atomic (infinite) algebra A ∈ RCA n , where A is obtained by blowing up and blurring D. The 'blowing up' is done by splitting the red atoms of D each into infinitely many atoms (of A).

(1) Blowing up and blurring CA n+1,n forming a weakly representable atom structure At: Take the finite rainbow cylindric algebra R(Γ) as defined in [12, Definition 3. 6.9], where Γ (the reds) is taken to be the complete irreflexive graph m, and the greens are
{g i : 1 ≤ i < n−1}∪{g i 0 : 1 ≤ i ≤ n+1} so tht G is the complete irreflexive graph n+1.
Call this finite rainbow n-dimensional cylindric algebra, based on G = n + 1 and R = n CA n+1,n and denote its finite atom structure by At f . One then replaces each red colour used in constructing CA n+1,n by infinitely many with superscripts from ω, getting a weakly representable atom structure At, that is, the term algebra TmAt is representable. The resulting atom structure (with ω-many reds), call it At, is the rainbow atom structure that is like the atom structure of the (atomic relativized set) algebra A defined in [13,Definition 4.1] except that we have n + 1 greens and not infinitely many as is the case in [13]. Everything else is the same. In particular, the rainbow signature [12, Definition 3. 6.9] now consists of g i : 1 ≤ i < n − 1, g i 0 : 1 ≤ i ≤ n + 1, w i : i < n − 1, r t kl : k < l < n, t ∈ ω, binary relations, and n − 1 ary relations y S , S ⊆ n + 1. There is a shade of red ρ; the latter is a binary relation that is outside the rainbow signature.

But ρ is used as a label for coloured graphs built during a 'rainbow game', and in fact, ∃ can win the rainbow ω-rounded game and she builds an n-homogeneous (coloured graph) model M as indicated in the above outline by using ρ when she is forced a red [13, Proposition 2.6, Lemma 2.7]. Then TmAt is representable as a set algebra with unit n M ; this can be proved exactly as in [13]. In fact, TmAt ⊆ A, with A as described in the preceding outline.

(2) Embedding CA n+1,n into the Dedekind-MacNeille completion of TmAt: We embed CA n+1,n into the complex algebra CmAt, the Dedekind-MacNeille completion of TmAt. Let CRG f denote the class of coloured graphs on At f and CRG be the class of coloured graph on At. We can assume that CRG f ⊆ CRG. Write M a for the atom that is the (equivalence class of the) surjection a : m → M , M ∈ CGR. Here we identify a with [a]; no harm will ensue. We define the (equivalence) relation ∼ on At by
M b ∼ N a , (M, N ∈ CGR) : • a(i) = a(j) ⇐⇒ b(i) = b(j), • M a (a(i), a(j)) = r l ⇐⇒ N b (b(i), b(j)) = r k , for some l, k ∈ ω,
• M a (a(i), a(j)) = N b (b(i), b(j)), if they are not red,
• M a (a(k 0 ), . . . , a(k n−2 )) = N b (b(k 0 ), . . . , b(k n−2 )), whenever defined. We say that M a is a copy of N b if M a ∼ N b .
We say that M a is a red atom if it has at least one edge labelled by a red rainbow colour r l ij for some i < j < n and l ∈ ω. Clearly every red atom M a has infinitely countable many red copies, which we denote by {M (j) a : j ∈ ω}. Now we define a map Θ : CA n+1,n = CmAt f to CmAt, by specifing first its values on
At f , via M a → j M (j)
a ; each atom maps to the suprema of its copies. If M a is not red, then by j M (j) a , we understand M a . This map is extended to CA n+1,n the obvious way by Θ(x) = {Θ(y) : y ∈ AtCA n+1,n , y ≤ x}. The map Θ is well-defined, because CmAt is complete. It is not hard to show that the map Θ is an injective homomorphim. Injectivity follows from the fact that M a ≤ f (M a ), hence Θ(x) = 0 for every atom x ∈ At(CA n+1,n ). We check only preservation of cylindrifiers. Let i < n. By additivity (of cylindrifiers), we restrict our attention to atoms M a ∈ At f with a : n → M , and M ∈ CRG f ⊆ CRG. Then:
f (c CmAt f i a) = f ( [c]≡ i [a] M c ) = [c]≡ i [a] f (M c ) = [c]≡ i [a] j M (j) c = j [c]≡ i [a] M (j) c = j c CmAt i M (j) a = c CmAt i ( j M (j) a ) = c CmAt i f (a).
(3) Exactly like in above outline, one proves that ∀ has a winning strategy for ∃ in F n+3 At(CA n+1,n ) using the usual rainbow strategy by bombarding ∃ with cones having the same base and distinct green tints. He needs n + 3 nodes to implement his winning strategy. Then by lemma 2.8 this implies that CA n+1,n / ∈ SNr n CA n+3 . Since CA n+1,n embeds into CmAt, hence CmAt is outside SNr n CA n+3 , too.


# First order definability

Throughout this section, unless otherwise indicated, n is a finite ordinal > 1. Gs n is the class of generalized set algebras of dimension n as defined in the introduction. Ws ω is the class of weak set algebras of dimension ω. An algebra A ∈ Ws ω ⇐⇒ A has top element V ⊆ ω U where V is the set of all sequences agreeing co-finitely with a fixed in advance sequence p ∈ ω U and the operations of A are defined like in set algebras restricted to V . In conformity with the notation of [5], we denote V (called an ω-dimensional weak space) by ω U (p) . Recall that CRCA n denotes the class of completely representable CA n s. Theorem 4.1. Let 2 < n < ω. Then CRCA n ⊆ S c Nr n CA ω . Conversely, if A ∈ S c Nr n CA ω has countably many atoms, then A ∈ CRCA n .

Proof. The last part follows from [19,Theorem 5.3.6] by noting that if B is atomic having countably many atoms and B ∈ S c Nr n CA ω , then TmAtB ⊆ d B, so TmAtB ∈ S d S c Nr n CA ω ⊆ S c S c Nr n CA ω = S c Nr n CA ω , and TmAtB is atomic and countable. Furthermore, TmAtB is completely representable ⇐⇒ B is completely representable, because they share the same atom structure. The cited theorem [19,Theorem 5.3.6] tells us that TmAtB is completely representable, so B is completely representable, too.

We prove the first inclusion. Assume that C ∈ Gs n is a complete representable of A via t. That is t : A → C is a complete representation. Assume further that C has top element a disjoint union of the form i∈I n U i (I and U i non-empty sets and
U i ∩ U j = ∅ for i = j ∈ I). For i ∈ I, let E i = n U i . Fix f i ∈ ω U i . Let W i = ω U (f i ) i . Let C i = ℘(W i ). Then C i is atomic; indeed the atoms are the singletons. Let x ∈ Nr n C i , that is c j x = x for all n ≤ j < ω. Now if f ∈ x and g ∈ W i satisfy g(k) = f (k) for all k < n, then g ∈ x. Hence Nr n C i is atomic; its atoms are {g ∈ W i : {g(i) : i < n} ⊆ U i }. Define h i : A → Nr n C i by h i (a) = {f ∈ W i : ∃a ′ ∈ AtA, a ′ ≤ a; (f (i) : i < n) ∈ t(a ′ )}. Let D = P i C i . Let π i : D → C i be the ith projection map. Now clearly D is atomic,
because it is a product of atomic algebras, and its atoms are
(π i (β) : β ∈ At(C i )). Now A embeds into Nr n D via J : a → (h i (a) : i ∈ I). If x ∈ Nr n D, then for each i, we have π i (x) ∈ Nr n C i , and if x is non-zero, then π i (x) = 0. By atomicity of C i , there is an n-ary tuple y, such that {g ∈ W i : g(k) = y k } ⊆ π i (x). It follows that there is an atom b ∈ A,
such that x · J(b) = 0, and so the embedding is atomic, hence complete. We have shown that A ∈ S c Nr n CA ω . and we are done.

For a class K of BAOs, we let K ∩ At denote the class of atomic algebras in K. The following corollary can be distilled from the above proof since the constructed ω-dilation of the given completely representable CA n is a full generalized weak set algebra in the sense of [5, Definition 3.1.2(iv)], so it is atomic. The rest follows from lemma 2.8 and the second part of theorem 4.1.
Corollary 4.2. Assume that 2 < n < ω. Then A ∈ CA n is completely representable =⇒ A ∈ S c Nr n (CA ω ∩ At) =⇒
A is atomic and A ∈ S c Nr n CA ω =⇒ ∃ has a winning strategy in G ω and F ω . All reverse implications hold, if A has countably many atoms.

We note that not all of the above implications can be reversed as shown in the last item of the coming theorem 4.3, see also theorem 5.5 addressing atomic ω-dilations. In the first item of the next theorem we generalize the main result in [9]. The latter result shows that the class of completely representable CA n s, for 2 < n < ω is not elementary.

To formulate and prove the next theorem, we need to fix some notation. S d is the operation of forming dense subalgbras. For A ∈ CA n , n ≥ 3, RaA is the relation algebra reduct of A as defined in [5,Definition 5.3.7].

For relation algebras we follow the terminology of [10] with a single deviation. We denote the identity relation by Id rather than 1 ′ . In particular, RA denotes the class of relation algebras and (C)RRA denotes the class of (completely) representable RAs. For n ≥ 4 and A ∈ CA n , RaA ∈ RA [5, Theorem 5. 3.8]. For K ⊆ CA n , RaK denotes the class
{RaA : A ∈ K}.
For a class K, we let ElK denote the elementary closure of K, that is, the smallest elementary class containing K. For a class K of BAOs, we write AtK for {AtA : A ∈ K∩At}. Let 2 < n < m. Consider the class N m = {A ∈ CA n ∩ At : CmAtA ∈ Nr n CA m }. We will see that N m = Nr n CA m by item (3)   (1) For any class K, such that CRCA n ∩ S c Nr n CA ω ⊆ K ⊆ S c Nr n CA k , K is not elementary. In particular, the class CRCA n is not elementary [9]. Furthermore, the classes C k and C at k are not elementary.

(2) For any class K, such that CRCA n ∩ S d Nr n CA ω ⊆ K ⊆ S c Nr n CA k , K is not elementary. Furthemore, any class L such that At(Nr n CA ω ) ⊆ L ⊆ At(S c Nr n CA n+3 ) and the class N k are not elementary. Finally, ElNr n CA ω S d Nr n CA ω ⇐⇒ any class L such that Nr n CA ω ⊆ L ⊆ S c Nr n CA n+3 , L is not elementary.

(3) Let α be any ordinal > 1. Then for every infinite cardinal κ ≥ |α|, there exist completely representable algebras B, A ∈ CA α , that are weak set algebras, such that
AtA = AtB, |AtB| = |B| = κ, B / ∈ ElNr α CA α+1 , A ∈ Nr α CA α+ω , and CmAtB = A, so that |A| = 2 κ . In particular, Nr α CA β S d Nr α CA β .
(4) The classes CRCA n and Nr n CA m for n < m are pseudo-elementary but not elementary, nor pseudo-universal. Furthermore, their elementary theory is recursively enumerable. For any n < m, the class Nr n CA m is not closed under L ∞,ω equivalence.

(5) There is an atomic R ∈ RaCA ω ∩ ElCRRA that is not completely representable. Also, there is an atomic algebra A ∈ Nr n CA ω ∩ ElCRCA n , that is not completely representable. In particular, both CRRA and CRCA n are not elementary [9].

Proof. (1) [22] Fix finite n > 2. One takes an algebra A Z,N based on the ordered structure Z and N, that is similar to the rainbow algebra CA Z,N but not identical. The rainbow colours (signatures) are the same. In particular, the reds R constitute the set {r ij : i < j < ω(= N)} and the green colours used constitute the set {g i : 1 ≤ i < n−1}∪{g i 0 : i ∈ Z}. In complete coloured graphs the forbidden triples are like in CA Z,N but now the additional triple (g i 0 , g j 0 , r kl ) is also forbidden if {(i, k), (j, l)} is not an order preserving partial function from Z → N. For the sake of brevity, we write C for A Z,N throughout the whole proof. Then ∃ has a winning strategy ρ k in the k-rounded game G k (AtC) for all k ∈ ω [22]. Hence, using ultrapowers and an elementary chain argument [12, Corollary 3. 3.5], one gets a countable algebra B such that B ≡ A, and ∃ has a winning strategy in G ω (AtB).

The reasoning is as follows: We can assume that ρ k is deterministic. Let D be a nonprincipal ultrapower of C. Then ∃ has a winning strategy σ in G ω (D) -essentially she uses ρ k in the k'th component of the ultraproduct so that at each round of G ω (D), ∃ is still winning in co-finitely many components, this suffices to show she has still not lost. We can assume that C is countable by replacing it, without loss, by TmAtC. Winning strategies are preserved. Now one can use an elementary chain argument to construct countable elementary subalgebras C = A 0 A 1 . . . . . . D in this manner. One defines A i+1 to be a countable elementary subalgebra of D containing A i and all elements of D that σ selects in a play of G ω (D) in which ∀ only chooses elements from A i . Now let B = i<ω A i . This is a countable elementary subalgebra of D, hence B ≡ C, because C ≡ D, and clearly ∃ has a winning strategy in G ω (B). Then B is completely representable by [12, Theorem 3. 3


## .3].

On the other hand, one can show that ∀ has a winning strategy in F n+3 (AtC). The idea here, is that, as is the case with winning strategy's of ∀ in rainbow constructions, ∀ bombards ∃ with cones having distinct green tints demanding a red label from ∃ to appexes of succesive cones. The number of nodes are limited but ∀ has the option to re-use them, so this process will not end after finitely many rounds. The added order preserving condition relating two greens and a red, forces ∃ to choose red labels, one of whose indices form a decreasing sequence in N. In ω many rounds ∀ forces a win, so C / ∈ S c Nr n CA n+3 . He plays as follows: In the initial round ∀ plays a graph M with nodes 0, 1, . . . , n − 1 such that M (i, j) = w 0 for i < j < n − 1 and M (i, n − 1) = g i (i = 1, . . . , n − 2), M (0, n − 1) = g 0 0 and M (0, 1, . . . , n − 2) = y Z . This is a 0 cone. In the following move ∀ chooses the base of the cone (0, . . . , n − 2) and demands a node n with M 2 (i, n) = g i (i = 1, . . . , n − 2), and M 2 (0, n) = g −1 0 . ∃ must choose a label for the edge (n + 1, n) of M 2 . It must be a red atom r mk , m, k ∈ N. Since −1 < 0, then by the 'order preserving' condition we have m < k. In the next move ∀ plays the face (0, . . . , n − 2) and demands a node n + 1, with M 3 (i, n) = g i (i = 1, . . . , n − 2), such that M 3 (0, n + 2) = g −2 0 . Then M 3 (n + 1, n) and M 3 (n + 1, n − 1) both being red, the indices must match. M 3 (n + 1, n) = r lk and M 3 (n + 1, r − 1) = r km with l < m ∈ N. In the next round ∀ plays (0, 1, . . . n − 2) and re-uses the node 2 such that M 4 (0, 2) = g −3 0 . This time we have M 4 (n, n − 1) = r jl for some j < l < m ∈ N. Continuing in this manner leads to a decreasing sequence in N. Let k ≥ 3 and let K be as in the statement. Then C / ∈ K, B ∈ K ∩ CRCA n and C ≡ B, we are done. C at k = S c Nr n (CA k ∩ At), hence by the above it is not elementary. For non-elementarity of C k , we have C ≡ B, C / ∈ S c Nr n CA k and B is completely representable, hence it is S c Nr n CA ω .

(2) We first give the general idea. Let C = A Z,N be as defined in the previous item. One can (and will) define a k-rounded atomic game stronger than G k call it H k , for k ≤ ω, so that if B ∈ CA n is countable and atomic and ∃ has a winning strategy in H ω (AtB), then (*) AtB ∈ AtNr n CA ω and CmAtB ∈ Nr n CA ω . One shows that ∃ has a winning strategy in H k (AtC) for all k ∈ ω, hence using ultrapowers and an elementary chain argument, we get that C ≡ B, for some countable completely representable B that satisfies the two conditions in (*). Since B ⊆ d CmAtB, we get the required result, because B ∈ S d Nr n CA ω and as before C / ∈ S c Nr n CA n+3 and C ≡ B. Now we prove the second part. Let L be as specified and B and C(= A Z,N ) be the algebras constructed above. Since an atom structure of an algebra is first order interpretable in the algebra, then we have B ≡ C =⇒ AtB ≡ AtC. Furthermore AtB ∈ At(Nr n CA ω ) ⊆ L (though B might not be in Nr n CA ω , cf. the next item) and AtC / ∈ At(S c Nr n CA n+3 ) ⊇ L. The last part follows from the fact that if D ∈ CA n is atomic, then AtD ∈ At(S c Nr n CA n+3 ) ⇐⇒ D ∈ S c Nr n CA n+3 . We conclude that L is not elementary.

We define the game H. But first some preparation. Fix 2 < n < ω.

For an n-dimensional atomic network on an atomic CA n and for x, y ∈ nodes(N ), we set x ∼ y if there existsz such that N (x, y,z) ≤ d 01 . Define the equivalence relation ∼ over the set of all finite sequences over nodes(N ) byx ∼ȳ iff |x| = |ȳ| and x i ∼ y i for all i < |x|. (It can be easily checked that this indeed an equivalence relation).

A hypernetwork N = (N a , N h ) over an atomic CA n consists of an n-dimensional network N a together with a labelling function for hyperlabels N h : <ω nodes(N ) → Λ (some arbitrary set of hyperlabels Λ) such that forx,ȳ ∈ <ω nodes(N ) ifx ∼ȳ ⇒ N h (x) = N h (ȳ). If |x| = k ∈ N and N h (x) = λ, then we say that λ is a k-ary hyperlabel.x is referred to as a k-ary hyperedge, or simply a hyperedge. We may remove the superscripts a and h if no confusion is likely to ensue.

A hyperedgex ∈ <ω nodes(N ) is short, if there are y 0 , . . . , y n−1 that are nodes in N ,
such that N (x i , y 0 ,z) ≤ d 01 or . . . N (x i , y n−1 ,z) ≤ d 01 for all i < |x|, for some (equivalently for all)z. Otherwise, it is called long. A hypernetwork N is called λ-neat if N (x) = λ for all short hyperedges.
Concerning ∀'s moves, H m has m rounds, m ≤ ω. He can play a cylindrifier move, like before but now played on λ-neat hypernetworks with λ a constant label on short hyperedges. Also ∀ can play a transformation move by picking a previously played λneat hypernetwork N and a partial, finite surjection θ : ω → nodes(N ), this move is denoted (N, θ). ∃'s response is mandatory. She must respond with N θ. We assume that the claim is true and take it from there.

Using the usual technique of forming ultrapowers followed by an elementary chain argument, we get that there exists a countable (completely representable) algebra, which we continue to denote by a slight abuse of notation also B, such that A Z,N ≡ B, and ∃ has a winning strategy on H(AtB). For brevity, let α = AtB. Using ∃'s winning strategy in H, one builds an ω-dilation D a of B for every a ∈ AtB, based on a structure M a in some signature to be specified shortly. Strictly speaking, M a will be a weak model, where assignments are relativized, they are required to agree co-finitely with a fixed sequence in ω M a . This weak model M a is taken in a signature L consisting of one n-ary relation for each b ∈ AtB and a k-ary relation symbol for each hyperedge of length k labelled by λ the constant neat hyperlabel.

For a ∈ AtB, the weak model M a is the limit of the play H ω ; in the sense that M a is the union of the λ-neat hypernetworks on B played during the game H ω , with starting point the initial atom a that ∀ chose in the first move. Labels for the edges and hyperedges in M a are defined the obvious way, inherited from the λ-neat hypernetworks played during the ω-rounderd game H ω (AtB). These are nested, so this labelling is well defined giving an interpretation of only the atomic formulas of L in M a . There is some space here in 'completing' the interpretation. One uses an extension L, not necessarily a proper one, of L ω,ω as a vehicle for constructing D a . The algebra D a will be a weak set algebra based on M a of L-formulas taken in the signature L. That is the base in the sense of [5, Definition 3.1.1] of D a is M a , and the set-theoretic operations of D a are read off the connectives in L. In all cases, as long as L contains L ω,ω as a fragment, we get that B neatly embeds into D, that is B ⊆ Nr n D, where D = P a∈AtB D a . There are three possibilites measuring 'how close' B is to Nr n D. We go from the closest to the less close. Either (a) B = Nr n D or (b) B ⊆ d Nr n D or (c) B ⊆ c Nr n D. From the first part, building D using the weaker game G used in the proof of the previous item, we can get the last possibility. It is reasonable to expect that the stronger L is, the 'more control' AtB has over the hitherto obtained ω-dilation D; the closer B is to the neat n-reduct of D based on L-formulas. If (a) is true than any K between Nr n CA ω ∩ CRCA n and S c Nr n CA n+3 would be non-elementary. We could not prove (a). So let us approach the two remaining possibilities (b) and (c). Suppose we take L = L ∞,ω . Then using the fact that in the λ-neat hypernetworks played during the game H ω short hyperedges are constantly labelled by λ, one can show that B and Nr n D have isomorphic atom structures, in symbols AtB ∼ = AtNr n D as follows. For brevity, denote the hitherto obtained AtB by α.

Fix some a ∈ α. Using ∃ s winning strategy in the game H(α) played on λ-neat hypernetworks λ a constant label kept on short hyperedges, one defines a nested sequence M 0 ⊆ M 1 , . . . of λ-neat hypernetworks where M 0 is ∃'s response to the initial ∀-move a, such that: If M r is in the sequence and M r (x) ≤ c i a for an atom a and some i < n, then there is s ≥ r and d ∈ nodes(M s ) such that M s (ȳ) = a,ȳ i = d andȳ ≡ ix . In addition, if M r is in the sequence and θ is any partial isomorphism of M r , then there is s ≥ r and a partial isomorphism θ + of M s extending θ such that rng(θ + ) ⊇ nodes(M r ) (This can be done using ∃'s responses to amalgamation moves).

Now let M a be the limit of this sequence, that is M a = M i , the labelling of n − 1 tuples of nodes by atoms, and hyperedges by hyperlabels done in the obvious way. Let L be the signature with one n-ary relation for each b ∈ α = AtB, and one k-ary predicate symbol for each k-ary hyperlabel λ. Now we work in L ∞,ω . For fixed f a ∈ ω nodes(M a ), let U a = {f ∈ ω nodes(M a ) : {i < ω : g(i) = f a (i)} is finite}. Now we make U a into the base of an L relativized structure M a like in [7, Theorem 29] except that we allow a clause for infinitary disjunctions. In more detail, for b ∈ α, l 0 , . . . , l n−1 , i 0 . . . , i k−1 < ω, k-ary hyperlabels λ, and all L-formulas φ, φ i , ψ, and f ∈ U a :
M a , f |= b(x l 0 . . . , x l n−1 ) ⇐⇒ M a (f (l 0 ), . . . , f (l n−1 )) = b, M a , f |= λ(x i 0 , . . . , x i k−1 ) ⇐⇒ M a (f (i 0 ), . . . , f (i k−1 )) = λ, M a , f |= ¬φ ⇐⇒ M a , f |= φ, M a , f |= ( i∈I φ i ) ⇐⇒ (∃i ∈ I)(M a , f |= φ i ), M a , f |= ∃x i φ ⇐⇒ M a , f [i/m] |= φ, some m ∈ nodes(M a ).
We are now working with (weak) set algebras whose semantics is induced by L ∞,ω formulas in the signature L, instead of first order ones. For any such L-formula φ, write φ Ma for {f ∈ U a : M a , f |= φ}. Let D a = {φ Ma : φ is an L-formula} and D a be the weak set algebra with universe D a . Let D = P a∈α D a . Then D is a generalized weak set algebra [5, Definition 3. 1
.2 (iv)]. Let x ∈ D. Then x = (x a : a ∈ α), where x a ∈ D a . For b ∈ α let π b : D → D b be the projection map defined by π b (x a : a ∈ α) = x b . Conversely, let ι a : D a → D be the embedding defined by ι a (y) = (x b : b ∈ α), where x a = y and x b = 0 for b = a.
We show that α ∼ = AtNr n D and that Cmα ∼ = Nr n D. The argument used is like the argument used in [7, Theorem 39] adapted to CAs. Suppose x ∈ Nr n D \ {0}. Since x = 0, then it has a non-zero component π a (x) ∈ D a , for some a ∈ α. Assume that ∅ = φ(x i 0 , . . . , x i k−1 ) Da = π a (x), for some L-formula φ(x i 0 , . . . ,
x i k−1 ). We have φ(x i 0 , . . . , x i k−1 ) Da ∈ Nr n D a . Pick f ∈ φ(x i 0 , . . . , x i k−1 ) Da and assume that M a , f |= b(x 0 , . . . x n−1 ) for some b ∈ α. We show that b(x 0 , x 1 , . . . , x n−1 ) Da ⊆ φ(x i 0 , . . . , x i k−1 ) Da .
Take any g ∈ b(x 0 , x 1 . . . , x n−1 ) Da , so that M a , g |= b(x 0 , . . . x n−1 ). The map {(f (i), g(i)) : i < n} is a partial isomorphism of M a . Here that short hyperedges are constantly labelled by λ is used. This map extends to a finite partial isomorphism θ of M a whose domain includes f (i 0 ), . . . , f (i k−1 ). Let g ′ ∈ M a be defined by
g ′ (i) = θ(i) if i ∈ dom(θ) g(i) otherwise
We have M a , g ′ |= φ(x i 0 , . . . , x i k−1 ). But g ′ (0) = θ(0) = g(0) and similarly g ′ (n − 1) = g(n − 1), so g is identical to g ′ over n and it differs from g ′ on only a finite set. Since φ(x i 0 , . . . , x i k−1 ) Da ∈ Nr n D a , we get that M a , g |= φ(x i 0 , . . . , x i k ), so g ∈ φ(x i 0 , . . . , x i k−1 ) Da (this can be proved by induction on quantifier depth of formulas). This proves that
b(x 0 , x 1 . . . x n−1 ) Da ⊆ φ(x i 0 , . . . , x i k ) Da = π a (x), and so ι a (b(x 0 , x 1 , . . . x n−1 ) Da ) ≤ ι a (φ(x i 0 , . . . , x i k−1 ) Da ) ≤ x ∈ D a \ {0}.
Now every non-zero element x of Nr n D a is above a non-zero element of the following form ι a (b(x 0 , x 1 , . . . , x n−1 ) Da ) (some a, b ∈ α) and these are the atoms of Nr n D a . The map defined via b → (b(x 0 , x 1 , . . . , x n−1 ) Da : a ∈ α) is an isomorphism of atom structures, so that α = AtB ∈ AtNr n CA ω . Because we are working in L ∞,ω , infinite disjuncts exist in D a (a ∈ α), hence, they exist too in the dilation D = P a∈α D a . Therefore D is complete, so Nr n D is complete, too. Indeed, let X ⊆ Nr n D. Then by completeness of D, we get that d = D X exists. Assume that i / ∈ n, then c i d = c i X = x∈X c i x = X = d, because the c i s are completely additive and c i x = x, for all i / ∈ n, since x ∈ Nr n D. We conclude that d ∈ Nr n D, and so Nr n D is complete as claimed. Now D = P a∈AtB D a and its n-neat reduct Nr n D are complete. Accordingly, we can make the identification Nr n D ⊆ d CmAtB. By density, we get that Nr n D = CmAtB (since Nr n B is complete), hence CmAtB ∈ Nr n CA ω .

Using only CmAtB ∈ Nr n CA ω , we get that B ∈ S d Nr n CA ω , because B is dense in its Dedekind-MacNeille completion. Hence we attain the second possibility. But it will now readily follows that any class K, such that S d Nr n CA ω ∩ CRCA n ⊆ K ⊆ S c Nr n CA n+3 is not elementary, where S d denotes the operation of forming dense subalgebras. Indeed, we have B ⊆ d CmAtB ∈ Nr n CA ω ∩ CRCA n ⊆ K, C / ∈ S c Nr n CA n+3 ⊇ K, and C ≡ B. Non-first order definability of N k follows from C ≡ B, CmAtB ∈ Nr n CA ω and C / ∈ Nr n CA ω (⊇ S c Nr n CA n+3 ). For the last part, It suffices to consider classes between Nr n CA ω and S d Nr n CA ω . One implication, namely ⇐= is trivial. For the other less trivial implication, assume for contradiction that there is such a class K that is elementary. Then ElNr n CA ω ⊆ K, because K is elementary. It readily follows that Nr n CA ω ⊆ ElNr n CA ω ⊆ K ⊆ S d Nr n CA ω , which is impossible by the given assumption that ElNr n CA ω S d Nr n CA ω .

(3) Fix an infinite cardinal κ ≥ |α|. Assume that α > 1. Let F be field of characteristic 0 such that |F| = κ, V = {s ∈ α F : |{i ∈ α : s i = 0}| < ω} and let A have universe ℘(V ) with the usual concrete operations. Then clearly ℘(V ) ∈ Nr α CA α+ω . Let y denote the following α-ary relation: y = {s ∈ V : s 0 +1 = i>0 s i }. Let y s be the singleton containing s, i.e. y s = {s}.

Let B = Sg A {y, y s : s ∈ y}. Clearly |B| = κ. Now B and A having same top element V , share the same atom structure, namely, the singletons, so B ⊆ d A and CmAtB = A. As proved in [23], we have B / ∈ ElNr α CA α+1 , hence B ∈ S d Nr α CA β ∼ Nr α CA β . (4) The class CRCA n is not elementary by the proof of the first item, cf. [9], hence it is not pseudo-univeral. It is also not closed under S: Take any representable algebra that is not completely representable, for example an infinite algebra that is not atomic.

Other atomic examples is the term algebra TmAt dealt with in the proof of theorem 3.1 and CA Z,N dealt with above. The former is not completely representable because a complete representation of TmAt induces a representation of CmAt which we know is outside SNr n CA n+3 . Call such an elgebra A. Then A + is completely representable, a classical result of Monk's [9] and A embeds into A + . For pseudo-elementarity one proceeds like the relation algebra case [10, pp. 279-280] defining complete representability in a twosorted theory, undergoing the obvious modifications. For pseudo-elementarity for the class Nr n CA β for any 2 < n < β one easily adapts [7, Theorem 21] by defining Nr n CA β in a two-sorted theory, when 1 < n < β < ω, and a three-sorted one, when β = ω. The first part is easy. For the second part; one uses a sort for a CA n (c), the second sort is for the Boolean reduct of a CA n (b) and the third sort for a set of dimensions (δ).

For any infinite ordinal µ, the defining theory for Nr n CA µ = Nr n CA ω , includes sentences requiring that the constants i δ for i < ω are distinct and that the last two sorts define a CA ω . There is a function I b from sort c to sort b and sentences forcing that I b is injective and respects the CA n operations. For example, for all x c and i < n,
I b (c i x c ) = c b i (I b (x c )).
The last requirement is that I b maps onto the set of n-dimensional elements. This can be easily expressed via (*)
∀y b ((∀z δ (z δ = 0 δ , . . . (n − 1) δ =⇒ c b (z δ , y b ) = y b )) ⇐⇒ ∃x c (y b = I b (x c ))).
In all cases, it is clear that any algebra of the right type is the first sort of a model of this theory. Conversely, a model for this theory will consist of A ∈ CA n (sort c), and a B ∈ CA ω ; the dimension of the last is the cardinality of the δ-sorted elements which is ω, such that by (*) A = Nr n B. Thus this three-sorted theory defines the class of neat reducts; furthermore, it is clearly recursive. Recursive enumerability follows from [10, Theorem 9.37].

For non-elementarity: The algebras A and B constructed in [19, Theorem 5. 1.4] satisfy that A ∈ Nr n CA ω , B / ∈ Nr n CA n+1 and A ≡ B. As they stand, A and B are not atomic, but they can be modified to be so giving the same result, by interpreting the uncountably many tenary relations in the signature of M defined in [19, Lemma 5. 1.4], which is the base of A and B to be disjoint in M, not just distinct. This can be fixed. For u ∈ n n, we briefly write 1 u for χ M u , denoted by 1 u (for n = 3) in [19, Theorem 5. 1.4]. We work with 2 < n < ω instead of only n = 3. The proof presented in op.cit lifts verbatim to any such n. Write V for n n and recall that Id : n → n for the identity function on n. For
each w ∈ V the component B w = {x ∈ B : x ≤ 1 w }(⊆ A w = {x ∈ A : x ≤ 1 w }) contains infinitely many atoms.
For any w ∈ V \ {Id}, AtB w = AtA w and |AtA w | = |AtB w | = κ, where κ is the (uncountable) cardinality of the n-ary relation symbols in the signature. For B, |AtB Id | = ω, but it is still an infinite set. We show that ∃ has a winning strategy in an Ehrenfeucht-Fraïssé-game over (A, B) concluding that A ≡ ∞ B. At any stage of the game, if ∀ places a pebble on one of A or B, ∃ must place a matching pebble, on the other algebra. Let a = a 0 , a 1 , . . . , a n−1 be the position of the pebbles played so far (by either player) on A and letb = b 0 , . . . , b n−1 be the position of the pebbles played on B. ∃ maintains the following properties throughout the game.

• For any atom x (of either algebra) with x · 1 Id = 0 then x ∈ a i ⇐⇒ x ∈ b i .

•ā induces a finite partion of 1 Id in A of 2 n (possibly empty) parts p i : i < 2 n andb induces a partion of 1 Id in B of parts q i : i < 2 n . p i is finite ⇐⇒ q i is finite and, in this case, |p i | = |q i |.

We have proved that (the stronger) A ≡ ∞ B. Though L ∞,ω does not see 'this cardinality twist' implemented by forcing B Id to be countable, a suitably chosen term will. Such a term is not term definable in the language of CA n . It is the substitutution operator n s(0, 1) (using one spare dimension) as defined in the proof of [19, Theorem 5. 1.4]. The term n s(0, 1) witnesses that B is not a neat reduct in the following sense. Assume for contradiction that B = Nr n C, with C ∈ CA n+1 . Let u = (1, 0, 2, . . . n − 1). Then A u = B u and so |B u | > ω. The term n s(0, 1) acts like a substitution operator corresponding to the transposition [0, 1]; it 'swaps' the first two co-ordinates. Now one can show that n s(0, 1) C B u ⊆ B [0,1]•u = B Id , so | n s(0, 1) C B u | is countable because B Id was forced by construction to be countable. But n s(0, 1) is a Boolean automorpism with inverse n s(1, 0), so |B u | = | n s(0, 1) C B u | > ω, contradiction.

(5) For the last required fix finite n > 2. In [7, Remark 31] a relation atomic algebra R having uncountably many atoms is constructed such that R has an ω-dimensional cylindric basis H and R is not completely representable. If one takes C = Ca(H), then C ∈ CA ω , C is atomless, and R = RaC. The required CA n is B = Nr n C; B is atomic and has uncountably many atoms. Furthermore, B has no complete representation for a complete representation of B induces one of R. We show that B is in ElCRCA n . Since B ∈ Nr n CA ω , then by lemma 2.8, ∃ has a winning strategy in G ω (AtB), hence ∃ has a winning strategy in G k (AtB) for all k < ω. Using ultrapowers and an elementary chain argument [12, Corollary 3. 3.5], we get that B ≡ D, for some countable atomic D, and ∃ has a winning strategy in G ω (AtD). Since D is countable then by [12, Theorem 3. 3.3] it is completely representable. We have proved that B ∈ ElCRK n . Since B / ∈ CRCA n , then CRCA n is not elementary.

For relation algebras we have R ∈ RaCA ω and R has no complete representation. The rest is like the CA case, using [7,Theorem 33], when the dilation is ω-dimensional, namely, R ∈ S c RaCA ω =⇒ ∃ has a winning strategy in F ω equivalently in G ω (the last two games formulated for RAs the former as in [7, Definition 28]).

Next we show that a winning strategy in H ω is 'not enough' to deduce (a) as in the second item of the previous proof in the sense that, for 2 < n < ω, if D ∈ CA n is countable and atomic and ∃ has a winning strategy in H ω (AtD) then AtD ∈ AtNr n CA ω but this does not necessarily imply that D ∈ Nr n CA ω (as shown in item (3) in the previous theorem). Theorem 4.4. Let 2 < n < ω. Let B be the algebra in item (3) of theorem 4.3 taking the field F to be Q. Then ∃ has a winning strategy in H ω (AtB), AtB ∈ AtNr n CA ω but B / ∈ ElNr n CA n+1 Nr n CA ω .

Proof. Fix 2 < n < ω. As in the proof of the referred to theorem, let y = {s ∈ n Q : s 0 +1 = i>0 s i }, y s be the singleton containing s, i.e. y s = {s} and B = Sg A {y, y s : s ∈ y} where A = ℘( n Q). Then as shown in op.cit, B / ∈ Nr n CA n+1 , AtB ∈ Nr n CA ω , because AtB = {{s} : s ∈ n Q} = AtA, and A ∈ Nr n CA ω .

We refer the reader the second item of theorem 4.3 for the notions of long and short hyperedges. Now we describe the winning strategy of ∃ in H ω (AtB). We start by describing ∃'s strategy dealing with λ-neat hypernetworks, where λ is a constant label kept on short hyperedges. In a play, ∃ is required to play λ-neat hypernetworks, so she has no choice about the the short edges, these are labelled by λ. In response to a cylindrifier move by ∀ extending the current hypernetwork providing a new node k, and a previously played coloured hypernetwork M all long hyperedges not incident with k necessarily keep the hyperlabel they had in M . All long hyperedges incident with k in M are given unique hyperlabels not occurring as the hyperlabel of any other hyperedge in M . In response to an amalgamation move, which involves two hypernetworks required to be amalgamated, say (M, N ) all long hyperedges whose range is contained in nodes(M ) have hyperlabel determined by M , and those whose range is contained in nodes(N ) have hyperlabels determined by N . Ifx is a long hyperedge of ∃ s response L where rng(x) nodes(M ), nodes(N ) thenx is given a new hyperlabel, not used in any previously played hypernetwork and not used within L as the label of any hyperedge other thanx. This completes her strategy for labelling hyperedges.

The winning strategy for ∃ is to play λ-neat hypernetworks (N a , N h ) with nodes(N a ) ⊆ ω such that (N a ) + = 0 (recall that (N a ) + is as defined in the proof of lemma 2.8). In the initial round, let ∀ play a ∈ At. ∃ plays a network N with N a (0, 1, . . From the above proof it is not hard to discern below its surface that if D is an atomic algebra having countably many atoms and ∃ has a winning strategy in H ω (AtD), then AtD ∈ AtNr n CA ω ; in fact a weaker game defined in theorem 5.2 forces this. For relation algebras there is an entirely analogous situation. In [8] the result alleged in [7] was accordingly weakened by replacing RaCA ω by S c RaCA ω and R ∈ RaCA ω by AtR ∈ AtRaCA ω . Here we also know that the end point RaCA ω is not elementary [17]. Like the reasoning used in item (2) of theorem 4.3, by forming the ω-dilation in L ∞,ω , together with the arguments in [7] we get the following improvement of the result in [8], cf. [ 
∩ CRRA ⊆ K ⊆ S c RaCA 5 , is not elementary. Furthermore, if ElRaCA ω S d RaCA ω , then any K such that RaCA ω ∩ CRRA ⊆ K ⊆ S c RaCA 5 , K is not elementary.

# Notions of representability and neat embeddings

Let 2 < n < ω. We know by item (3) of theorem 4.3 that Nr n CA ω S d Nr n CA ω (the algebra denoted by B in op.cit is in the latter class but not in the former one). But unlike the case with relation algebras, we do not know whether the inclusion S d Nr n CA ω ⊆ S c Nr n CA ω is proper or not. Follows is an attempt to show that it is.

Definition 5. 1. Let M be the base of a representation of A ∈ CA n . Then M is nhomogeneous if for any partial isomorphism θ having size n or less and any finite subset X of M , there is a partial isomorphism ψ extending θ with X contained within rng(ψ).

Theorem 5.2. Assume that 2 < n < ω and that A ∈ RCA n is complete and atomic having countably many atoms. If A has no n-homogeneous representation, then AtA / ∈ AtNr n CA ω and A / ∈ S d Nr n CA ω .

Sketch of proof. Fix 2 < n < ω. We first show that α = AtA / ∈ AtNr n CA ω . Assume for contradiction that α ∈ AtNr n CA ω . Let G ca be a game that is like H having a cylindrifier move and two amalgamation moves, but it is played on networks not hypernetworks. Also, in amalgamation moves ∀'s choice is restricted by choosing networks that overlap only on at most n nodes. Having at hand the assumption that AtA ∈ AtNr n CA ω , it can be proved that ∃ has a winning strategy in G ca (α). Next one builds a sequence of networks N 0 ⊆ . . . N r ⊆ ω, such that N 0 is ∃'s response to ∀'s move choosing a in the initial round. By construction this sequence of networks satisfies: (a) if N r (x) ≤ c i b forx ∈ nodes(N r ), then there exists N s ⊇ N r and a node k ∈ ω \ N r such that N s (ȳ) = b; whereȳ ≡ ix andȳ i = k, (b) ifx,ȳ ∈ nodes(N r ) such that N r (x) = N r (ȳ), then there is a finite surjective map θ extending {(x i , y i ) : i < n} mapping onto nodes(N r ) such that dom(θ) ∩ nodes(N r ) =ȳ, (c) if N r is in the sequence and θ is any partial isomorphism of N r , then there is s ≥ r and a partial isomorphism θ + of N s extending θ such that rng(θ + ) ⊇ nodes(N r ).

Let N a be the limit of such networks (defined like in the proof of the second item of theorem 4.3). Define a representation N of A having domain a∈A nodes(N a ), by S N = {x : ∃a ∈ A, ∃s ∈ S, N a (x) = s}, for any subset S of α. Then this can be checked to be by construction (using (a) and (b) and (c)) to be a complete n-homogeneous representation of A, contradiction, so α / ∈ AtNr n CA ω . A fortiori A / ∈ Nr n CA ω , but A is complete and atomic so A / ∈ S d Nr n CA ω .

Corollary 5. 3. Let R be an integral finite non-permutational RRA known to exist [7]. Let 2 < n < ω. If C n (R)(∈ RCA n ) as constructed in [14] has no n-homogeneous representation, then S d Nr n CA ω S c Nr n CA ω and non of the two classes CRCA n and S d Nr n CA ω ∩ At is contained in the other. In particular, the last two statements are true for n = 3.

Proof. From the immediately preceding (sketch of) proof, which shows that under the given hypothesis C n (R) ∈ CRCA n ⊆ S c Nr n CA ω and C n (R) / ∈ S d Nr n CA ω . Also S d Nr n CA ω ∩ At ⊇ Nr n CA ω ∩ At CRCA n (by the proof of the last item of theorem 4.3). The last part follow from the fact that if R is finite and representable having no homogeneous representation, then C 3 (R) ∈ RCA 3 is finite and it also has no 3-homogeneous representation.

Fix finite n > 2. The chapter [12] is devoted to studying the following inclusions between various types of atom structures:
CRAS n ⊆ LCAS n ⊆ SRAS n ⊆ WRAS n .
The first is the class of completely representable atom structures, the second is the class of atom structures satisfying the Lyndon conditions, the third is the class of strongly representable atom structures, and the last is the class of weakly representable atom structures, all of dimension n. It is shown in [12] that all inclusions are proper. Now one can lift such notions from working on atom structures (the frame level) to working on the (complex) algebra level restricting his attension to atomic ones. and study them in connection to neat embedding properties, baring in mind that Henkin's neat embedding theorem characterizes the class of all representable algebras and that CRCA n and S c Nr n CA ω coincide on atomic algebras with countably many atoms, theorem 4. 1.

We denote the (elementary) class of CA n s satsfying the Lyndon conditions by LCA n , the (non-elementary) class of strongly representable CA n s by SRCA n ; A ∈ CA n is strongly representable ⇐⇒ A is atomic and CmAtA is representable. Finally, the (elementary) class of weakly representable CA n s by WRCA n , which is just the class RCA n ∩ At. All such classes, by definition, consist of atomic algebras. In the following theorem Up denotes the operation of forming ultraproducts, and Ur denotes the operation of forming ultraroots.

Theorem 5. 4. Let 2 < n < ω. Then the following inclusions hold:

Nr n CA ω ∩ At ElNr n CA ω ∩ At ElS d Nr n CA ω ∩ At ⊆ ElS c Nr n CA ω ∩ At = LCA n = ElCRCA n SRCA n UpSRCA n = UrSRCA n = ElSRCA n ⊂ SNr n CA ω ∩ At = WRCA n .

Furthermore, ElL for any L of the above classes is not finitely axiomatizable. Proof. It is known [10, Proposition 2.90] that UpSRCA n = UrSRCA n = ElSRCA n . The strictness of the first inclusion follows from the fourth item of theorem 4.3 and the strictness of the second inclusion follows from the third item of theorem 4.3, respectively. We have LCA n SRCA n , because the first is elementary by definition, the second is not [11,12].

For (the remaining) equalities, we show that El(S c Nr n CA ω ∩ At) = LCA n = ElCRCA n . Plainly CRCA n ⊆ LCA n [12]. Conversely, let A ∈ LCA n . We proceed like in the proof of the last item of theorem 4. 3. We have ∃ has a winning strategy in G k (AtA) for all k ∈ ω. Using ultrapowers and an elementary chain argument, we get that A ≡ B, where B is countable and ∃ has a winning strategy in G ω (AtB). Hence B is completely representable so A ∈ ElCRCA n . Now if A ∈ S c Nr n CA ω ∩ At, then by lemma 2.8, ∃ has a winning strategy in F ω (AtA), hence in G ω (AtA), a fortiori, in G k for all k < ω, so A satsfies the Lyndon conditions. Since LCA n is elementary, we get that ElS c Nr n CA ω ∩ At ⊆ LCA n . But CRCA n ⊆ S c Nr n CA ω ∩ At by theorem 4.1, hence LCA n = ElCRCA n ⊆ El(S c Nr n CA ω ∩ At), proving the remaining equality and we are done.

For the second part on non-finite axiomatizability: In [5, Construction 3.2.76, pp.94] the non-represenatble Monk algebras are finite, hence they atomic and are outside RCA n ⊇ ElSRCA n ⊇ LCA n . Furthermore, any non-trivial ultraproduct of such algebras is also atomic and is in Nr n CA ω ⊆ ElNr n CA ω ∩ At ⊆ ElS c Nr n CA ω ∩ At ⊆ LCA n ⊆ ElSRCA n . (Witness too example 6.2, and the last paragraph in the paper for two other different non-finite axiomatizability proofs).

Fix 2 < n < ω. In the last item of theorem 4.3, we showed that there is an atomic A ∈ Nr n CA ω with uncountably many atoms such that A is not completely representable. But the ω-dilation C for which A = Nr n C is atomless. So can C be atomic? For an ordinal α, let PEA α stand for the class of polyadic algebras of dimension α [4, §5.4]. In the next theorem we show that if C ∈ PEA ω ∩ At, and A = Nr n C, then A ∈ PEA n is completely representable. This gives a plethora of completely representable PEA n s whose CA reducts are (of course) also completely representable. Recall that we write A ⊆ c B to denote that A is a complete subalgebra of B. We use that if A ⊆ c B and B is atomic, then A is atomic [10, Lemma 2.16].

Theorem 5. 5. If 2 < n < ω and D ∈ PEA ω is atomic, then any complete subalgebra of Nr n D is completely representable.

Proof. We often identify notationally set algebras with their domain. Assume that A ⊆ c Nr n D, where D ∈ PEA ω is atomic. We want to completely represent A. It suffics to show that for any non-zero a ∈ A, there is a homomorphism f : A → ℘( n U ) such that f (a) = 0, and y∈Y f (y) = n U , whenever Y ⊆ A satisfies A Y = 1. Assume for the moment (to be proved in a while) that A ⊆ c D. Then A is atomic, because D is. For brevity, let X = AtA. Let m be the local degree of D, c its effective cardinality and let n be any cardinal such that n ≥ c and s<m n s = n; such notions are defined in [21].

Assume that D = Nr ω B, with B ∈ PEA n [5, Theorem 5. 4.17]. For τ ∈ ω n, we write τ + for τ ∪ Id n\ω (∈ n n). Consider the following family of joins evaluated in B, where p ∈ D, Γ ⊆ n and τ ∈ ω n: (*) c (Γ) p = B {s τ + p : τ ∈ ω n, τ ↾ ω \ Γ = Id}, and (**): s B τ + X = 1. The first family of joins exists [21], and the second exists, because A X = D X = B X = 1 and τ + is completely additive, since B ∈ PEA n . The last equality of suprema follows from the fact that D = Nr ω B ⊆ c B and the first from the fact that A ⊆ c D. We prove the former, the latter is exactly the same replacing ω and n, by n and ω, respectivey, proving that Nr n D ⊆ c D, hence A ⊆ c D.

We prove that Nr ω B ⊆ c B. Assume that S ⊆ D and D S = 1, and for contradiction, that there exists d ∈ B such that s ≤ d < 1 for all s ∈ S. Let J = ∆d \ ω and take
t = −c (J) (−d) ∈ D. Then c (n\ω) t = c (n\ω) (−c (J) (−d)) = c (n\ω) − c (J) (−d) = c (n\ω) − c (n\ω) c (J) (−d) = −c (n\ω) c (J) (−d) = −c (J) (−d) = t.
We have proved that t ∈ D. We now show that s ≤ t < 1 for all s ∈ S, which contradicts D S = 1. If s ∈ S, we show that
s ≤ t. By s ≤ d, we have s·−d = 0. Hence by c (J) s = s, we get 0 = c (J) (s·−d) = s·c (J) (−d), so s ≤ −c (J) (−d)
. It follows that s ≤ t as required. Assume for contradiction that 1 = −c (J) (−d). Then c (J) (−d) = 0, so −d = 0 which contradicts that d < 1. We have proved that B S = 1, so D ⊆ c B.

Let F be any Boolean ultrafilter of B generated by an atom below a. We show that F will preserve the family of joins in (*) and (**). We use a simple topological argument used by the author in [21]. One forms nowhere dense sets in the Stone space of B corresponding to the aforementioned family of joins as follows. The Stone space of (the Boolean reduct of) B has underlying set, the set of all Boolean ultrafilters of B. For b ∈ B, let N b be the clopen set {F ∈ S : b ∈ F }. The required nowhere dense sets are defined for Γ ⊆ n, p ∈ D and τ ∈ ω n via: A Γ,p = N c (Γ) p \ N s τ + p ; here we require that τ ↾ (ω \ Γ) = Id, and A τ = S\ x∈X N s τ + x . The principal ultrafilters are isolated points in the Stone topology, so they lie outside the nowhere dense sets defined above. Hence any such ultrafilter preserve the joins in (*) and (**). Fix a principal ultrafilter F preserving (*) and (**) with a ∈ F . For i, j ∈ n, set iEj ⇐⇒ d B ij ∈ F . Then by the equational properties of diagonal elements and properties of filters, it is easy to show that E is an equivalence relation on n. Define f : A → ℘( n (n/E)), via x → {t ∈ n (n/E) : s B t∪Id x ∈ F }, wheret(i/E) = t(i) and t ∈ n n. It is not hard to show that f is well-defined, a homomorphism (from (*)) and atomic (from (**)), such that f (a) = 0 (Īd ∈ f (a)).

If the dilation is in QEA ω (an ω dimensional quasi-polyadic equality algebra) we have a weaker result. We do not know whether the result proved for PEA ω holds when the ωdilation is an atomic QEA ω . Let n < ω. Let D ∈ QEA ω ∩At. Assume that for all x ∈ D for all k < β, c k x = l∈β s k l x. (Such joins exist for example if D is dimension complemented in the sense that ω \∆x is infinite for all x ∈ D, where ∆x = {i ∈ ω : c i x = x}.) If A ⊆ Nr n D such that A ⊆ c D (this is stronger than A ⊆ c Nr n D), then A is completely representable. To see why, first observe that A is atomic, because D is atomic and A ⊆ c D. Accordingly, let X = AtA. Let a ∈ A be non-zero. As before, one finds a principal ultrafilter F such that a ∈ F and F preserves the family of joins c i x = D j∈β s i j x, and s D τ X = 1, where τ : ω → ω is a finite transformation; that is |{i ∈ ω : τ (i) = i}| < ω. The first family of joins exists by assumption, the second exists, since D X = 1 by A ⊆ c D and the s τ s are completely additive. Any principal ultrafilter F generated by an atom below a will do, as shown in the previous proof. Again as before, the selected F gives the required complete representation of A.


# Rainbows versus Monk-like algebras

Let 2 < n < ω. Rainbow algebras are similar to Monk-like algebras but only superficially. Suppose that A ∈ CA n is not representable. The non-representability of A amounts to that A / ∈ SNr n CA n+k for some finite k because RCA n = k<ω SNr n CA n+k . Can we 'pin down' the value of k? Roughly, the representability of an algebra can be tested by an ω-rounded game between the two players ∀ and ∃. In rainbow constructions the winning strategy's of the two players are independent, this is reflected by the fact that we have two 'independent parameters' G (the greens) and R (the reds) which are usually surprisingly simple relational structures, like finite complete irreflexive graphs or ordered structures. (We encountered these last two cases in theorems 3.1 


## and 4.3).

In Monk-like algebras winning strategy's are interlinked, one operates through the other; hence only one parameter is the source of colours, typically a certain graph G, witness example 6.2 to follow. Representability of the agebra in this case depends only on the chromatic number of G, via an application of Ramseys' theorem. In both cases two players operate using 'cardinality of a labelled graph'. ∀ trying to make this graph too large for ∃ to cope, colouring some of its edges suitably. For the rainbow case, as we have seen in the proofs of theorems 3.1 and the first and second items of theorem 4.3, it is a red clique formed during the play.

It might be clear in both cases (rainbow and Monk-like algebras), to see that ∃ cannot win the infinite game, but what might not be clear is when does this happens; we know it eventually does but how many 'pairs of pebbles' on the board, or/ and the number of rounds of the play do ∀ need to win?. In Monk algebras such numbers are determined by a large uncontrollable Ramsey number. In rainbow constructions, one has more control by varying the green parameter. The structures G and R, having any relative strength gives flexibility and more control over the rainbow game lifted from an Ehrenfeucht-Fraïssé forth-game on these structures. The number of nodes used by ∀ in the graph game, dictated by the number of pebbles pairs in the aforementioned Ehrenfeucht-Fraïssé (private) game, determines exactly when the algebra in question 'stops to be representable'; it has control over k as specfied above.

We have seen in this connection that by adjusting the number of greens in the proof of theorem 3.1 to be n + 1 one gets a finer result than Hodkinson's [13] where there were infinitely many greens. By truncating the greens to be n + 1, we could tell when SNr n CA n+k , 3 ≤ k ≤ ω 'stops to be atom-canonical'. The dimension n + k (of algebras in SNr n CA n+k ) is controlled by the number of greens num(g) that we start off with. One takes num(g) = n + 1, so that n + 3 = 2 + num(g). The number 2 is the increase in the number from passing from the number of 'pairs of pebbles' used in the private Ehrenfeucht-Fraïssé forth game EF n+1 n+1 (n + 1, n) (as defined on [10, p. 493]), to the number of nodes used in coloured graphs during the play lifted to the rainbow algebra D = CA n+1,n . The last game is the graph version of F n+3 r (AtD) some finite r ≥ n + 3. We have seen that ∀ has a winning strategy in both games; the private Ehrenfeucht-Fraïssé forth 'pebble game' using n + 1 pebble pairs, and (hence) the rainbow game, where the number of nodes used is (n + 1) + 2 excluding the existence of an n + 3-dilation of D.

In the next example we show that one can prove the weaker result that RCA n is not atom-canonical using Monk algebras based on (Monk) relation algebras and that from such a construction one recovers the non-finite axiomatizability results proved by Monk for (representable) relation and cylindric algebras of finite dimension > 2. But first a definition.

Let R be an atomic relation algebra. Let 2 < m < ω. An m-dimensional basic matrix, or simply a matrix on R, is a map f : 2 m → AtR satsfying the following two consistency conditions f (x, x) ≤ Id and f (x, y) ≤ f (x, z); f (z, y) for all x, y, z < m. For any f, g basic matrices and x, y < m we write f ≡ xy g if for all w, z ∈ m \ {x, y} we have f (w, z) = g(w, z). We may write f ≡ x g instead of f ≡ xx g. • For all f, g ∈ M and x, y < m, with f ≡ xy g, there is h ∈ M such that f ≡ x h ≡ y g.

One can construct a CA l in a natural way from an l-dimensional cylindric basis [10]. For an atomic relation algebra R and l > 3, we denote by Mat l (AtR) the set of all ldimensional basic matrices on R. Mat l (AtR) is not always an l-dimensional cylindric basis.

Example 6.2. Let G be a graph. Let ρ be a 'shade of red'; we assume that ρ / ∈ G. Let L + be the signature consisting of the binary relation symbols (a, i), for each a ∈ G ∪ {ρ} and i < n. Let T denote the following (Monk) theory in this signature:
M |= T iff for all a, b ∈ M , there is a unique p ∈ (G ∪ {ρ}) × n, such that (a, b) ∈ p and if M |= (a, i)(x, y) ∧ (b, j)(y, z) ∧ (c, k)(x, z),
x, y, z ∈ M , then |{i, j, k} > 1, or a, b, c ∈ G and {a, b, c} has at least one edge of G, or exactly one of a, b, c -say, a -is ρ, and bc is an edge of G, or two or more of a, b, c are ρ.

We denote the class of models of T which can be seen as coloured undirected graphs (not necessarily complete) with labels coming from (G ∪ {ρ}) × n by GG. Now specify G to be either:

• the graph with nodes N and edge relation E defined by
(i, j) ∈ E if 0 < |i − j| < N ,
where N ≥ n(n − 1)/2 is a postive number.

• or the ω disjoint union of N cliques, same N .

In both cases the countably infinite graphs contain infinitey many N cliques. In the first they overlap, in the second they do not. One shows that there is a countable (nhomogeneous) coloured graph (model) M ∈ GG, with the following property [13, Proposition 2.6]: If △ ⊆ △ ′ ∈ GG, |△ ′ | ≤ n, and θ : △ → M is an embedding, then θ extends to an embedding θ ′ : △ ′ → M .

Here the choice of N ≥ n(n−)/n is not haphazard; it bounds the number of edges of any graph ∆ of size ≤ n. This is crucial to show that for any permutation χ of ω ∪{ρ}, Θ χ is an n-back-and-forth system on M [18]. Like in the proof of theorem 3.1 and its preceding model-theoretic outline, the countable atomic set algebra A based on M whose top element W is obtained from n M by discarding assignments whose edges are labelled by one of nshades of reds ((ρ, i) : i < n)), is (classically) representable. The classical semantics of L ω,ω formulas and relativized semantics (restricting assignments to W ), coincide, so that A is isomorphic to a set algebra with top element n M .

So for l > 2, l finite, let A l be the atomic RCA n constructed from G l , l ∈ ω where G l has nodes N and edge relation E l defined by (i, j) ∈ E l ⇐⇒ 0 < |i − j| < N l , or a disjoint countable union of N l cliques, such that for i < j ∈ ω, n(n−1)/n ≤ N i < N j . Then CmAtA l with A l based on G l , as constructed in [18] is not representable. So (CmAtA l : l ∈ ω) is a sequence of non-representable algebras, whose ultraproduct B, being based on the ultraproduct of graphs having arbitrarily large chromatic number, will have an infinite clique, and so B will be completely representable [12,Theorem 3.6.11]. The sequence (TmAtA l : l ∈ ω) is a sequence of representable, but not strongly representable, least completely representable algebras, whose ultraproduct is completey representable. The same holds for the sequence of relation algebras (R l : l ∈ ω) constructed as in [18] for which TmAtA l ∼ = Mat n AtR l . Using a standard Los argument, this recovers Monk's classical result [16] on non-finite axiomatizability of RRAs and RCA n s. Also from the second part it follows that the elementary closure of the class of completely representable relation algebras and CA n s, namely, the class of algebras satisfying the Lyndon conditions is not finitely axiomatizable

The relation algebra R l in the above sequence is defined as follows. We fix l and we denote G l by G and R l by R. C is not representable because Cm(α(G)) is not representable and Mat n (α(G)) ∼ = AtA, where A is the atomic CA n based on G defined above. Indeed, for m ∈ Mat n (α(G)),
let α m = i,j<n α ij . Here α ij is x i = x j if m ij = Id and R(x i , x j ) otherwise, where R = m ij ∈ L.
Then the map (m → α W m ) m∈Matn(α(G)) is a well -defined isomorphism of n-dimensional cylindric algebra atom structures. Non-representability follows from the fact that G is a 'bad' graph, that is, χ(G) = N < ∞ [10, Definition 14.10, Theorem 14.11]. The relation algebra atom structure specified above is exactly like the one in Definition 14.10 in op.cit, except that we have n colours rather than just three.


## Monk algebras and the neat embedding problem

Sometimes Monk-like algebra are more handy and efficient when games used involve socalled amalgamation moves [10, The proof of Theorem 15.1], giving sharper non-finite axiomatizability results. The efficiently of the use of Monk-like algebras is witnessed in Hirsch and Hodkinson's construction used to solve [4,Problem 2.12]. In this context, Hirsch and Hodkinson do not require an (uncontrollable) Ramsey number of extra variables (dimensions) needed in proofs, which was what Monk did in his original proof of the nonfinitely axiomatizability result for RCA n (2 < n < ω) showing that SNr n CA n+k = RCA n for 2 < n < ω and k ∈ ω, but they rather require only one more than the number of colours used. By doing so the proof gives a substantially finer result, namely, that for 2 < n < ω and any positive k ≥ 1, SNr n CA n+k+1 is not even finitely axiomatizable over SNr n CA n+k .

In [6], the famous Neat embedding Problem, posed as [4,Problem 2.12] for CAs, Pinter's substitution algebras (Scs), polyadic algebras (PAs), quasi-polyadic algebras (QAs), PEAs, and QAs with equality (QEAs). For all such classes of cylindric-like algebras, the notion of neat reducts can be defined analogously to the CA case. Existing in a somewhat scattered form in the literature, equations defining Sc α , QA α and QEA α are given in the appendix of [6] for any ordinal α. It is proved in op. cit that for any class K between Sc and QEA, for any positive k, and for any ordinal α > 2, the class SNr α K α+k+1 is not axiomatizable by a finite schema over SNr n K α+k . We strengthen this result when α ≥ ω and when we have diagonal elements, namely, for any class K between CA α and QEA α . Theorem 6. 3. Let α be any ordinal > 2 possibly infinite. Then for any r ∈ ω, and k ≥ 1, there exists A r ∈ SNr α QEA α+k such that Rd ca A r / ∈ SNr α CA α+k+1 and Π r/U A r ∈ RQEA α for any non-principal ultrafilter U on ω.

Proof. The idea used here is the same idea used in [6,Theorem 3.1]. We use the same notation in op.cit. But here the result that we lift from the finite dimensional case is stronger than that obtained for finite dimensions in [6,Theorem 3.1], hence we are rewarded by a result stronger than that obtained in [6] for infinite dimensions when restricted to any K between CA and QEA.

Fix 2 < m < n < ω. Let C(m, n, r) be the algebra Ca(H) where H = H n+1 m (A(n, r), ω)), is the CA m atom structure consisting of all n + 1-wide m-dimensional wide ω hypernetworks [10,Definition 12.21] on A(n, r) as defined in [10,Definition 15.2]. Then C(m, n, r) ∈ CA m , and it can be easily expanded to a QEA m , since C(m, n, r) is 'symmetric', in the sense that it allows a polyadic equality expansion by defining substitution operations cor-responding to transpositions. 1 Furthermore, for any r ∈ ω and 3 ≤ m ≤ n < ω, C(m, n, r) ∈ Nr m QEA n , Rd ca C(m, n, r) / ∈ SNr m CA n+1 and Π r/U C(m, n, r) ∈ RQEA m by easily adapting [10,Corollaries 15.7,5.10, Exercise 2, pp. 484, Remark 15.13] to the QEA context. Take
x n = {f ∈ H n+k+1 n (A(n, r), ω); m ≤ j < n → ∃i < m, f (i, j) = Id}.
Then x n ∈ C(n, n + k, r) and c i x n · c j x n = x n for distinct i, j < m. Furthermore (*), I n : C(m, m + k, r) ∼ = Rl xn Rd m C(n, n + k, r) via the map, defined for S ⊆ H m+k+1 m (A(m + k, r), ω)), by
I n (S) = {f ∈ H n+k+1 n (A(n, r), ω) : f ↾ ≤m+k+1 m ∈ S, ∀j(m ≤ j < n → ∃i < m, f (i, j) = Id)}.
We have proved the (known) result for finite ordinals > 2.

To lift the result to the transfinite, we proceed like in [6], using a lifting argument due to Monk. Let α be an infinite ordinal. Let I = {Γ : Γ ⊆ α, |Γ| < ω}. For each Γ ∈ I, let M Γ = {∆ ∈ I : Γ ⊆ ∆}, and let F be an ultrafilter on I such that ∀Γ ∈ I, M Γ ∈ F . For each Γ ∈ I, let ρ Γ be an injective function from |Γ| onto Γ. Let C r Γ be an algebra similar to QEA α such that Rd ρ Γ C r Γ = C(|Γ|, |Γ| + k, r) and let B r = Π Γ/F ∈I C r Γ . Then we have B r ∈ Nr α QEA α+k and Rd ca B r ∈ SNr α CA α+k+1 . These can be proved exactly like the proof of the first two items in [6, Theorem 3.1]. We know from the finite dimensional case that Π r/U Rd ρ Γ C r Γ = Π r/U C(|Γ|, |Γ| + k, r) ⊆ Nr |Γ| A Γ , for some A Γ ∈ QEA |Γ|+ω = QEA ω . Let λ Γ : ω → α + ω extend ρ Γ : |Γ| → Γ (⊆ α) and satisfy λ Γ (|Γ| + i) = α + i for i < ω. Let F Γ be a QEA α+ω type algebra such that Rd λ Γ F Γ = A Γ . Then Π Γ/F F Γ ∈ QEA α+ω , and we have proceeding like in the proof of item 3 in [6, Theorem 3.1]:
Π r/U B r = Π r/U Π Γ/F C r Γ ∼ = Π Γ/F Π r/U C r Γ ⊆ Π Γ/F Nr |Γ| A Γ = Π Γ/F Nr |Γ| Rd λ Γ F Γ = Nr α Π Γ/F F Γ .
But B = Π r/U B r ∈ SNr α QEA α+ω because F = Π Γ/F F Γ ∈ QEA α+ω and B ⊆ Nr α F, hence it is representable (here we use the neat embedding theorem). Now it can be easily shown that for any K between CA and QEA, and positive k, SNr α K α+k+l is not axiomatizable by a finite schema over SNr α K α+k in the sense of [5, Definition 5. 4.12] for any l ≥ 1. In [6, Theorem 3.1], the ultraproduct was proved to be in SNr α K α+k+1 for K between Sc and QEA, a strict superset of RK α . In fact, the result here is 'infinitely stronger'. Using a Lós argument, we have RK α cannot be axiomatized by a finite schema over SNr α K α+m for any finite m ≥ 0 In [6, Theorem 3.1] the following is proved. Let α > 2. Then for any r ∈ ω, for any finite k ≥ 1, there exist B r ∈ SNr α QEA α+k , and Rd Sc B r / ∈ SNr α Sc α+k+1 such Π r/U B r ∈ SNr α QEA α+k+1 . We do not know whether we can replace SNr α QEA α+k+1 in the conclusion by RQEA α , like we did in theorem 6.3 when dealing only with CAs and QEAs.

Now we review the main result in [6] for finite dimensions. The infinite dimensional case is obtained from the finite dimensional one using the same lifting argument used in the proof of theorem 6.3, cf. [6, Theorem 3.1]. The third item in our coming theorem 6.4, which is (the main theorem) [6, Theorem 1.1] is strictly weaker than the result (for finite dimensions) used in proof of theorem 6.3, namely (using the notation op. cit), that Π r/U C(m, n, r) ∈ RQEA m (upon replacing C(m, n, r) by D(m, n, r).) The theorem is due to Robin Hirsch.

Theorem 6. 4. Let 3 ≤ m ≤ n and r < ω. 1. D(m, n, r) ∈ Nr m QEA n , 2. Rd Sc D(m, n, r) ∈ SNr m Sc n+1 , 3. Π r/U D(m, n, r) ∈ ElNr m QEA n+1 .

We define the algebras D(m, n, r) for 3 ≤ m ≤ n < ω and r < ω. The hardest part is proving (2). This is given in detail in [6, p. 211-215]. We start with. Definition 6. 5. Define a function κ : ω × ω → ω by κ(x, 0) = 0 (all x < ω) and κ(x, y + 1) = 1 + x × κ(x, y)) (all x, y < ω). For n, r < ω let ψ(n, r) = κ((n − 1)r, (n − 1)r) + 1.

This is to ensure that ψ(n, r) is sufficiently big compared to n, r for the proof of nonembeddability to work. The second parameter r < ω may be considered as a finite linear order of length r. For any n < ω and any linear order r, let Bin(n, r) = {Id} ∪ {a k (i, j) : i < n − 1, j ∈ r, k < ψ(n, r)} where Id, a k (i, j) are distinct objects indexed by k, i, j. Let 3 ≤ m ≤ n < ω and let r be any linear order. Here Bin(n, r) is an atom structure of a finite relation relation R and Forb specifies its operations by the standard procedure of specifying forbidden triples [10]. The relation algebra R; is similar (but not identical) to A(n, r) used in the first part of the proof of theorem 6.3 and D(m, n, r) is defined to be CmMat m (AtR)(∈ QEA m ).

Unlike the algebras C(m, n, r) in the proof of theorem 6.3, the algebras D(m, n, r) are now finite. It is not hard to see that 3 ≤ m, 2 ≤ n and r < ω the algebra D(m, n, r) satisfies all of the axioms defining QEA m . Furthermore, if 3 ≤ m ≤ m ′ then C(m, n, r) ∼ = Nr m C(m ′ , n, r) via X → {f ∈ F (m ′ , n, r) : f ↾ m×m ∈ X}.

Recall that in the first part of the proof of theorem 6.3, we had Π r/U C(m, n, r) ∈ RQEA m . Here we do not guarantee that the ultraproduct on r of D(m, n, r) (2 < m < n < ω) is representable. A standard Lös argument shows that Π r/U C(m, n, r) ∼ = C(m, n, Π r/U r) and Π r/U r contains an infinite ascending sequence. (Here one has to extend the definition of ψ by letting ψ(n, r) = ω, for any infinite linear order r.) The infinite algebra D(m, n, J) ∈ ElNr n QEA n+1 when J is an infinite linear order as above. Since Π r/U r is such, then we get Π r/U D(m, n, r) ∈ ElNr m QEA n+1 (⊆ SNr m QEA n+1 ), cf. [6, pp.216-217]. This suffices to show that for any K having signature between Sc and QEA, for any 2 < m < ω, and for any positive k, the variety SNr m K m+k+1 is not finitely axiomatizable over the variety SNr m K m+k .

Remark: Let Cs n denote the class of cylindric set algebras of dimension n. In theorem 3.1 for each 2 < n < ω, an atomic, countable A n ∈ Cs n was constructed such that B n = CmAtA n / ∈ SNr n CA n+3 . Using this notation, if for 2 < k < m < ω, B k ⊆ Rd m B m , then for any ordinal k ≥ 3, the variety SNr ω CA ω+k would not be atom-canonical. To see why, for each finite n ≥ 3, let A + n be an algebra having the signature of CA ω such that Rd n A + n = A n . Analogously, let B + n be an algebra having the signature of CA ω such that Rd n B + n = B n , and we require in addition that B + n = Cm(AtA + n ). As in the proof of theorem 6.3
, A = Π i∈ω A + i /F ∈ RCA ω and B = Π i∈ω B + i /F ∈ CA ω . Also, CmAtA = Cm(At[Π i∈ω A + n /F ]) ∼ = Cm[Π i∈ω (AtA + n )/F )] ∼ = Π i∈ω (Cm(AtA + n )/F ) = Π i∈ω B + n /F = B.
We now show that B is outside SNr ω CA ω+3 proving the required. Assume for contradiction that B ∈ SNr ω CA ω+3 . Then B ⊆ Nr ω C for some C ∈ CA ω+3 . Let 3 ≤ m < ω and λ : m + 3 → ω + 3 be the function defined by λ(i) = i for i < m and λ(m + i) = ω + i for i < 3. Then Rd λ C ∈ CA m+3 and Rd m B ⊆ Rd m Rd λ C. By assumption, we have B m embeds into Rd m B t whenever 3 ≤ m < t < ω, via I t say. Let ι(b) = (I t b : t ≥ m)/F for b ∈ B m . Then ι is an injective homomorphism that embeds B m into Rd m B. By the above, we have Rd m B ∈ SNr m CA m+3 , hence B m ∈ SNr m CA m+3 , too, which is a contradiction and we are done.

Rainbows versus splitting: Rainbows also offer solace, when splitting techniques as in [1] (that depend essentially on diagonal elements) do not work, to show that for 2 < n < ω, the variety RDf n cannot be axiomatized by a set of universal formulas having finitely many variable. We give an outline of the idea which is inspired by the rainbow construction for relation algebras in [10, §17.3]. Fix 2 < n < ω and finite m > 1 and let K be a class whose signature is between that of Df n and CA n . One can construct two finite simple rainbow algebras A, B ∈ CA n that satisfy the following. The n-coloured graphs (atoms) in both algebras are the same, except for the red atoms (n-coloured graphs having at least one edge labelled by a red). The rainbow signature of A has more red colours, thus A has more red atoms than B, enabling ∃ to win the game G ω (AtA) implying that A ∈ RCA n . In B there are fewer red atoms; the greens outfit the reds, so ∀ can win G ω (AtB) so that B / ∈ RCA n . Since B is generated by the set {b ∈ B : ∆b = n}, then by [5,Theorem 5.4.26], it will follow that the diagonal free reduct Rd df B is not in RDf n . Inspite of the discrepancy in the number of red atoms in A and B, to the extent that A is representable, while the (diagonal free reduct of) B is not representable, this discrepancy will not be witnessed by m-variable equations. For any assignment s : m → A, for any equation e in the signature of K using m variables, one construct an assignment s ′ : m → B by adjusting the (fewer) red atoms of B below s ′ (i) for each i < m, by putting in there 'enough' red atoms in such a way that Rd K B, s ′ |= e ⇐⇒ Rd K A, s |= e. This can be done for each m > 1. Now if Σ is any m-variable equational theory then the K reduct of A and B either both validate Σ or neither do. Since one algebra is in RK n (representable K n s) while the other is not, it follows that Σ does not axiomatize RK n . But Rd K A and Rd K B are simple algebras, so RK n has no finite variable universal prenex axiomatization because in a discriminator variety every universal prenex formula is equivalent in subdirectly irreducible (hence simple) members to an equation using the same number of variables. From this it follows that, for 2 < n < ω, there is no universal axiomatization containing finitely many variables for RDf n .

Let us see how to get the right (finite) number of reds and greens so that the above idea works. Remember that n and m are fixed; 2 < n < ω and 1 < m < ω. First one takes λ = (n × 2 m ) 3 . Then the greens for both A and B will be G = λ + 2. For A, the reds are R A = [(λ + 1) × (λ + 2)]/2 and for B the reds are R B = λ < [(λ + 1)(λ + 2)]/2. Let R be the red atoms of A and R ′ be the red atoms of B. Then |R ′ | ≥ n × 2 m . Let e an equation using m variables. Assume that s : m → A falsifies e. We define s ′ : m → B that falsifies e, too. (The converse is entirely analogous). We denote a red atom by r. Define a partition (R S : S ⊆ m) of R where R S = {r ∈ R : r ≤ s(i) ∈ S, r · s(i) : i ∈ m ∼ S}. (Here R S can be empty). Because |R ′ | ≥ n × 2 m , one can define another partition P = (R ′ S : S ⊆ m) of R ′ such that R S ⊆ s(i) ⇐⇒ R ′ S ⊆ s ′ (i) for all S ⊆ m and i < m, and using P it can be arranged that for each i < m, the number of red atoms of A under s(i) is the same as the number of atoms of B under s ′ (i) if this number is < n and both are greater than n otherwise, by putting the red atom r ′ below s ′ (i) if r ′ ∈ R ′ S for some S with i ∈ S. The other atoms are the same for both algebras. Then s ′ (i) is defined to be the sum of the atoms below it, the non-red ones being the same as the ones below s(i). Then it can be shown s ′ is as required.

Unlike 'usual rainbow constructions' where reds have double indices, here reds have single indices, so for example in B the reds are {r i : i ∈ λ}. By definition a triangle of reds (r i , r j , r k ) is consistent ⇐⇒ |{i, j, k}| = 3. The number of all other colours (uniquely determined by the red and green colours) is the same for both algebras. In the game played on coloured graphs, ∀ can force a red clique of size λ+2 and not more, by playing λ+2 cones having the same base and distinct green tints. Not to lose, ∃ has to choose a label for each edge between two successive appexes of cones, using a red colour, and she has to ensure that each edge within the clique has a red label unique to this edge, so that no triangle (within this clique) has two reds with same index. She will not succeed if the number of reds is ≤ λ, there will have to come a a round in the play where she will be forced to play an inconsistent triple of reds (r, r, r ′ ) in which case ∀ wins after a finite l(≥ λ+2) many rounds. He plays as follows: In his zeroth move, ∀ plays a graph Γ with nodes 0, 1, . . . , n − 1 and such that Γ(i, j) = w 0 (i < j < n−1), Γ(i, n−1) = g i (i = 1, . . . , n−2), Γ(0, n−1) = g 0 0 , and Γ(0, 1, . . . , n − 2) = y λ+2 . This is a 0-cone with base {0, . . . , n − 2}. In the following moves, ∀ repeatedly chooses the face (0, 1, . . . , n − 2) and demands a node t with Φ(i, t) = g i , (i = 1, . . . , n − 2) and Φ(0, t) = g t 0 , in the graph notation -i.e., an t-cone, t ≤ λ + 2, on the same base. ∃ among other things, has to colour all the edges connecting λ + 2 nodes n 0 , n 1 , . . . n λ+1 created by ∀ as apexes of cones based on the face (0, 1, . . . , n − 2) by red labels. But there are only λ red labels, so there must be 0 < i = j < λ + 2, such that in the last coloured graph Λ, Λ(n 0 , n i ) = Λ(n 0 , n j ). But (n 0 , n i , n j ) is inconsistent, so ∀ wins. The conclusion now follows. Thus Rd df B / ∈ RDf n . On the other hand, the number of reds in A is ≥ [(λ + 1) × (λ + 2)]/2, so ∃ can always choose a red label avoiding inconsistent red triangles. In this case she can cope with such red cliques 'indexed' by the green tints, hence A ∈ RCA n .


# Metalogical appplications

Throughout this section, unless otherwise indicated n is a finite ordinal. Results in algebraic logic are most attractive when they lend themselves to (non-trivial) applications in (first order) logic. In this section, we apply the hitherto obtained results on (non) atom-canonicity to (failure of) omitting types theorems for the so-called clique guarded n-variable fragments of first order logic. We start with defining the notion of clique guarded semantics. Proof. Ψ(l, ω) follows easily from the construction in [3], cf. [20, Theorem 3. 1.1]. We prove Ψ(n, n + 3). Let A be the infinitely countable, atomic and simple algebra obtained by blowing up and blurring CA n+1,n as in theorem 3. 1. We can identify A with Fm T for some countable, consistent and complete theory T (since A is simple) using n variables, and because A is atomic, T is an atomic theory, as well. Let Γ = {¬φ : φ T ∈ AtFm m,T } be the type consisting of co-atoms. Then Γ is a non-principal type. But Γ cannot be omitted in an n+3-square model for such a model necessarily gives a complete n+3-square representation of A, which gives an (ordinary) n+3-square representation of CmAtA. This in turn induces an n + 3-square representation of CA n+1,n , because CA n+1,n embeds into CmAtA. Then by lemma 7.3 ∃ has a winning strategy in G n+3 ω (AtCA n+1,n ), a fortiori in the game F ω (AtCA n+1,n ) (in only finitely many rounds) where he is allowed to use the n + 3 nodes in play. This contradicts the proof of theorem 3. 1. We have shown that Γ is realized in every n + 3 model, but it cannot be isolated by a formula using only n-variables, lest Γ will be a principal type, which is not the case. We conclude, as required, that Ψ(n, n + 3) is true. Now we prove the second item. The idea is that one blows up and blur R m in place of the Maddux algebra E k (2, 3) having k non identity atoms dealt with in [3, Lemma 5.1]. We use the notation in [3]. Fix 2 < n ≤ l ≤ m < ω. Denote R m by R. Let (J, E) be the strong m-blur of R. Since l ≤ m, (J, E) is a strong l-blur of R. Let R = Bb(R, J, E) with atom structure whose underlying set is denoted by At on [3, p.73]. Let C n = Bl n (R, J, E) ∈ CA n defined as in [3, Top of p. 78]. By l-blurness we get that for R, the set Mat l (AtR) of l by l dimensional matrices on R is an l-dimensional cylindric basis [3, Theorem 3.2] which is the atom structure of C l = Bl l (R, J, E), and by strong blurness we get by [3, item (3) p.80] that C n = Nr n C l . The algebra CmAtC n does not have an m + 1-flat representation because R embeds into CmAt(R) which embeds into RaCmAtC n . So an m + 1-dimensional flat representation of CmAtC n induces an infinite m + 1-flat representation of R. But this is impossible because by hypothesis R does not have an infinite m + 1-dimensional hyperbases. Hence C n does not have a complete m + 1-flat representation.

Like before, we can assume that C n = Fm T for a countable, atomic theory L n theory T . Let Γ be the type consisting of co-atoms of T . Then Γ is realizable in every m + 1-flat model, for if M is an m + 1-flat model omitting Γ, then it induces a complete m + 1-flat representation of Fm T = C n . Since C n ∈ Nr n CA l , then, using the argument in [3, Theorem 3.1], any witness isolating Γ needs more than l-variables. For squareness, the reasoning is the same by observing that here we have to exclude the existence of any m+1-dimensional relational basis of R even a finite one for and any finite relation algebra having an (infinite) m + 1-dimensional relational basis, has a finite one [10,Theorem 19.18]. This, in turn, excludes the existence of an m + 1-dimensional square representation of CmAtC n , since, like before R embeds into RaCmAtC n , and we are done. Now we prove differently the results on non-finite axiomatizability given in example 6.2 above. In fact, we give a finer result. Fix 2 < n < ω. For each 2 < n ≤ l < ω, let R l be the finite Maddux algebra E f (l) (2, 3) with strong l-blur (J l , E l ) and f (l) ≥ l as specified in theorem 7.4. Let R l = Bb(R l , J l , E l ) ∈ RRA and let A l = Nr n Bb l (R l , J l , E l ) ∈ RCA n , as defined on [3, pp.78] and the second part of theorem 7. 4. Then (AtR l : l ∈ ω ∼ n), and (AtA l : l ∈ ω \ n) are sequences of weakly representable atom structures that are not strongly representable with a completely representable ultraproduct. The (complex algebra) sequences (CmAtR l : l ∈ ω \ n), (CmAtA l : l ∈ ω \ n) are typical examples of 'bad' Monk (non-representable) algebras converging to a 'good' (representable) one, namely, their (non-trivial) ultraproduct. Here we also have that for 2 < n ≤ k < m < ω, A k = Nr k A m . Using a standard Los argument, this recovers Monk's and Maddux's stronger result [16,15] on non-finite axiomatizability of RRAs and RCA n s and the class of algebras satisfying the Lyndon conditions for both RRA and CA n since algebras considered are generated by a single 2-dimensional element [3,20].


# Summary of results in tabular form

Throughout this section fix 2 < n < ω.

Atom-canonicity: In the next table we address atom-canonicity for classes of relation and cylindric algebras. Such classes are defined via the operators Ra of taking relation algebras reducts, and Nr n of taking n-neat reducts, respectively. RRA denotes the class of representable RAs. In the table k ≥ 3 and m ≥ 6. It is known that SNr n CA n+1 , SRaCA 3 and SRaCA 4 are atom-canonical; the first class of CA n s admits a finite Sahlqvist axiomatization, a result of Andréka, and for the relation algebra cases, cf. [10, p.531].


## Algebras

Atom-canonical Canonical RCA n , RRA no yes SNr n CA n+2 , SRaCA 5 ? yes SNr n CA n+k , SRaCA m no, thm 3.1, [10, Thm 17.37] yes

The results in the second row are known [9,13,10,11]. The third row involves open questions. It can be shown that SRaCA 5 and SNr n CA n+2 are not atom-canonical if there exists a finite relation algebra having an n-blur (not neccessarily strong) but has no infinite n + 2-dimensional hyperbasis in the sense of [10,Definition 12.11] by using the argument in the proof of the second item of theorem 7.4. First order definability: In the next table the answers in the third column are to the question as to whether K is elementary or not. In all cases considered it is not.


## Relation algebras

Cylindric algebras ≡ S d RaCA ω ⊆ K ⊆ S c RaCA 5 S d Nr n CA ω ⊆ K ⊆ S c Nr n CA n+3 no, thm. 4.3(2), [7] RaCA ω ⊆ K ⊆ RaCA 5 Nr n CA ω ⊆ K ⊆ Nr n CA n+1 no, [17], (4) thm 4.3 We still do not know whether there is an elementary class between Nr n CA ω and S d Nr n CA ω , witness item(2) of theorem 4.3 and to the best of our knowledge whether S c Nr n CA n+k for k = 1, 2 is first order definable or not, remains so far unsettled. 2 Omitting types: In the next table the status of Ψ(l, m) and Ψ(l, m) f (as defined after lemma 7.3) is given for various values of l and m where 2 < n ≤ l < m ≤ ω. The formula Ψ(ω, ω) is the limiting case when models are ordinary and the number of variables used are ω. In the table m-hyp is short hand for infinite m-dimensional hyperbasis and m basis is short for m-dimensional relational basis (3 < m ≤ ω). VT is short for Vaught's theorem: Any countable complete atomic L ω,ω theory has an atomic countable model. Ψ(n, ω) yes, [3] Ψ(n, n + 3) yes, thm 7.4 Ψ(n, n + 2) f yes, if there is R with n-blur and no n + 2-hyp, thm 7.4 Ψ(l, ω) yes, E k (2, 3) has strong l-blur, and no ω-hyp, thm 7. 4. Ψ(l, m) f , l ≤ m − 1 yes, if there exists R with strong l-blur, and no m-hyp, thm 7.4 Ψ(l, m), l ≤ m − 1 yes, if there exists R with strong l-blur, and no m-bases, 7.4 Ψ(ω, ω) no, by VT


Furthermore, for any networks M, N if M + · N + = 0, then M ↾ nodes(M )∩nodes(N ) = N ↾ nodes(M )∩nodes(N ) , (3) if θ is any partial, finite map m → m and if nodes(N ) is a proper subset of m, then N + = 0 → (N θ) + = 0. If i ∈ nodes(N ), then c i N + = N + .


, f n−2 ) = b, nodes(M ) = nodes(N ) ∪ {k}, and M + = 0, so this property is maintained.


of the forthcoming theorem 4.3. Two other closely related (but not identical) classes are C m = {A ∈ CA n ∩ At : CmAtA ∈ S c Nr n CA m } and C at m = {A ∈ CA n ∩ At : CmAtA ∈ S c Nr n (CA m ∩ At)}. For the definitions of pseudo-elementary and pseudo-universal, the reader is referred to [10, Definition 9.1]. It known that if K is pseudo-universal =⇒ K is elementary and closed under S, cf. [10, Chapter 10] for an extensive overview of such notions.

## Theorem 4 . 3 .
43Let 2 < n < ω and let k ≥ 3.


Finally, ∀ can play an amalgamation move by picking previously played λ-neat hypernetworks M, N such that M ↾ nodes(M )∩nodes(N ) = N ↾ nodes(M )∩nodes(N ) , and nodes(M ) ∩ nodes(N ) = ∅. This move is denoted (M, N ). To make a legal response, ∃ must play a λ-neat hypernetwork L extending M and N , where nodes(L) = nodes(M ) ∪ nodes(N ). We claim that ∃ has a winning strategy in H m (AtCA Z,N ) for each finite m. The analogous proof for relation algebras is rather long [7, p.25-31].


. n − 1) = a. Then (N a ) + = a = 0. The response to the cylindrifier move is exactly like in the first part of lemma 2.8 because B is completely representable so B ∈ S c Nr n CA ω [19, Theorem 5.3.6]. For transformation moves: if ∀ plays (M, θ), then it is easy to see that we have (M a θ) + = 0, so this response is maintained in the next round. For the amalgamation (new) move, as far as the proof of lemma 2.8 is concerned, we need some preparing to do. We use the argument in[7, Lemma 34]. For each J ⊆ ω, |J| = n say, let Nr J D = {x ∈ D : c l x = x, ∀l ∈ ω \ J}. Then it can be shown, using that AtB ∈ AtNr n CA ω , that (*): for all y ∈ Nr J D, where J = {i 0 , i 1 , . . . , i n−1 }, the following holds for a ∈ α: s i 0 i 1 ...i n−1 a·y = 0 =⇒ s i 0 i 1 ...i n−1 a ≤ y. Now we are ready to describle ∃'s strategy in response to amalgamation moves. For better readability, we writeī for {i 0 , i 1 , . . . i n−1 }, if it occurs as a set, and we write sī short for s i 0 s i 1 . . . s i n−1 . Also we only deal with the network part of the game. Now suppose that ∀ plays the amalgamation move (M, N ) where nodes(M ) ∩ nodes(N ) = {ī}, then M (ī) = N (ī). Let µ = nodes(M ) \ī and v = nodes(N ) \ī. Then c (v) M + = M + and c (u) N + = M + . Hence using (*), we have; c (u) M + = sīM (ī) = sīN (ī) = c (v) N + so c (v) M + = M + ≤ c (u) M + = c (v) N + and M + · N + = 0. So there is L with nodes(L) = nodes(M ) ∪ nodes(N ) = 0, and L + · x = 0, where M + · N + = x, thus L + · M + = 0 and consequently L↾ nodes(M ) = M ↾ nodes(M ) , hence M ⊆ L and similarly N ⊆ L, so that L is the required amalgam.

## Definition 6. 1 .
1An m-dimensional cylindric basis for an atomic relaton algebra R is a set M of m-dimensional matrices on R with the following properties:• If a, b, c ∈ AtR and a ≤ b; c, then there is an f ∈ M with f (0, 1) = a, f (0, 2) = b and f (2, 1) = c


Consider the following relation algebra atom structure α(G) = ({Id} ∪ (G × n), R Id ,Ȓ, R ; ), where: The only identity atom is Id. All atoms are self converse, soȒ = {(a, a) : a an atom }. The colour of an atom (a, i) ∈ G × n is i. The identity Id has no colour. A triple (a, b, c) of atoms in α(G) is consistent if R; (a, b, c) holds (R; is the accessibility relation corresponding to composition). Then the consistent triples are (a, b, c) where: One of a, b, c is Id and the other two are equal, or none of a, b, c is Id and they do not all have the same colour, or a = (a ′ , i), b = (b ′ , i) and c = (c ′ , i) for some i < n and a ′ , b ′ , c ′ ∈ G, and there exists at least one graph edge of G in {a ′ , b ′ , c ′ }.


10, Definition 2.62, 2.65].


7, Theorem 36]: Theorem 4.5. Any class K of relation algebras, such that S d RaCA ω
This follows by observing that H is obviously symmetric in the following exact sense: For θ : m → m and N ∈ H, N θ ∈ H, where N θ is defined by (N θ)(x, y) = N (θ(x), θ(y)). Hence, the binary polyadic operations defined on the atom structure H the obvious way (by swapping co-ordinates) lifts to polyadic operations of its complex algebra C(m, n, r). In more detail, for a transposition τ : m → m, and X ⊆ H, define sτ (X) = {N ∈ H : N τ ∈ X}.
Fix 2 < n < ω. We devise an ω-rounded non-atomic game G such that if B is an atomic algebra having countably many atoms, then a winning strategy for ∃ in G(B) =⇒ B ∈ NrnCAω. This game G is
This ensures that in the limit, the constraints in N really define the element a. Assume that B ∈ CAn is atomic and has countably many atoms. Assume that ∃ has a winning strategy in G(B). Then the extra move involving non-atoms labelling matrices, ensures that that every n-dimensional element generated by B in a dilation D ∈ RCAω having base M constructed from a winning strategy in G as the limit of the λ-neat hypernetworks played during the game (and further assuming without loss that ∀ plays every possible move) is already an element of B. Here we can work in Lω,ω as a vehicle for constructing D; we do not need infinite conjunctions. In this case, we have Sg D X = Sg Nr n D X ∼ = NrnSg D X for any X ⊆ B; in particular, B = NrnD (which is stonger than AtB ∼ = AtNrnD as shown in item(3) of theorem 4.3 and theorem4.4). For k < ω, let G k be the game G truncated to k rounds. Using the argument in the proof of the second item of theorem4.3replacing H by G one shows that for 2 < n < m < ω, if there exists a countable atom structure α such that ∃ has a winning strategy in G k (Cmα) for all k ∈ ω and ∀ has a winning strategy in F m , then any class K, such that NrnCAω ⊆ K ⊆ ScNrnCAm, is not elementary. For α = AtCA Z,N and m = n + 3 it is not hard to show that ∀ has a winning strategy in G k for some finite k > 2 so this atom structure does not work here.
The clique guarded semantics |= c are defined inductively. For atomic formulas and Boolean connectives they are defined like the classical case and for existential quantifiers (cylindrifiers) they are defined as follows. ∈ Ca N, fors ∈ m M , i < m, M,s |= c ∃x i φ ⇐⇒ there is at ∈ C m (M ),t ≡ is such that M,t |= φ. We say that M is m-square, ifs ∈ C m (M ), a ∈ A, i < n, and l : n → m is an injective map, M |= c i a. M is said to be m-flat if it is m-square and for all φ ∈ L(A) m , for alls ∈ C m (M ), for all distinct i, j < m, M |= c. ∃x i ∃x j φ ←→ ∃x j ∃x i φ](s)∈ CA n , that is, there exists an injective homomorphism f : A → ℘(V ), where V ⊆ n M and s∈V rng(s) = M . Here we identify notationally the set algebra with universe ℘(V ) with its universe ℘(V ). We write M |= a(s) for s ∈ f (a). Let L(A) m be the first order signature using m variables and one n-ary relation symbol for each element in A. Then an n-clique is a set C ⊆ M such (a 1 , . . . , a n−1 ) ∈ V = 1 M for distinct a 1 , . . . , a n ∈ C. Let C m (M ) = {s ∈ m M : rng(s) is an n-clique}. Then C m (M ) is called the n-Gaifman hypergraph of M , with the n-hyperedge relation 1 M . The clique guarded semantics |= c are defined inductively. For atomic formulas and Boolean connectives they are defined like the classical case and for existential quantifiers (cylindrifiers) they are defined as follows: fors ∈ m M , i < m, M,s |= c ∃x i φ ⇐⇒ there is at ∈ C m (M ),t ≡ is such that M,t |= φ. We say that M is m-square, ifs ∈ C m (M ), a ∈ A, i < n, and l : n → m is an injective map, M |= c i a(s l(0) , . . . , s l(n−1) ), =⇒ there is at ∈ C m (M ) witht ≡ is , and M |= a(t l(0) , . . . , t l(n−1) ). M is said to be m-flat if it is m-square and for all φ ∈ L(A) m , for alls ∈ C m (M ), for all distinct i, j < m, M |= c [∃x i ∃x j φ ←→ ∃x j ∃x i φ](s).

Let R be a relation algebra, with non-identity atoms I and 2 < n < ω. Assume that J ⊆ ℘(I) and E ⊆ 3 ω. We say that (J, E) is an n-blur for R, if J is a complex n-blur and the tenary relation E is an index blur defined as in item (ii). Definition 7.2. [3, Definition 3.1. 3, Definition 3.1]. We say that (J, E) is a strong n-blur, if it (J, E) is an n-blur, such that the complex n-blur satisfies the condition (J5) n on [3, pp.79Definition 7.2. [3, Definition 3.1] Let R be a relation algebra, with non-identity atoms I and 2 < n < ω. Assume that J ⊆ ℘(I) and E ⊆ 3 ω. We say that (J, E) is an n-blur for R, if J is a complex n-blur and the tenary relation E is an index blur defined as in item (ii) of [3, Definition 3.1]. We say that (J, E) is a strong n-blur, if it (J, E) is an n-blur, such that the complex n-blur satisfies the condition (J5) n on [3, pp.79].

We need the following lemma proved in. 22We need the following lemma proved in [22].

Lemma 7.3. Let 2 < n < m < ω and A ∈ CA n . Then A has an m-flat representation ⇐⇒ A ∈ SNr n CA m and A has a complete m-square representation ⇐⇒ ∃ has a winning strategy in G m ω (AtA). Lemma 7.3. Let 2 < n < m < ω and A ∈ CA n . Then A has an m-flat representation ⇐⇒ A ∈ SNr n CA m and A has a complete m-square representation ⇐⇒ ∃ has a winning strategy in G m ω (AtA).

Ψ(l, m) f ) for short: There is an atomic, countable and complete L n theory T , such that the type Γ consisting of co-atoms is realizable in every m-square (flat) model, but any formula isolating this type has to contain more than l variables. By an m-flat model of T we understand an m-flat representation of the Tarski-Lindenbaum quotent algebra Fm T . By T atomic, we mean that the Boolean reduct of Fm T is atomic. The type Γ is defined to be {φ : (¬φ) T ∈ AtFm T }. The theory T is complete means that for any L n sentence φ in the signature of T , T |= φ or T |= ¬φ. This, in turn. Now fix 2 < n < ω. Let n ≤ l < m ≤ ω. Consider results of the following form, Ψ(l, m). is equivalent to that Fm T (∈ RCA n ) is simple (has no proper congruences), hence the following holdNow fix 2 < n < ω. Let n ≤ l < m ≤ ω. Consider results of the following form, Ψ(l, m)(Ψ(l, m) f ) for short: There is an atomic, countable and complete L n theory T , such that the type Γ consisting of co-atoms is realizable in every m-square (flat) model, but any formula isolating this type has to contain more than l variables. By an m-flat model of T we understand an m-flat representation of the Tarski- Lindenbaum quotent algebra Fm T . By T atomic, we mean that the Boolean reduct of Fm T is atomic. The type Γ is defined to be {φ : (¬φ) T ∈ AtFm T }. The theory T is complete means that for any L n sentence φ in the signature of T , T |= φ or T |= ¬φ. This, in turn, is equivalent to that Fm T (∈ RCA n ) is simple (has no proper congruences), hence the following hold:

Ψ(l, ω) and Ψ(n, n + k) are true for k ≥ 3. Ψ(l, ω) and Ψ(n, n + k) are true for k ≥ 3.

l, m + 1) is true. strictly stronger than H used in the second item of theorem 4.3, by theorem 4.4. The game is played on both λ-neat hypernetworks as defined in the proof of the second item of theorem 4.3, and complete labelled graphs (possibly by non-atoms) with no consistency conditions. The play at a certain point, like in H as in the second item of theorem 4.3, will be a λ-neat hypernetwork, call its network part X, and we write X(x) for the atom the edgex. By the network part we mean forgetting hyperedges getting non-atomic labels. An n-matrix is a finite complete graph with nodes including 0, . . . , n − 1 with all edges labelled by arbitrary elements of B. No consistency properties are assumed. ∀ can play an arbitrary n-matrix N , ∃ must replace N (0, . . . , n − 1), by some element a ∈ B; this is a non-atomic move. The final move is that. If there exists a finite relation algebra R m that has a strong m-blur, but does not have an infinite m + 1-dimensional hyperbases, then Ψ(l, m + 1) f is true. If R m has no m + 1-dimensional relational basis, then Ψ(. and pick any tuplex = (x0, . . . , xn−1) whose atomic label is ReferencesIf there exists a finite relation algebra R m that has a strong m-blur, but does not have an infinite m + 1-dimensional hyperbases, then Ψ(l, m + 1) f is true. If R m has no m + 1-dimensional relational basis, then Ψ(l, m + 1) is true. strictly stronger than H used in the second item of theorem 4.3, by theorem 4.4. The game is played on both λ-neat hypernetworks as defined in the proof of the second item of theorem 4.3, and complete labelled graphs (possibly by non-atoms) with no consistency conditions. The play at a certain point, like in H as in the second item of theorem 4.3, will be a λ-neat hypernetwork, call its network part X, and we write X(x) for the atom the edgex. By the network part we mean forgetting hyperedges getting non-atomic labels. An n-matrix is a finite complete graph with nodes including 0, . . . , n − 1 with all edges labelled by arbitrary elements of B. No consistency properties are assumed. ∀ can play an arbitrary n-matrix N , ∃ must replace N (0, . . . , n − 1), by some element a ∈ B; this is a non-atomic move. The final move is that ∀ can pick a previously played n-matrix N , and pick any tuplex = (x0, . . . , xn−1) whose atomic label is References

Complexity of equations valid in algebras of relations. H Andréka, Annals of Pure and Applied logic. 89Andréka, H., Complexity of equations valid in algebras of relations. Annals of Pure and Applied logic, 89 (1997), pp.149-209.

Cylindric-like Algebras and Algebraic Logic. H Andréka, M Ferenczi, I Németi, Bolyai Society Mathematical Studies and Springer-Verlag22H. Andréka, M. Ferenczi and I. Németi, (Editors), Cylindric-like Algebras and Algebraic Logic, Bolyai Society Mathematical Studies and Springer-Verlag, 22 (2012).

Omitting types for finite variable fragments and complete representations. H Andréka, I Németi, T. Sayed Ahmed, Journal of Symbolic Logic. 73H. Andréka, I. Németi and T. Sayed Ahmed, Omitting types for finite variable frag- ments and complete representations. Journal of Symbolic Logic. 73 (2008) pp. 65-89.

Cylindric Algebras Part I. L Henkin, J D Monk, A Tarski, North HollandL. Henkin, J.D. Monk and A. Tarski Cylindric Algebras Part I. North Holland, 1971.

Cylindric Algebras Part I. L Henkin, J D Monk, A Tarski, North HollandL. Henkin, J.D. Monk and A. Tarski Cylindric Algebras Part I. North Holland, 1985.

The neat embedding problem for algebras other than cylindric algebras and for infinite dimensions. R Hirsch, T. Sayed Ahmed, Journal of Symbolic Logic. 791R. Hirsch and T. Sayed Ahmed, The neat embedding problem for algebras other than cylindric algebras and for infinite dimensions. Journal of Symbolic Logic 79(1) (2014) pp.208-222.

∃ must respond by extending X to X ′ such that there is an embedding θ of N into X ′ such that θ(0) = x0 . . . , θ(n − 1) = xn−1 and for all i0. , , −1 ∈ N, we have X(θ(i0) . . . , θ(in−1)) ≤ N (i0. below N (0, . . . , n − 1). ∃ must respond by extending X to X ′ such that there is an embedding θ of N into X ′ such that θ(0) = x0 . . . , θ(n − 1) = xn−1 and for all i0, . . . in−1 ∈ N, we have X(θ(i0) . . . , θ(in−1)) ≤ N (i0, . . . , in−1).

Relation algebra reducts of cylindric algebras and complete representations. R Hirsch, Journal of Symbolic Logic. 722R. Hirsch, Relation algebra reducts of cylindric algebras and complete representations, Journal of Symbolic Logic, 72(2) (2007), pp.673-703.

Corrigendum to 'Relation algebra reducts of cylindric algebras and complete representations. R Hirsch, Journal of Symbolic Logic. 784R. Hirsch Corrigendum to 'Relation algebra reducts of cylindric algebras and complete representations' Journal of Symbolic Logic, 78(4) (2013), pp. 1345-1348.

Complete representations in algebraic logic. R Hirsch, I Hodkinson, Journal of Symbolic Logic. 623R. Hirsch and I. Hodkinson Complete representations in algebraic logic, Journal of Symbolic Logic, 62(3)(1997) pp. 816-847.

R Hirsch, I Hodkinson, Relation algebras by games. Studies in Logic and the Foundations of Mathematics. 147R. Hirsch and I. Hodkinson, Relation algebras by games. Studies in Logic and the Foundations of Mathematics, 147 (2002).

Strongly representable atom structures of cylindic algebras. R Hirsch, I Hodkinson, Journal of Symbolic Logic. 74R. Hirsch and I. Hodkinson Strongly representable atom structures of cylindic algebras, Journal of Symbolic Logic 74(2009), pp. 811-828

Hodkinson Completions and complete representations. R Hirsch, I , R. Hirsch and I. Hodkinson Completions and complete representations, in [2] pp. 61-90.

Atom structures of relation and cylindric algebras. I Hodkinson, I , 89Annals of pure and applied logicI. Hodkinson I., Atom structures of relation and cylindric algebras. Annals of pure and applied logic, 89 (1997), pp. 117-148.

A construction of cylindric and polyadic algebras from atomic relation algebras. I Hodkinson, Algebra Universalis. I. Hodkinson, A construction of cylindric and polyadic algebras from atomic relation algebras. Algebra Universalis, 68 (2012), p. 257-285.

Non finite axiomatizability results for cylindric and relation algebras. R Maddux, Journal of Symbolic Logic. 54R. Maddux Non finite axiomatizability results for cylindric and relation algebras, Journal of Symbolic Logic (1989) 54, pp. 951-974.

Monk Non finitizability of classes of representable cylindric algebras. J , Journal of Symbolic Logic. 34J.D. Monk Non finitizability of classes of representable cylindric algebras, Journal of Symbolic Logic 34(1969) pp. 331-343.

RaCA n is not elementary for n ≥ 5. T. Sayed Ahmed, Bulletin Section of Logic. 372T. Sayed Ahmed, RaCA n is not elementary for n ≥ 5, Bulletin Section of Logic, 37(2)(2008), pp. 123-136.

Weakly representable atom structures that are not strongly representable, with an application to first order logic. T. Sayed Ahmed, Mathematical Logic Quarterly. 543T. Sayed Ahmed, Weakly representable atom structures that are not strongly rep- resentable, with an application to first order logic, Mathematical Logic Quarterly, 54(3)(2008) pp. 294-306

Neat reducts and neat embeddings in cylindric algebras. T. Sayed Ahmed, T. Sayed Ahmed, Neat reducts and neat embeddings in cylindric algebras, in [2], pp. 105-134.

Ahmed Completions, Complete representations and Omitting types. T. Sayed Ahmed Completions, Complete representations and Omitting types, in [2], pp. 186-205.

The class of completely representable polyadic algebras is elementary. T. Sayed Ahmed, 72Algebra UniversalisT. Sayed Ahmed, The class of completely representable polyadic algebras is elemen- tary. Algebra Universalis, 72 (2014), pp. 371-380.

Ahmed On notions of representability for cylindric-polyadic algebras and a solution to the finitizability problem for first order logic with equality. T Sayed, Mathematical Logic Quarterly. in pressT. Sayed Ahmed On notions of representability for cylindric-polyadic algebras and a solution to the finitizability problem for first order logic with equality. Mathematical Logic Quarterly, in press.

On neat reducts of algebras of logic. T Sayed Ahmed, I Németi, Studia Logica. 682T. Sayed Ahmed and I. Németi, On neat reducts of algebras of logic, Studia Logica. 68(2) (2001), pp. 229-262.