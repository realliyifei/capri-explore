# Calibration plots for multistate risk predictions models: an overview and simulation comparing novel approaches

CorpusID: 261214798
 
tags: #Mathematics

URL: [https://www.semanticscholar.org/paper/b3686da7b9d87ea45044b1b10276a25be8af393e](https://www.semanticscholar.org/paper/b3686da7b9d87ea45044b1b10276a25be8af393e)
 
| Is Survey?        | Result          |
| ----------------- | --------------- |
| By Classifier     | False |
| By Annotator      | (Not Annotated) |

---

Calibration plots for multistate risk predictions models: an overview and simulation comparing novel approaches


Alexander Pate 
Centre for Health Informatics, Imaging and Data Science
Faculty of Biology, Medicine and Health
University of Manchester
Manchester Academic Health Science Centre
ManchesterUnited Kingdom

Matthew Sperrin 
Centre for Health Informatics, Imaging and Data Science
Faculty of Biology, Medicine and Health
University of Manchester
Manchester Academic Health Science Centre
ManchesterUnited Kingdom

NIHR Manchester Biomedical Research Centre
University of Manchester
ManchesterUK

Richard D Riley 
Institute of Applied Health Research
University of Birmingham
BirminghamUK

Niels Peek 
Centre for Health Informatics, Imaging and Data Science
Faculty of Biology, Medicine and Health
University of Manchester
Manchester Academic Health Science Centre
ManchesterUnited Kingdom

NIHR Manchester Biomedical Research Centre
University of Manchester
ManchesterUK

Tjeerd Van Staa 
Centre for Health Informatics, Imaging and Data Science
Faculty of Biology, Medicine and Health
University of Manchester
Manchester Academic Health Science Centre
ManchesterUnited Kingdom

Jamie C Sergeant 
Centre for Epidemiology Versus Arthritis
Centre for Musculoskeletal Research
Manchester Academic Health Science Centre
University of Manchester
ManchesterUK

Centre for Biostatistics
Manchester Academic Health Science Centre
University of Manchester
ManchesterUK

Mamas A Mamas 
Keele Cardiovascular Research Group
Keele University
Stoke-on-TrentUK

Gregory Y H Lip 
Liverpool Centre for Cardiovascular Science at University of Liverpool
Liverpool John Moores University and Liverpool Heart & Chest Hospital
LiverpoolUnited Kingdom

Department of Clinical Medicine
Aalborg University
AalborgDenmark

Martin O&apos;flaherty 
NIHR Applied Research Collaboration NW Coast
University of Liverpool
LiverpoolUK

Michael Barrowman 
NIHR Applied Research Collaboration NW Coast
University of Liverpool
LiverpoolUK

Iain Buchan 
Institute of Population Health
Faculty of Health and Life Sciences
University of Liverpool
LiverpoolUK

Glen P Martin 
Centre for Health Informatics, Imaging and Data Science
Faculty of Biology, Medicine and Health
University of Manchester
Manchester Academic Health Science Centre
ManchesterUnited Kingdom

Calibration plots for multistate risk predictions models: an overview and simulation comparing novel approaches
1 This version of the manuscript is currently under review with a statistical journal and is therefore subject to change. Please search for a published version of this manuscript before reading this. 11. Independent Researcher, Manchester, United Kingdom 2
IntroductionThere is currently no guidance on how to assess the calibration of multistate models used for risk prediction. We introduce several techniques that can be used to produce calibration plots for the transition probabilities of a multistate model, before assessing their performance in the presence of non-informative and informative censoring through a simulation.MethodsWe studied pseudo-values based on the Aalen-Johansen estimator, binary logistic regression with inverse probability of censoring weights (BLR-IPCW), and multinomial logistic regression with inverse probability of censoring weights (MLR-IPCW). The MLR-IPCW approach results in a calibration scatter plot, providing extra insight about the calibration. We simulated data with varying levels of censoring and evaluated the ability of each method to estimate the calibration curve for a set of predicted transition probabilities. We also developed evaluated the calibration of a model predicting the incidence of cardiovascular disease, type 2 diabetes and chronic kidney disease among a cohort of patients derived from linked primary and secondary healthcare records.ResultsThe pseudo-value, BLR-IPCW and MLR-IPCW approaches give unbiased estimates of the calibration curves under non-informative censoring. These methods remained unbiased in the presence of informative censoring, unless the mechanism was strongly informative, with bias concentrated in the areas of predicted transition probabilities of low density.ConclusionsWe recommend implementing either the pseudo-value or BLR-IPCW approaches to produce a calibration curve, combined with the MLR-IPCW approach to produce a calibration scatter plot, which provides additional information over either of the other methods.

## Introduction

Clinical prediction models are used to guide clinical decision making in a variety of settings. 1-9 A multistate model may be used when the outcome of interest can potentially be reached via intermediate health states deemed important to include in the model, or may help improve prediction. 10 For example, when modelling the co-development of multiple long-term conditions (multimorbidity), [11][12][13] once an intermediate state has been developed (such as type 2 diabetes), this may increase the risk of developing further conditions (such as cardiovascular disease). Multistate models are used in a variety of clinical settings. [14][15][16][17][18] Evaluation of the performance of a prediction model, through a validation study, is essential before it can be used in practice. 19 Model evaluation should routinely involve assessment of calibration and discrimination, [20][21][22] or other relevant techniques such as decision curve analysis, 23,24 measures of explained variation ( 2 statistics) or the Brier score. 25 The calibration of a model is evaluated by how well the estimated risks from the model agree with the observed event rates in a cohort of interest. Best practice for assessing calibration of a model predicting continuous, binary, polytomous or survival outcomes is well established, 20-22,26-36 with a (flexible) calibration plot being the preferred approach. Methods for evaluating the calibration of multi-state models are not well established. Titman and Sharples suggested comparing the risk of entry into an absorbing state (of a multistate model) with a Kaplan Meier estimate. 37 Spitoni et al.,38 illustrated the estimation of prediction errors based on the Brier score, and Van Geloven et al. 29 reviewed methods for assessing calibration of a competing risks model (special case of a multistate model).

We reviewed a sample of studies published since 2017 involving the development of a multistate model for prediction. In studies that did assess model calibration, a wide range of approaches were taken. Postmus et al., 39 compared the mean predicted risk of death (the primary state of interest) with mean observed survival calculated through a Kaplan Meier estimator, within subgroups defined by predicted risk. Beyer et al., 40 analyse trial data, and compare the predicted value of overall survival from their multistate model with a Kaplan Meier estimate of overall survival within each trial arm. Deschepper et al. 41 compared predicted vs observed bed occupancy (state of interest), possible due to the lack of censoring. These approaches are valid but do not allow generation of calibration curves. Calibration was not assessed in most studies that were identified. [11][12][13][42][43][44] The lack of validation applied in practice may be due in part to the lack of guidance on model validation for multistate models.

In this paper, we detail how to assess calibration of the predicted transition probabilities from a multistate model using a variety of methods, focusing on methods that can produce calibration plots (Section 2). In Section 3, we compare the performance of such methods in a simulation study, and demonstrate their use in a clinical example in Section 4.


## Methods for assessing calibration 2.1. Preliminaries

Let ( ) be a multistate survival process with states, where ( ) = if an individual is in state at time . Assume a multistate model has been developed to predict ( ) using a set of predictor variables (e.g., one available in the literature, which we now aim to externally validate). Transition probabilities, , ( , ), are the probability of being in state at time , when in state at time . Transition probabilities are agnostic to the path taken between and and any number of intermediate states may have been visited (i.e., we are not only interested in 'direct' transitions, which is the case for competing risks). Let be the censoring time, such that ( ) is only observed for < . Here, the aim is to assess the calibration of the estimated transition probabilities ̂, ( , ) in a cohort of interest. 45 We consider cohorts where all individuals start in the same initial state. We restrict our assessment to the calibration of transition probabilities out of the initial state ( = 1), made at the start of follow up ( = 0). These two conditions are relevant to most clinical applications reported in the literature. Given this setting, we reduce the notation of the predicted transition probabilities to ̂( ). How to utilise landmarking 46,47 to evaluate calibration when these requirements do not hold is discussed in Section 4.

Four categories of calibration have previously been described: 35 1) Mean calibration (or calibrationin-the-large) where "the average predicted risk is compared with the overall event rate". 2) Weak calibration where "on average, the model does not over-or underestimate risk, and does not give overly extreme (too close to 0 and 1) or modest (too close to disease prevalence or incidence) risk estimates". This is assessed using calibration intercept and slope. 3) Moderate calibration where the estimated risks correspond to observed proportions across the entire range of predicted risk. This would generally be assessed using flexible calibration curves, 27,28,32 where the observed event rate is plotted against the predicted risk. 4) Strong calibration requires "predicted risk corresponds to the observed proportion for every possible combination of predictor values", and is rarely considered in practice.

In sections 2.2 -2.5, we detail a range of methods that can be used to assess the calibration of the transition probabilities out of the initial state in a multistate model. We focus on calibration plots, but details are also provided on how to assess mean and weak calibration.


### Aalen-Johansen estimator

The Aalen-Johansen estimator 48 is an estimator for the transition probability matrix of a nonhomogeneous Markov process (a generalisation of the Kaplan Meier estimator to multistate survival data). This can be used to estimate the observed risk of each state in the cohort of interest, ( ). The mstate 49 package can be used to derive the Aalen-Johansen estimator.

Mean calibration using this estimator is assessed by comparing the mean predicted transition probability with the observed risk for each outcome category:
(∑ ( ) −̂( ) =1 )⁄ ,
where ̂( ) is the predicted transition probability for individual . This estimator makes the assumptive of non-informative censoring. In the presence of informative censoring, we recommend calculating the Aalen-Johansen estimator within sub-groups of individuals defined by the predicted transition probability of each state and taking the average. Specifically, for each category , order individuals by predicted transition probability of category , split into equally sized groups, within each group calculate the Aalen-Johansen estimator, take the average and subtract the mean predicted transition probability in the cohort. This relaxes the non-informative censoring assumption, to non-informative censoring after conditioning on the predicted transition probabilities. Moderate calibration is assessed by comparing the Aalen-Johansen estimator and average predicted transition probability within each sub-group. Importantly, the Aalen-Johansen approach does not allow the estimation of calibration curves and therefore the approach is not recommended. However, knowledge of this estimator is required to motivate the pseudo-value approach given in Section 2.3.

Finally, a discussion of the Markov assumption is required. In general, the Aalen-Johansen estimator is only a consistent estimator under the Markov assumption for the multistate process ( ), which means at all times "given the present state and the event history of a patient, the next state to be visited and the time at which this will occur will only depend on the present state". 10 However, it can be shown through the work of Datta and Satten 50 and Glidden, 51 that in this specific setting (all individuals start in the same initial state), that the Aalen-Johansen estimator gives a consistent estimate of the transition probabilities out of this initial state. Therefore Estimators which do not depend on the Markov assumption 52-55 are not required here. A full line of reasoning is given in Supplementary Material part 1.


### Pseudo-values

Pseudo-values enable estimation of estimands that can be expressed as an expectation when analysing censored survival data. 56 The pseudo-value itself denotes the contribution of each individual to the expectation that is being estimated. If ̂ is such an estimator, the pseudo-value for individual is defined as:
̂= * ̂− ( − 1) * ̂− ,
where ̂− is the estimator ̂ calculated in the cohort with individual removed. For more details on pseudo-observations, and the required properties of the estimator ̂ and estimand , see the work of Andersen and Perme. 56 Pseudo-values for the transition probabilities from a multistate model can be calculated using the Aalen-Johansen estimator. 57 Let ̂( ) be the vector of pseudo-values for individual at time , where ̂( ) is the pseudo-value for the transition to state . Moderate calibration for each state can be evaluated by regressing the pseudo-values on the predicted transition probabilities using a loess smoother:
̂( ) = (̂( )).
(1)

Other models and link functions could also be used. 56 Observed probabilities ̂, ( ) can then be obtained by generating fitted values for each individual in the validation cohort from model (1). The set of points {̂( ),̂, ( )} gives the calibration plot for state .

The estimates of calibration derived using pseudo-values are based on the same assumptions as the underlying estimator ̂. For example, when ̂ is the Aalen-Johansen estimator, censoring must be non-informative. However, if the censoring mechanism and outcome are conditionally independent given some variables , then the pseudo-values will be valid if calculated within subgroups defined by . 56 We therefore suggest calculating pseudo-values within subgroups defined by the predicted transition probabilities. Specifically, for each state , order individuals by ̂( ) and split into groups (say deciles or ventiles). Within each group, calculate ̂ using the Aalen-Johansen estimator and extract ̂( ). Note that the ordering of individuals may be different for each state . All individuals are then recombined into a single dataset when fitting model (1).

The mean calibration for each outcome category can be calculated as the average difference between the pseudo-values and predicted transition probabilities:
(∑̂( ) −̂( ) =1 )⁄
To assess weak calibration, fit the following linear regression model:
̂( ) = * ̂( ),
and report the calibration slope ̂.

2.4. Binary logistic recalibration using inverse probability of censoring weights (BLR-IPCW)

Barrowman et al., 15 first proposed evaluating the calibration of ̂( ) by estimating calibration intercepts and slopes (at a given time point ) using binary logistic regression calibration techniques 58,59 and inverse probability of censoring weights. We extend the approach to assess moderate calibration using calibration curves.

Let ( ) be an indicator variable indicating whether an individual is in state at time (for all individuals uncensored at time ). The indicator ( ) can be modelled in the validation cohort using a loess smoother 32 :
( ) = (̂( )).(2)
Fitted values ̂, ( ) can then be generated for each individual in the validation cohort using

Model (2), and the set of points {̂( ),̂, ( )} results in the calibration plot for state . Other models could be used to model the relationship between ( ) and ̂( ), such as a binary logistic regression model (after applying logit transformation to ̂( )) with multiple fractional polynomials 60 or restricted cubic splines. 20

In the absence of censoring, the above approach would allow us to estimate the estimand of interest, which is the observed event probabilities for state among individuals with a predicted transition probability of ̂( ):
( ( ) = |̂( ))
However, in the presence of censoring this can only be done in the subgroup of the population which is uncensored at time . The assessment of calibration will be biased by censoring (induces selection bias) unless the censoring mechanism is independent from everything else. The calibration Model (2) must therefore be fitted using data reweighted according to inverse probability of censoring weights 25,61 (IPCW) to obtain valid estimates. The weights are calculated as the inverse of the probability that an individual has not been censored by time point :
= 1 ( > | , ( )) ,
where is a vector of baseline covariates, and ( ) denotes the position of the multistate process at time , and information on any previous transition times. The inclusion of ( ) reflects that if an individual enters an absorbing state at time < , the weight for this individual is the probability of being uncensored at time , as opposed to time . Specifically: ( > | , ( )) = ( > | ) if ( ) is in an absorbing state, and ( > | , ( )) = ( > | ) otherwise. In the presence of an absorbing state, it is therefore imperative to apply IPCWs even when censoring is non-informative. These weights should be estimated from the data by modelling the time until censoring occurs.

To assess mean calibration, one would fit the following model:
[ ( )] = + * (̂( )),(3)
fixing to 1. The estimate ̂ (calibration intercept) gives an assessment of mean calibration on the logit scale. We recommend the following steps to transform this onto the probability scale, in line with those from Sections 2.2 and 2.3. Calculate observed event probabilities by generating fitted values from Model (3):
̂− , ( ) = −1 (̂+ (̂( )))
The mean calibration for state can then be estimated as the mean difference between the observed event probabilities and the predicted transition probabilities:
(∑̂− , ( ) −̂( ) =1 )⁄ .
To assess weak calibration, one fits Model (2) with no constraints to calculate the calibration slope, ̂, where values less than 1 indicate overfitting. The outcome ( ) is then modelled using a multinomial logistic regression with a vector spline smoother: Note that unlike MLR-IPCW, the BLR-IPCW and pseudo-value approaches ignore the multistate aspect of the data and treat each outcome category with a 'one vs all' approach. This means the observed event probabilities for an individual will only sum to 1 when using the MLR-IPCW approach. Furthermore, the calibration plots for MLR-IPCW are a scatter plot, reflecting the fact that individuals with the same predicted transition probability of state , may have different predicted transition probabilities of the other states, and in turn different observed event probabilities. This approach can therefore provide more insight into the calibration of a model over the BLR-IPCW and pseudo-value approaches.
ln [ ( ( ) = ) ( ( ) = 1) ] = + ∑ ,ℎ * (̂ℎ) ℎ=2 ,(4)
To assess mean calibration, one would fit the following multinomial logistic regression model in the validation cohort:
ln [ ( ( ) = ) ( ( ) = 1) ] = + * ̂ ,(5)
where the coefficients are fixed to 1. The estimated ̂ constitute the calibration intercepts from the calibration framework of Van Hoorde et al. 33 To get this estimate of mean calibration onto the probability scale, we again calculate observed event probabilities by generating fitted values from Model (4) for each individual in the validation cohort using the following formulae:
̂1 − , ( ) = 1 1 + ∑ exp(̂+̂) =2 ̂− , ( ) = exp(̂+̂) 1 + ∑ exp(̂+̂) =2
The mean calibration for state can then be calculated as the mean difference between the observed event probabilities and the predicted transition probabilities:
(∑̂− , ( ) −̂( ) =1 )⁄ .
To assess weak calibration, fit Model (5) with no constraints and calculate the calibration slopes ̂.


## Simulation

The methods are presented using the Aims, Data generating mechanisms, Estimands, Methods and Performance (ADEMP) structure. 63 All code for running the simulation is available on GitHub. 64 


### Aims

The primary aim was to compare the bias (and variability) of each of the calibration methods outlined in Section 2 when the assumption of non-informative censoring does and does not hold.


### Data generating mechanisms


#### Underlying structures

Data was generated using the multistate model structure in Figure 1. This was designed to mimic the clinical setting from Putter et al., 16 predicting local recurrence (state 2), distant metastasis (state 3), local recurrence + distant metastasis (state 4), and death (state 5), after surgery (state 1) in patients with early stage breast cancer.

We first generated two baseline predictor variables 1 and 2 , both drawn from a standard Gaussian distribution. The survival times for transition → were simulated from an exponential distribution with hazard (0.5 * 1 − 0.5 * 2 ) * , . The predictor 1 represents a variable associated with higher risk of remission and/or death, and 2 represents a variable associated with lower risk of remission and/or death. The baseline hazard for each transition ( , ) was chosen so that the 7-year survival matched that of the cause-specific hazard reported by Putter et al. 16 The targeted values for each transition (and corresponding values of , ) are provided in Table 1. 7-year survival was targeted as this was the maximum follow up observed for all transitions. The censoring time was generated from an exponential survival distribution with hazard ( ,1 * 1 + ,2 * 2 ) * . The value of = 5005 was chosen to induce a censoring probability of 0.4 over 7 years for individuals with 1 = 2 = 0. An uninformative censoring scenario (UIC) was induced by setting  


#### Process for simulation

Large validation sample ( = 200,000) and small validation sample ( = 3000, = 1500) simulations were carried out for each scenario (NIC, WIC and SIC). Bias (bias and variance) of the calibration assessment was evaluated in the large (small) validation sample analysis. A sample size of 3000 was chosen to match the sample size used in the work of Putter et al. 16 A sample size of 1500 was chosen to test small sample performance even further. Sample size criteria do not yet exist for multistate models, 65 but would be dependent on the event rates of all the possible transitions. With this data generating mechanism some of the transitions are rare (approximately 2% of individuals are in state 4 after 7 years). We therefore believe 1,500 should be considered a very low sample size.

The large validation sample simulation followed the following steps for each scenario:

1. Generate a validation dataset of size = 200,000 according to the relevant data generating mechanism.

2. Calculate the true transition probabilities for each individual at 7 years follow-up, (7).

3. Define ̂, = as a perfectly calibrated estimate of the transition probabilities. Define ̂, = −1 ( ( ) + 0.5) and ̂, = −1 ( ( ) − 0.5) as miss-calibrated over and under estimates of the transition probabilities.


## Assess mean and moderate calibration of ̂,

, ̂, and ̂, in the dataset using each of the calibration approaches (section 3.4).


## Compare calibration to true calibration (estimand, Section 3.3) for moderate and mean calibration.

For the small sample simulation, a cohort of size 1,000,000 was generated. Cohorts of size 3000 or 1500 were then sampled at random (without replacement) and Steps 2 -5 were implemented. For

Step 5 mean calibration was assessed. This process was repeated 1,000 times. This represents the process of validating the model in a cohort sampled randomly from the population of interest.


### Estimands and other targets

The estimand of interest is the calibration of the predicted transition probabilities defined in the previous section (̂, , ̂, and ̂, ). Let ̂ represent any of ̂, , ̂, and ̂, . Let be the 'true' transition probabilities from state 1 to state for individual used in the data generating mechanism. These can be calculated from the specified cause specific hazards in section 3.2.1 following Putter et al. 10 The exact process and formulae for doing so is provided in Supplementary Material 1. When assessing moderate calibration, the estimand is the set of points {̂, }. When assessing mean calibration, the estimand of interest is the average difference between the predicted transition probabilities and true transition probabilities:
(∑ −= 1 )⁄ .
Note that the estimand is a function of both the 'true' transition probabilities used to generate the data and the predicted transition probabilities. In practice the predicted transition probabilities (̂) would be estimated by fitting a multistate model, however in this simulation they have been defined deterministically. The manner in which ̂, and ̂, were generated will result in a nonlinear calibration curves, desirable when assessing the ability of the proposed methods to evaluate moderate calibration.


### Methods for analysis

When assessing moderate calibration, we compared the BLR-IPCW, MLR-IPCW and pseudo-values based on Aalen-Johansen estimator. The Aalen-Johansen estimator was not considered given it cannot estimate the estimand ({̂, }). When assessing mean calibration we compared BLR-IPCW, MLR-IPCW and the Aalen-Johansen estimator. The pseudo-value approach was not considered as the only advantage of the pseudo-value approach over the Aalen-Johansen estimator is that it enables the estimation of calibration curves. For the pseudo-value and Aalen-Johansen approaches, individuals were grouped into 20 groups based on their risk of state in order to assess calibration, as outlined in Sections 2.2 and 2.3. We apply this extra step in the NIC scenario, even though this would not be required in practice if the censoring mechanism is known to be non-informative.

We also conducted sensitivity analyses to assess the sensitivity of BLR-IPCW and MLR-IPCW to the calculation of the weights. For the main implementation of BLR-IPCW and MLR-IPCW, the weights were estimated from the data using a perfectly specified Cox model which adjusted for 1 and 2 . A second analysis was carried out using a misspecified Cox model for the time until censored which didn't adjust for 1 and 2 . A third analysis used the true weights, where the probability of being censored was calculated based off the data generating mechanism. A fourth analysis did not apply weights at all.


### Performance metrics

In the large sample simulation, for moderate calibration bias was assessed by graphically comparing the estimated calibration curves from each method vs the true calibration curve represented by the set of points {̂, }. For mean calibration the bias and standard error of the estimated mean calibration was reported for each method. Standard errors were calculated using bootstrapping, although we do not report the standard error for the Aalen-Johansen approach for computational reasons, given it is expected to be very small anyway. For the small sample simulation, we report the median bias and 2.5 -97.5 percentile range (across the 1000 simulation iterations) in the bias of the mean calibration estimate.  ) in scenario NIC (blue lines), against the calibration plot produced by using BLR-IPCW to assess calibration. Equivalent plots for the pseudovalue and MLR-IPCW approaches are provided in the supplementary material ( Figures S1 and S2). These Figures showcase the ability of each method to appropriately assess non-linear changes in calibration over the distribution of predicted transition probabilities. All methods provide an unbiased assessment of the calibration when censoring is non-informative. There are some minor deviations from the true calibration for states 2, 3 and 4, for which the predicted transition probabilities are much smaller, highlighting a bigger sample size is required to assess moderate calibration of rarer states. Variability in calibration estimates is considered in the small validation sample simulation. The variance in the points in the MLR-IPCW scatter plot for each state is very small. This is due to a lack of variability in the predicted transition probabilities of the other states. The added information provided by this approach is therefore not evident from the simulation. We refer to the clinical example (Section 4) for an illustration of the MLR-IPCW approach where the scatter plot is more varied, and discuss the benefits of this approach in more detail there. It also appears there is a small number of data points where calibration is biased over dense regions of predicted transition probability (e.g. state 4 in Figure 4), in contrary to the arguments in the previous paragraph. However, this is due to the multidimensional nature of these calibration plots. These points represent a small group of individuals who have the same predicted transition probability of state 4 as many other individuals, but have predicted transition probabilities of the other states which few people do. Therefore this is in fact a sparse area of predicted transition probability with respect to the other states.

We tested the sensitivity of the BLR-IPCW and MLR-IPCW approaches to miss-specification of the censoring distribution ( Figures S7 -S24). This resulted in a small increase in the bias of these methods, however the calibration was still unbiased over a large range of the predicted transition probabilities, indicating some protection against misspecification of the censoring distribution. 


## [INSERT Figure 2: Moderate calibration of BLR for perfectly calibrated transition probabilities (̂, ), over predicting transition probabilities (̂, ) and under predicting transition


#### Large sample simulation: mean calibration

When there is no informative censoring (NIC), all methods give an unbiased estimate of the mean calibration ( Figure 5). WIC starts to introduce bias into the mean calibration of the BLR-IPCW and MLR-IPCW approaches for states 1 and 5. When large levels of informative censoring are introduced (SIC) the bias increases further, whereas the Aalen-Johansen approach remained unbiased. Comparing this to the moderate calibration plots (Figures 4, S5 and S6), indicates the bias in the mean calibration is driven by a small number of outliers. Bias is only found for states 1 and 5 because increasing 1 or 2 only has a minor impact on the probability of being in states 2, 3 and 4. A change in 1 or 2 will increase or decrease the hazard for transitions both into and out of intermediate states.

For example, an increase in 1 increases the rate of entry into state 2, but also increases the rate at which individuals leave state 2, having a net zero effect. This highlights that the issue of informative censoring may be present for some states but not others. We tested the sensitivity of the BLR-IPCW and MLR-IPCW approaches to misspecification of the weights (Figures S25 and S26). Misspecification of the weights had a minor effect on the bias, however implementing either approach without weights greatly increased the bias.


#### Small sample simulation: mean calibration

The results from the small sample simulation (N = 3000) are presented in Figure 6. In scenarios NIC and WIC all methods performed very similarly. For SIC there were some differences in performance for prediction of states 1 and 5, the states where informative censoring was at its strongest. The magnitude of bias was similar for AJ, BLR-IPCW and MLR-IPCW (although sometimes in opposite directions), but the variation in estimates was much bigger for the AJ approach. Reducing the number of groups patients are categorised into before evaluating calibration only had a minor impact on reducing this variation ( Figures S27 and S28). We aimed to demonstrate the application of each calibration method to typical clinical data and 3

contrast the levels of information provided by each method. We developed an illustrative (not 4

intended for clinical use) multistate model to predict the 10-year risk of co-existence of three long-5 term conditions, cardiovascular disease, type 2 diabetes and chronic kidney disease, in healthy 6

individuals -a common and important multimorbidity state in which the develop of one condition 7

increases the probability of the development of the other conditions. The clinical and economic 8

impact of multimorbidity is high and rising in many parts of the world, [66][67][68][69][70][71][72][73][74][75] and preventing it is a 9

priority for health systems. 10


### Methods


## 11

Data source: Data from the Clinical Practice Research Datalink (CPRD) Aurum, a primary care dataset 12

containing data from general practices with the EMIS Web® computer systems in England and 13

Northern Ireland, was used is this study. CPRD Aurum contains > 39 million historical patients, and > 14 13 million currently registered. It is representative of the English population in terms of age, gender, 15 geographical spread and deprivation (as of 2019). 76 These records were linked to Hospital Episode 16

Statistics (HES) and deaths data from the Office for National Statistics (ONS). 17

Start of follow up was defined as the maximum of date turned age 65, 1 st Jan 2000, and date of 1 18

year of up to standard registration in the database. Inclusion in the cohort was dependent on these 19

three conditions being met. Patients were excluded if they had any of the outcomes prior to start of 20 follow up. Censoring was defined as last date of data collection for the practice, or date transferred 21 out of practice, which should be an uninformative censoring mechanism. 22

We extracted the transition times for the outcomes of incident cardiovascular disease, type 2 23 diabetes and chronic kidney disease (stage 3, 4 or 5), multimorbidity and death (Figure 7). There was 24 a transition from every possible state to death. Outcome events were identified through the primary 25 care, secondary care and death record data sources. Baseline data was extracted solely from the 26 primary care record. for all baseline variables were fitted for each cause-specific hazard depicted in Figure 7. Note it was 41 also possible that individuals were diagnosed with two conditions on the same date (i.e. transition 42 from state 1 straight to state 5). However, we do not believe these transitions to be representative 43 of the true underling disease process (long term conditions were likely developed at different times 44 and only recorded in database once the patient engaged with the health system). The number of 45 individuals who made these transitions was also small. We therefore modelled the cause-specific 46 hazard for these transitions using a Kaplan Meier estimator and make no adjustment for baseline 47

predictors. 48

After model development, transition probabilities were estimated for every patient in the validation 49 cohort following the process of Putter et al., 10 and de Wreede et al. 49 The censoring distribution was 50 estimated using a Cox proportional hazards model adjusting for all baseline covariates. This model 51 was used to estimate each individuals probability of being censored at 10-years, which were 52 converted into IPCWs (capped at a maximum weight of 10 77 ). For individuals who entered the 53 absorbing death state, the probability of being uncensored at the time of death was used. Mean and 54 moderate calibration was then assessed using the Aalen-Johansen, BLR-IPCW, MLR-IPCW and 55

pseudo-values (based on the Aalen-Johansen estimator) approaches. 56


### Results


## 57

The number of transitions over the entire course of follow up in the development (N = 5,000) and 58 validation (N = 100,000) datasets are given in supplementary Table S1. The moderate calibration 59 according to each method for N = 5,000 development sample are presented in Figure 8. Focusing on 60 the pseudo-value and BLR-IPCW calibration curves, calibration of the transition probabilities of being 61 in state 2 (CVD) is the worst, under predicting for lower risks and over predicting higher risks 62

(possibly a sign of overfitting). A similar pattern is seen for transition probabilities into state 4 (CKD), 63 although it is less extreme. There is over prediction of the transition probabilities into state 3 (CKD) 64 and state 5 (multimorbidity) only at the highest predictions. Calibration of the transition 65 probabilities into states 1 (healthy) and 6 (death) are the strongest. 66

The MLR-IPCW calibration scatter plot reflects quite a lot of variation in the calibration of the 67 transition probabilities into states 2 and 4. The interpretation of this is that even for individuals with 68 predicted transition probabilities which are deemed to be 'well calibrated' according to the BLR- 


## Discussion

We have detailed a range of techniques for evaluating the calibration of the transition probabilities out of the initial state of a multistate model. The BLR-IPCW, MLR-IPCW and pseudo-value approaches each yielded unbiased calibration curves (or scatter plots for MLR-IPCW) under noninformative censoring. The calibration plots showed relatively small bias even in the presence of strong levels of informative censoring. At small sample sizes all methods had similar levels of bias when assessing mean calibration, however variability in the Aalen-Johansen estimator was larger than for BLR-IPCW and MLR-IPCW. We recommend assessing calibration using one of either BLR-IPCW or pseudo-value approach, both of which produce a smoothed calibration curve, alongside MLR-IPCW, which provides a deeper evaluation of calibration through a scatter plot.

The BLR-IPCW and pseudo-value approaches produce curves because they assess the calibration of the transition probabilities into each state vs not being in that state, taking a "one vs all" approach. On the other hand, MLR-IPCW considers the probability of being in each state simultaneously, providing information on whether the observed event rate for state (state of interest) differs for individuals with the same risk of being in state , but different risks of being in states ≠ . To illustrate this, suppose we have a three-state illness-death model, where individuals with a 50% risk of being in the 'illness' state at time either have a 50% risk of being in the 'healthy' state (group A), or have a 50% risk of being in the 'death' state (group B), and that these groups are the same size. Now suppose that the model overpredicts the risk of being in the 'illness' state at time for group A, and underpredicts for group B by the same amount. Calibration of the transition probabilities into the 'illness' state is therefore poor for all these individuals. However, the BLR-IPCW and pseudovalue approach would find the model to be well calibrated for these individuals as the event rate would equal the average predicted risk across all individuals in both groups A and B. This type of miscalibration would be identified by the MLR-IPCW approach (see Van Hoorde et al., 34 for further discussion of this approach). Note that that confidence intervals can be calculated for the calibration curves using bootstrapping, however, assessing the variability in the scatter plot produced by MLR-IPCW is less tractable.

A benefit of the BLR-IPCW and MLR-IPCW approaches over the pseudo-value approach based on the Aalen-Johansen estimator is that they are cross-sectional and make no assumptions about the time scale or whether the Markov assumption holds. For example, in this study we have assumed the time scale in all models to be clock-forward, 10 however in practice the analyst may want to assess the calibration of a model developed under a clock-reset framework (where time resets to 0 after entry into a new state). This is also known as a semi-Markov or Markov renewal model, and the Markov assumption is violated. While we argued that the Aalen-Johansen approach was valid even when the Markov assumption was violated under our assumptions (section 2.2), this would not be the case if some individuals started in subsequent states, or if we were interested in assessing calibration of transition probabilities out of subsequent states. Biologically, end-organ susceptibility to common risk factors such as obesity varies in populations, where one individual may suffer kidney damage from high blood pressure, another may develop diabetes before kidney disease. In this case, other estimators do exist that could replace Aalen-Johansen, such as the Landmark Aalen-Johansen estimator, 52 or estimators designed specifically for Markov renewal processes. 78,79 While these estimators can replace the Aalen-Johansen estimator when calculating the pseudo-values, the added benefit of BLR-IPCW and MLR-IPCW is that they can be applied ubiquitously to validate a multistate model developed with any range of assumptions or structure. A second advantage is that the pseudo-value approach takes considerably longer to implement than the BLR-IPCW or MLR-IPCW approaches from a computational perspective, which impacts the ability to calculate confidence intervals through bootstrapping.

The BLR-IPCW and MLR-IPCW approaches are dependent on correct estimation of the IPCWs. Even when censoring is non-informative (i.e. happens at random), the application of weights is essential for these methods in the presence of an absorbing state. Only in the presence of informative censoring, the pseudo-values and Aalen-Johansen estimator must be calculated within subgroups of predicted risk. The BLR-IPCW and MLR-IPCW approaches require conditional independence in the reweighted population, whereas the Aalen-Johansen and pseudo-value approaches require conditional independence given the predicted risks. In the simulation, when censoring was strongly informative, we found that calibration was poor over the range of predicted risks where density was low for both methods, but there was variability in the direction and magnitude of bias, and for which states it was present. Future research may usefully compare these two ways of dealing with informative censoring. Our work constitutes phase I and phase II of the methodological research pipeline, 80 and covers some aspects of a phase III study. Phase III and IV work comparing these methods in a wider range of scenarios would be of high value. We recommend this work focus on how the pseudo-value and IPCW approaches deal with informative censoring, with a wider range of data generating mechanisms and event rates.

This study was restricted to when the following two conditions held: 1) all individuals started in initial state, and 2) only interested in calibrating transition probabilities out of the initial state ( = 1) at time = 0. All of the methods outlined in this paper can be implemented for ≠ 1 and > 0 through landmarking, 46,47 where calibration would only be assessed in individuals present in state at time . We recommend this should be explored in future work. While we have focused on irreversible multistate models, there is no reason these methods cannot also be applied to reversible models. Furthermore, we have focused on calibration of the transition probabilities, however there are a variety of possible approaches for assessing calibration. It may be of interest to validate the probability of a specific clinical outcome (such as developing multimorbidity in our clinical example). This risk may be the sum of multiple transition probabilities (i.e. the sum of the probabilities of being in the multimorbidity state, and of having entered death via the multimorbidity state). For this aim, graphical calibration curves 27 could be applied, where the outcome is a binary outcome: development of multimorbidity. Another approach may be to validate each competing risks sub-model for the transitions out of each state separately. This may help explore which sub-models are causing miscalibration in the estimated transition probabilities. For this aim, graphical calibration curves for competing risks models 28 would be appropriate. We focused on transition probabilities in this study as there is the least existing guidance in this area. However, we believe a study collating the methodology for each of the three approaches, and highlighting when each is appropriate, would be of use.

To our knowledge, this is the first study to detail how to assess the calibration of the transition probabilities of a multistate model, within the context of evaluating the performance of a risk prediction model. This adds to the existing literature on assessing calibration of models predicting continuous, binary, polytomous or survival outcomes. 20,21,33-36,22,26-32 All the methods considered (BLR-IPCW, MLR-IPCW and pseudo-values based on Aalen-Johansen estimator) give unbiased estimates of the calibration. We recommend producing a calibration curve using either BLR-IPCW or pseudo-values, and reporting alongside a calibration scatter plot using MLR-IPCW. Work is underway to embed the IPCW approaches into an R package.


## 16.

Putter  


### Availability of data and materials

The simulation was implemented in R version 4.1.2, 32 and rstudio 81 using the following packages: 20,49,62,82-94 . Code is available from our GitHub public repository. 64 CPRD data must be obtained directly from the provider.


### Author contributions

AP and GM conceived and designed the study in discussion with MS, RR, IB and NP. AP conducted the analysis and interpreted the results in discussion with all authors. AP wrote the initial draft of the manuscript with support from GM, which was then critically reviewed for important intellectual content by all authors. All authors have approved the final version of the paper.


### Competing interests

None 7.6. Ethics approval Access to CPRD data is supported by ISAC protocol 20_000102.


### Supporting web materials

Supplementary material 1 -further methodology and supplementary tables


## Supplementary material 2 -supplementary figures

Supplementary material 2 file could not be uploaded as the file size was too large for the manuscript submission system. We have therefore provided a link to the location of the supplementary material on GitHub. We apologise for any inconvenience.

https://github.com/manchester-predictive-healthcare-group/CHI-MRC-multioutcome/tree/main/Project%206%20Calibration%20plots%20for%20multistate%20risk%20 prediction%20models/manuscript%20files 


## Discussion of reliance on the Aalen-Johansen estimator on the Markov assumption in this setting

In general, the Aalen-Johansen estimator is only a consistent estimator under the Markov assumption for the multistate process ( ), which means at all times "given the present state and the event history of a patient, the next state to be visited and the time at which this will occur will only depend on the present state". 1 If this does not hold, the estimator may give a biased estimate of transition probabilities for non-Markov processes (and in turn a biased estimator of calibration), however this is not the case for this specific setting. Datta  which is what we are trying to estimate.

Therefore, by the work of Datta and Satten 2 and Glidden, 3 the Aalen-Johansen estimator gives a consistent estimate of the transition probabilities out of state 1, and the process outlined at the start of this section will give an unbiased estimate of calibration even for non-Markov multistate processes. In summary, if all individuals start in the same initial state, and interest only lies in estimating transition probabilities out of the initial state, the Aalen-Johansen estimator is sufficient for assessing calibration. Estimators which do not depend on the Markov assumption 4-7 are not required.

9. Formulas to calculate the true transition probabilities under data generating mechanism 1 9.1. Preliminaries, notation and overview of how transition probabilities are calculated

The This third quantity will have been derived by first calculating the transition probabilities at the end of the model, and using these in subsequent calculations. (i.e. first calculate the probability of transition from state 4 to state 5, 45 ( , ), and work backwards from there). In R I will write functions to:

Calculate cause specific hazard at time t

Calculate survival functions at time t

Calculate each of the transition probabilities (will require multiple integrations I guess). Although the way it's written, each function will only have one explicitly defined integration, so it shouldn't get too messy. The others will be hidden/contained with already defined functions.

I will then generate a cohort with all individuals same predictor, and compare the event rates to the true probabilities I have derived, to see if they match. The index date is defined as the start of follow up: maximum of date turned age 65, 1 st Jan 2000, and 6

date of 1 year of up to standard registration in the database 7

For predictors which are 'history of', we derived a variable which indicates whether an individual has 8 a record of the comorbidity prior to their index date in their primary care record. 9

For predictors reliant on test data (BMI, SBP, cholesterol/HDL ratio, smoking status), we looked in 10 the five years prior to the index date for an occurrence of the variable. Appropriate conversions 11

were applied based on the unit of measurement recorded in the database. Extreme values were 12 then removed. See Github page for full algorithms for extraction of each variable. 8 13 For outcomes, we derived the time until first occurrence or censoring, and a censoring indicator, in 14 both the primary care, secondary care and ONS datasets. We then took the event as the time until 15 the first of any of these to occur. We also derived presence of each condition at baseline, in order to 16 apply our exclusion criteria. Cardiovascular disease was a composite variable consisting of coronary 17 heart disease, heart failure, myocardial infarction, stroke and transient ischaemic attack. 18 CKD (stage 3, 4 or 5) events were identified through medical codes and test data, namely eGFR 19

scores and creatinine measurements. The process for doing so is below. 20

Identifying CKD from eGFR/GFR, and estimating eGFR/GFR from creatinine 21 KDIGO guidelines give definition of CKD. 9 This is from 2012, but are currently still the guidelines they 22

recommend. Abnormalities of kidney function must be present for > 3 months. This is CKD-EPI 23 equation 10 they recommend for converting creatinine mesaurements to GFR/eGFR scores (also 24 requires sex, ethnicity and age). Note that they state something along the lines of "this, or any 25 equation shown to be better than this" can be used. Therefore there may be a more recent equation 26 for this conversion, as the one they recommend was developed in 2009. This comparison shows the 27 CKD-EPI equation is better than the MDRD, which is another alternative. 11 28

The attached code looks for two entries below a certain value (60)  All codelists are available on GitHub. 8 Names of the final codelists used for data extraction, and 43 details of where these were obtained is given in this section. 44

For this study, we opt to focus only on medical codes, and ignore prescription data. Table SM2  45 contains all the names of the code lists used for extraction of the primary care data and the source 46 from which they were obtained. Code lists from source "AH" are available at the referenced Github 47 page. 12,13 Code lists from source "Cambridge mapped" were taken from the Cambridge primary care 48 unit website, 14 and then mapped by author TVS from CPRD GOLD to CPRD Aurum. Ethnicity code list 49 was available at on the LSHTM Data Compass. 15,16 The groupings for the medical codes were 50 obtained from a Read code code list on another GitHub respository 17 , developed for another study. 18 51

Some additional ethnicity codes were identified from this second code list, found in the CPRD Aurum 52 code browser, and added to the code list. The smoking status code list was available on the LSHTM 53

Data Compass. 19,20 Self-generated code lists we developed by searching the CPRD Aurum code 54 browser for *height*, *weight*, *body mass*, *systolic* and *cholesterol* respectively, and 55

selecting the appropriate codes. Finally, we opted to use code lists for Psoriasis (as opposed to 56

Psoriasis and eczema) and Rheumatoid arthritis (as opposed to rheumatoid arthritis and connective 57 tissue disorders), due to the availability of code lists from source AH. 58 Note that some of the code lists were edited after being moved onto incline as some formatting 61 changes had to be made. I am keeping a table of the pre-formatted variable names for personal 62 reference (Table 2) as both have been saved on GitHub. 8 Table SM4 contains the variables and ICD 10 codes used to extract it. For chronic kidney disease, the 67 full 5 digit ICD 10 code is required to separate CKD stages 1 and 2 from stages 3, 4 and 5. All others 68 only require the initial 3 digits for extraction. Following the process in QRISK3, CHD and MI were 69 grouped, and Stroke and TIA were grouped into one outcome. 70 Table SM4: ICD 10 codes used for extraction  71   Variable  ICD 10 codes  # characters  AF  'I48'  3  CHD/MI  'I20','I21','I22','I23','I24','I25'  3  Stroke/TIA  'G45','I63','I64'  3  Heart failure  'I50'  3  Type 1 diabetes  'E10'  3  Type 2 diabetes  'E11'  3  Chronic kidney 


## 63

## 2. 5 .
5Nominal recalibration framework using multinomial logistic regression and inverse probability of censoring weights (MLR-IPCW) Barrowman et al., 15 also proposed calculating calibration intercepts and slopes using the nominal calibration framework of Van Hoorde et al., 33 developed for assessing the calibration of polytomous outcomes to model the observed event probabilities of all outcome categories simultaneously. We extend this to assess moderate calibration by adapting the spline-based extension of the nominal calibration framework. 34 Let ( ) be a polytomous variable taking values in {1, … , }, such that ( ) = if an individual is in state at time . For each individual in the validation cohort, calculate the log-ratio of the probability of each state ( ≠ 1) relative to state 1:

## Figure 1 :
1Data generating mechanism for the simulation]

## Figure 2
2contains the calibration plots of the perfectly calibrated (̂, ), over predicting (̂, ) and under predicting transition probabilities (̂,

## Figures 3
3and 4 contain the moderate calibration plots of the perfectly calibrated transition probabilities for scenarios WIC and SIC. As the strength of informative censoring increases, this introduces bias into all the calibration methods. However, even when informative censoring is at its highest (Figure 4), BLR-IPCW, MLR-IPCW and pseudo-value all provide a predominately unbiased assessment of calibration. The rug plots indicate that the bias only occurs over the range of predicted transition probabilities where data points are sparse. Comparing the BLR-IPCW and pseudo-value approaches (the calibration curves) in the SIC scenario(Figure 4), shows each method gives a better evaluation of calibration for different states. Equivalent plots for the over and under predicting transition probabilities (Figures S3 -S6) lead to the same conclusions.


probabilities (̂, ) in scenario NIC, large sample analysis.] [INSERT Figure 3: Moderate calibration of each method for perfectly calibrated transition probabilities (̂, ) in scenario WIC, large sample analysis.] [INSERT Figure 4: Moderate calibration of each method for perfectly calibrated transition probabilities (̂, ) in scenario SIC, large sample analysis.]

## [INSERT Figure 5 :
5Corresponding figures for N = 1500 (Figures 29 and S30) lead to similar conclusions. Bias (CI) of each method for assessing mean calibration, large sample analysis.] [INSERT Figure 6: Median bias and 2.5 -97.5 percentile range in bias of each method for assessing mean calibration, small sample analysis.]


69 IPCW or pseudo-value plots, there may be considerable miscalibration depending on their predicted 70 transition probabilities for the other states. This contrasts with the calibration scatter plots for the 71 model developed on the N = 100,000 sample (Figure S31). While the plots for BLR-IPCW and pseudo-72 values look similar in Figures 8 and S31, the difference in the calibration scatter plots produced by 73 MLR-IPCW is notable. This evidence would lead to the conclusions that the N = 100,000 is a better 74 calibrated model, a conclusion that may not have been reached looking only at the BLR-IPCW and 75 pseudo-value plots. 76 [INSERT Figure 8: Moderate calibration according to each method (development sample size = 77 5000).] 78

## 40 .
40Beyer U, Dejardin D, Meller M, Rufibach K, Burger HU. A multistate model for early decisionmaking in oncology. Biometrical J. 2020;62(3):550-567. doi:10.1002/bimj.201800250 41. Deschepper M, Eeckloo K, Malfait S, Benoit D, Callens S, Vansteelandt S. Prediction of hospital bed capacity during the COVID− 19 pandemic. BMC Health Serv Res. 2021;21(1):1-10. doi:10.1186/s12913-021-06492-3 42. Kinoshita F, Yokota I, Mieno H, et al. Multi-state model for predicting ocular progression in acute Stevens-Johnson syndrome/toxic epidermal necrolysis. PLoS One. 2021;16(12 December):1-14. doi:10.1371/journal.pone.0260730 43. Masia M, Padilla S, Moreno S, et al. Prediction of long-term outcomes of HIV-infected patients developing non-AIDS events using a multistate approach. PLoS One. 2017;112:1-16. 44. Carobbio A, Guglielmelli P, Rumi E, et al. A multistate model of survival prediction and event monitoring in prefibrotic myelofibrosis. Blood Cancer J. 2020;10(10):1-7. doi:10.RD, Collins GS, Martin GP. Targeted validation: validating clinical prediction models in their intended population and setting. Diagnostic Progn Res. K, Gelber R. Analysis of survival by tumor response. J Clin Oncol. 1983;1:710-719. 47. Dafni U. Landmark analysis at the 25-year landmark point. Circ Cardiovasc Qual Outcomes. 2011;4(3):363-371. doi:10.1161/CIRCOUTCOMES.110.957951 48. Aalen OO, Johansen S. An Empirical Transition Matrix for Non-Homogeneous Markov Chains


and Satten 2 and Glidden3 show that the Aalen-Johansen estimator is a consistent estimator of the state occupation probabilities. State occupation probabilities are defined as:( ) = (0). (0, ) ,where (0) is the vector of probabilities of being in each state at = 0, such that (0) = ( (0) = ), and (0, ) is the x matrix of transition probabilities where element { , } is , (0, ).When everyone starts in the initial state, all elements of (0) = 0 except the first element, 1 (0) = 1. The state occupational probabilities then reduce to the vector of transitions probabilities out of state 1:


cause specific hazards for transitions from state to state at time , ( ) are 12 , 13 , 15 , 24 , 25 , 34 , 35 , 45 . Let ( ) be the survival function for state , the probability of not having suffered any of the competing events out of state prior to time (assuming one is in state at time point 0). ( ) = exp(− ∑ ℎ ( )), where ℎ ( ) is the cumulative cause-specific hazard up to time , for transition to state . Let ( , ) be the conditional probability of being in state at time , when in state at time . Let ( , ) be the conditional probability of being in state at time , when in state at time , and having reached state via the specified route, . Note that here could be a collection of states (for example reaching state 5 from state 1, via states 2 and 4, would be denoted 25 24 ( , ) The transition probabilities we want to calculate are 12 ( , ), 13 ( , ), 14 ( , ) and 15 ( , ). Note that 14 ( , The approach is to calculate the simplest transition probabilities first (i.e. probability of transition from state 4 to state 5, 45 ( , ), and work backwards from there. Following the theory of Putter et al. 1 A key property used throughout, is that the probability of having not left state by time , if in state at time . key property is that the probability of being in state at time , when in state at time , is equal to the integral of the following quantity over all time points between and : The product of (1) cause-specific hazard of transitioning out of state to some intermediate state at time ( ( )), (2) the probability of having remained in state until time point (see previous equation), and (3) the conditional probability of being in state after time , when in state at time , ( , ).

## Table 1 :
1Targeted 7-year survival and corresponding baseline hazards , used to generate the data 
in data generating mechanism 1 

Transition 
1 → 2 1 → 3 
1 → 5 
2 → 4 
2 → 5 3 → 4 3 → 5 4 → 5 
Targeted survival 
probability 

0.9 
0.8 
0.99 
0.55 
0.95 
0.7 
0.15 
0.05 

, 

24267 11458 254394 4277 
49856 7168 
1348 
853 




H, Van Hage J Der, De Bock GH, Elgalta R, Van De Velde CJH. Estimation and prediction in a multi-state model for breast cancer. Biometrical J.2006;48(3):366-380. 
doi:10.1002/bimj.200510218 

17. 
Beesley LJ, Shuman AG, Mierzwa ML, et al. Development and Assessment of a Model for 
Predicting Individualized Outcomes in Patients with Oropharyngeal Cancer. JAMA Netw Open. 
2021;4(8):1-14. doi:10.1001/jamanetworkopen.2021.20055 

18. 
Le-Rademacher JG, Peterson RA, Therneau TM, Sanford BL, Stone RM, Mandrekar SJ. 
Application of multi-state models in cancer clinical trials. Clin Trials. 2018;15(5):489-498. 
doi:10.1177/1740774518789098 

19. 
Steyerberg EW, Harrell Jr FE. Prediction models need appropriate internal, internal-external, 
and external validation. J Clin Epidemiol. 2016;69:245-247. doi:10.1016/j.jclinepi.2015.04.005 

20. 
Harrell FE. Regression Modeling Strategies. Springer S. Springer; 2015. 

21. 
Steyerberg EW. Clinical Prediction Models: A Practical Approach to Development, Validation, 
and Updating. 2nd ed. (Gail M, Jonathan S, Singer B, eds.). Springer; 2019. 
https://link.springer.com/book/10.1007/978-3-030-16399-0 

22. 
Riley RD, van der Windt D, Croft P, Moons KGM. Prognosis Research in Healthcare: Concepts, 
Methods, and Impact. Oxford University Press; 2019. 

23. 
Vickers AJ, Van Calster B, Steyerberg EW. Net benefit approaches to the evaluation of 
prediction models, molecular markers, and diagnostic tests. BMJ. 2016;352:3-7. 
doi:10.1136/bmj.i6 

24. 
Vickers AJ, Van Calster B, Steyerberg EW. A simple, step-by-step guide to interpreting 
decision curve analysis. Diagnostic Progn Res. 2019;3(1):1-8. doi:10.1186/s41512-019-0064-7 

25. 
Gerds TA, Schumacher M. Consistent estimation of the expected brier score in general 
survival models with right-censored event times. Biometrical J. 2006;48(6):1029-1040. 
doi:10.1002/bimj.200610301 

26. 
Royston P. Tools for checking calibration of a Cox model in external validation: Approach 
based on individual event probabilities. Stata J. 2014;14(4):738-755. 
doi:10.1177/1536867x1401400403 

27. 
Austin PC, Harrell FE, van Klaveren D. Graphical calibration curves and the integrated 
calibration index (ICI) for survival models. Stat Med. 2020;39(21):2714-2742. 
doi:10.1002/sim.8570 

28. 
Austin PC, Putter H, Giardiello D, van Klaveren D. Graphical calibration curves and the 
integrated calibration index (ICI) for competing risk models. Diagnostic Progn Res. 2022;6(1). 
doi:10.1186/s41512-021-00114-6 

29. 
Van Geloven N, Giardiello D, Bonneville EF, et al. Validation of prediction models in the 
presence of competing risks: a guide through modern methods. BMJ. Published online 
2022:1-7. doi:10.1136/bmj-2021-069249 

30. 
Van Calster B, Nieboer D, Vergouwe Y, De Cock B, Pencina MJ, Steyerberg EW. A calibration 
hierarchy for risk models was defined: From utopia to empirical data. J Clin Epidemiol. 
2016;74:167-176. doi:10.1016/j.jclinepi.2015.12.005 

31. 
Steyerberg EW, Vickers AJ, Cook NR, et al. Assessing the performance of prediction models: a 
framework for traditional and novel measures. Epidemiology. 2010;21(1):128. 
32. 
Austin PC, Steyerberg EW. Graphical assessment of internal and external calibration of logistic 
regression models by using loess smoothers. Stat Med. 2014;33(3):517-535. 
doi:10.1002/sim.5941 

33. 
Van Hoorde K, Vergouwe Y, Timmerman D, Van Huffel S, Steyerberg W, Van Calster B. 
Assessing calibration of multinomial risk prediction models. Stat Med. 2014;33(15):2585-
2596. doi:10.1002/sim.6114 

34. 
Van Hoorde K, Van Huffel S, Timmerman D, Bourne T, Van Calster B. A spline-based tool to 
assess and visualize the calibration of multiclass risk predictions. J Biomed Inform. 
2015;54:283-293. doi:10.1016/j.jbi.2014.12.016 

35. 
Van Calster B, McLernon DJ, Van Smeden M, et al. Calibration: The Achilles heel of predictive 
analytics. BMC Med. 2019;17(1):1-7. doi:10.1186/s12916-019-1466-7 

36. 
Royston P, Altman DG. External validation of a Cox prognostic model: principles and methods. 
BMC Med Res Methodol. 2013;13(33). 

37. 
Titman AC, Sharples LD. Model diagnostics for multi-state models. Stat Methods Med Res. 
2010;19(6):621-651. doi:10.1177/0962280209105541 

38. 
Spitoni C, Lammens V, Putter H. Prediction errors for state occupation and transition 
probabilities in multi-state models. Biometrical J. 2018;60(1):34-48. 
doi:10.1002/bimj.201600191 

39. 
Postmus D, Van Veldhuisen DJ, Jaarsma T, et al. The COACH risk engine: A multistate model 
for predicting survival and hospitalization in patients with heart failure. Eur J Heart Fail. 
2012;14(2):168-175. doi:10.1093/eurjhf/hfr163 




.................................................................................................................................................. 25 Transition probabilities out of state 1........................................................................... 28 2.3. Formulas for transition probabilities from DGM-2 ............................................................... 29 2.3.1. Transition probabilities out of states 4 and 5 ............................................................... 29 2.4. Transition probabilities out of states 2 and 3 ....................................................................... 29 2.4.1. Transition probabilities out of state 1........................................................................... 30 3. Code lists and operational definitions for variables in clinical example ....................................... 33 3.1. Operational definitions for extracting variables ................................................................... 33 3.2. Code lists used for primary care extraction .......................................................................... 34 3.3. Code lists used for HES/ONS extraction ................................................................................ 35 4. Supplementary Tables .................................................................................................................. 37 5. References .................................................................................................................................... 38Supplementary material part 1 -further 
methodology and supplementary tables 

Associated manuscript: Calibration plots for multistate risk prediction models: an overview and 
simulation comparing novel approaches 

Contents 

1. Discussion of reliance on the Aalen-Johansen estimator on the Markov assumption in this 
setting .2. Formulas to calculate the true transition probabilities under data generating mechanism 1 ..... 26 

2.1. Preliminaries, notation and overview of how transition probabilities are calculated ......... 26 

2.2. Formulas for transition probabilities for data generating mechanism 1 .............................. 27 

2.2.1. 
Transition probabilities out of state 4........................................................................... 27 

2.2.2. 
Transition probabilities out of states 2 and 3 ............................................................... 27 

2.2.3. 



that are more than 90 days (3 29 months) apart. Dataset should be in format of: 30 -1 row per eGFR score 31 -Variables: person_id(identifier for individuals), EntryDate (date of code), CodeValue (value of 32 eGFR), num (increasing integer indicating the observation number for each individual) 33 Overall strategy: 35 1) Identify CKD stages 3/4/5 using medical codes 36 2) Extract eGFR/GFR + creatinine scores from test data 37 3) Convert creatinine measurements to eGFR scores 38 4) Use algorithm to identify if individuals meets criteria for CKD stages 3/4/5 using algorithm 39 provided 40 5) CKD = 1 if either medical code, or CKD identified from test data. 41 10.2. Code lists used for primary care extraction34 

42 


## Table SM2 :
SM2Code lists file names and source 59Variable 
Code list name 
Source 
Medical history 
1 Alcohol misuse 
Alcohol_misuse 
AH 
5 Depression 
Depression 
AH 
9 Chronic kidney disease 
Chronic_kidney_disease 
AH 
13 Coronary heart disease 
Coronary_heart_disease 
AH 
15 Diabetes 
Diabetes_mellitus_other_or_not_specified AH 
15 Diabetes 
Diabetes_mellitus_type1 
AH 
15 Diabetes 
Diabetes_mellitus_type2 
AH 
19 Heart failure 
Heart_failure 
AH 
20 Hypertension 
Hypertension 
AH 
33 Stroke transient ischaemic attack Stroke_not_otherwise_specified 
AH 
33 Stroke transient ischaemic attack Transient_ischaemic_attack 
AH 
35 Myocardial Infarction 
Myocardial_infarction 
AH 
Demographic, lifestyle and test data 

37 

Body mass index 
height 
Self-
generated 

37 

Body mass index 
weight 
Self-
generated 

37 

Body mass index 
bmi 
Self-
generated 

38 

Systolic blood pressure 
sbp 
Self-
generated 

39 

Smoking status 
cr_smokingcodes_aurum 
Internet 
search 
40 

Cholesterol 
chol_total 
Self-
generated 

40 

Cholesterol 
chol_hdl 
Self-
generated 

40 

Cholesterol 
chol_ratio 
Self-
generated 
60 



## Table SM3 :
SM3Pre-formatted code list names and post-formatted code list names 64 10.3. Code lists used for HES/ONS extractionVariable Pre-format name 
Post-format name 
Inflammatory 
bowel 
disease IBD160_mapped 
IBD160_mcid 
Peptic Ulcer 
Disease 

PEP135_mapped 
PEP135_mcid 

Prostate 
disorders 

PRO170_mapped 
PRO170_mcid 

Ethnicity Ethnicity_aurum_wgroups 
Ethnicity_aurum_wgroups_mcid 
Body mass 
index 

height 
Height_mcid 

Body mass 
index 

weight 
Weight_mcid 

Body mass 
index 

bmi 
bmi_mcid 

Systolic 
blood 
pressure 

sbp 
sbp_mcid 

Smoking 
status 

cr_smokingcodes_aurum 
cr_smokingcodes_aurum_mcid 

Cholesterol chol_total 
chol_total_mcid 
Cholesterol chol_hdl 
chol_hdl_mcid 
Cholesterol chol_ratio 
chol_ratio_mcid 
65 

66 


## Table S1 :
S1Number of transitions in and out of each state in the clinical example 75Development dataset (N = 5,000)Entering 

Leaving 

State 1 
State 2 State 3 State 4 State 5 State 6 no event 
total entering 

State 1 
0 
1002 
629 
566 
14 
530 
2259 
5000 

State 2 
0 
0 
0 
0 
427 
250 
325 
1002 

State 3 
0 
0 
0 
0 
259 
69 
301 
629 

State 4 
0 
0 
0 
0 
148 
124 
294 
566 

State 5 
0 
0 
0 
0 
0 
379 
469 
848 

State 6 
0 
0 
0 
0 
0 
0 
1352 
1352 

Validation dataset (N = 100,000) 

Entering 

Leaving 

State 1 
State 2 State 3 State 4 State 5 State 6 no event 
total entering 

State 1 
0 
19299 
12891 
12091 
325 
10854 
44540 
100000 

State 2 
0 
0 
0 
0 
7650 
5165 
6484 
19299 

State 3 
0 
0 
0 
0 
5517 
1611 
5763 
12891 

State 4 
0 
0 
0 
0 
3189 
2524 
6378 
12091 

State 5 
0 
0 
0 
0 
0 
7424 
9257 
16681 

State 6 
0 
0 
0 
0 
0 
0 
27578 
27578 

76 

77 

( , ) = ∫ 35 ( )

The APACHE III prognostic system: Risk prediction of hospital mortality for critically III hospitalized adults. W A Knaus, D P Wagner, E A Draper, 10.1378/chest.100.6.1619Chest. 1006Knaus WA, Wagner DP, Draper EA, et al. The APACHE III prognostic system: Risk prediction of hospital mortality for critically III hospitalized adults. Chest. 1991;100(6):1619-1636. doi:10.1378/chest.100.6.1619

Predictive value of the Sequential Organ Failure Assessment score for mortality in a contemporary cardiac intensive care unit population. J C Jentzer, C Bennett, B M Wiley, 10.1161/JAHA.117.008169J Am Heart Assoc. 76Jentzer JC, Bennett C, Wiley BM, et al. Predictive value of the Sequential Organ Failure Assessment score for mortality in a contemporary cardiac intensive care unit population. J Am Heart Assoc. 2018;7(6). doi:10.1161/JAHA.117.008169

Development and validation of QRISK3 risk prediction algorithms to estimate future risk of cardiovascular disease: prospective cohort study. J Hippisley-Cox, C Coupland, P Brindle, 10.1136/bmj.j2099BMJ. 35732099Hippisley-Cox J, Coupland C, Brindle P. Development and validation of QRISK3 risk prediction algorithms to estimate future risk of cardiovascular disease: prospective cohort study. BMJ. 2017;357(3):j2099. doi:https://doi.org/10.1136/bmj.j2099

General cardiovascular risk profile for use in primary care: The Framingham heart study. R B D&apos;agostino, R S Vasan, M J Pencina, 10.1161/CIRCULATIONAHA.107.699579Circulation. 1176D'Agostino RB, Vasan RS, Pencina MJ, et al. General cardiovascular risk profile for use in primary care: The Framingham heart study. Circulation. 2008;117(6):743-753. doi:10.1161/CIRCULATIONAHA.107.699579

Defining community acquired pneumonia severity on presentation to hospital: An international derivation and validation study. W S Lim, M M Van Der Eerden, R Laing, 10.1136/thorax.58.5.377Thorax. 585Lim WS, Van Der Eerden MM, Laing R, et al. Defining community acquired pneumonia severity on presentation to hospital: An international derivation and validation study. Thorax. 2003;58(5):377-382. doi:10.1136/thorax.58.5.377

A contemporary risk model for predicting 30-day mortality following percutaneous coronary intervention in England and Wales. Ksl Mcallister, P F Ludman, W Hulme, 10.1016/j.ijcard.2016.02.085Int J Cardiol. 210McAllister KSL, Ludman PF, Hulme W, et al. A contemporary risk model for predicting 30-day mortality following percutaneous coronary intervention in England and Wales. Int J Cardiol. 2016;210:125-132. doi:10.1016/j.ijcard.2016.02.085

FRAX TM and the assessment of fracture probability in men and women from the UK. J A Kanis, O Johnell, A Oden, H Johansson, E Mccloskey, 10.1007/s00198-007-0543-5Osteoporos Int. 194Kanis JA, Johnell O, Oden A, Johansson H, McCloskey E. FRAX TM and the assessment of fracture probability in men and women from the UK. Osteoporos Int. 2008;19(4):385-397. doi:10.1007/s00198-007-0543-5

Erratum to: PREDICT: a new UK prognostic model that predicts survival following surgery for invasive breast cancer. C Caldas, D C Greenberg, O Kearins, 10.1186/bcr2480Breast Cancer Res. Published online. 2010Caldas C, Greenberg DC, Kearins O, et al. Erratum to: PREDICT: a new UK prognostic model that predicts survival following surgery for invasive breast cancer. Breast Cancer Res. Published online 2010:1-10. doi:10.1186/bcr2480

. Sam Nashef, F Roques, L D Sharples, 10.1093/ejcts/ezs043Eur J Cardio-thoracic Surg. 414Nashef SAM, Roques F, Sharples LD, et al. Euroscore II. Eur J Cardio-thoracic Surg. 2012;41(4):734-745. doi:10.1093/ejcts/ezs043

Tutorial in biostatistics: Competing risks and multi-state models. H Putter, M Fiocco, R B Geskus, 10.1002/simStat Med. 2611Putter H, Fiocco M, Geskus RB. Tutorial in biostatistics: Competing risks and multi-state models. Stat Med. 2007;26(11):2389-2430. doi:10.1002/sim

Progression of diabetes, ischemic heart disease, and chronic kidney disease in a three chronic conditions multistate model. C Siriwardhana, E Lim, J Davis, J J Chen, 10.1186/s12889-018-5688-yBMC Public Health. 181Siriwardhana C, Lim E, Davis J, Chen JJ. Progression of diabetes, ischemic heart disease, and chronic kidney disease in a three chronic conditions multistate model. BMC Public Health. 2018;18(1):1-14. doi:10.1186/s12889-018-5688-y

Lifestyle factors and risk of multimorbidity of cancer and cardiometabolic diseases :a multinational cohort study. List Mfa, H Freisling, V Viallon, BMC Med. 10185LIST MFA, Freisling H, Viallon V, et al. Lifestyle factors and risk of multimorbidity of cancer and cardiometabolic diseases :a multinational cohort study. BMC Med. 2020;10(18):5.

A multistate model of health transitions in older people: a secondary analysis of ASPREE clinical trial data. J T Neumann, Ltp Thao, E Callander, 10.1016/S2666-7568(21)00308-1Lancet Heal Longev. 32Neumann JT, Thao LTP, Callander E, et al. A multistate model of health transitions in older people: a secondary analysis of ASPREE clinical trial data. Lancet Heal Longev. 2022;3(2):e89- e97. doi:10.1016/S2666-7568(21)00308-1

A multi-state model for kidney disease progression. M K Lintu, K M Shreyas, A Kamath, 10.1016/j.cegh.2021.100946Clin Epidemiol Glob Heal. 13100946Lintu MK, Shreyas KM, Kamath A. A multi-state model for kidney disease progression. Clin Epidemiol Glob Heal. 2022;13(December 2021):100946. doi:10.1016/j.cegh.2021.100946

clinical-prediction-models-in-renal-replacement-thera Based on Censored Observations. M Barrowman, Scand J Stat. 53Multi-State Clinical Prediction Models in Renal Replacement TherapyBarrowman M. Multi-State Clinical Prediction Models in Renal Replacement Therapy. Published online 2022. https://research.manchester.ac.uk/en/studentTheses/multi-state- clinical-prediction-models-in-renal-replacement-thera Based on Censored Observations. Scand J Stat. 1978;5(3):141-150.

mstate: An R Package for the Analysis of Competing Risks and Multi-State Models. L C De Wreede, M Fiocco, H Putter, J Stat Softw. 387de Wreede LC, Fiocco M, Putter H. mstate: An R Package for the Analysis of Competing Risks and Multi-State Models. J Stat Softw. 2011;38(7).

Validity of the Aalen-Johansen estimators of stage occupation probabilities and Nelson-Aalen estimators of integrated transition hazards for non-Markov models. S Datta, G A Satten, 10.1016/S0167-7152(01)00155-9Stat Probab Lett. 554Datta S, Satten GA. Validity of the Aalen-Johansen estimators of stage occupation probabilities and Nelson-Aalen estimators of integrated transition hazards for non-Markov models. Stat Probab Lett. 2001;55(4):403-411. doi:10.1016/S0167-7152(01)00155-9

Putter H, Spitoni C. Non-parametric estimation of transition probabilities in non-Markov multi-state models: The landmark Aalen-Johansen estimator. D Glidden, 10.1177/0962280216674497Stat Methods Med Res. 587Biometrics.Glidden D V. Robust Inference for Event Probabilities with Non-Markov Event Data. Biometrics. 2002;58:361-368. http://ci.nii.ac.jp/naid/40005603729/en/ 52. Putter H, Spitoni C. Non-parametric estimation of transition probabilities in non-Markov multi-state models: The landmark Aalen-Johansen estimator. Stat Methods Med Res. 2018;27(7):2081-2092. doi:10.1177/0962280216674497

Inference for events with dependent risks in multiple endpoint studies. M S Pepe, 10.1080/01621459.1991.10475108J Am Stat Assoc. 86415Pepe MS. Inference for events with dependent risks in multiple endpoint studies. J Am Stat Assoc. 1991;86(415):770-778. doi:10.1080/01621459.1991.10475108

Nonparametric estimation of transition probabilities in the non-Markov illness-death model: A comparative study. J De Uña-Álvarez, Meira-Machado , L , 10.1111/biom.12288Biometrics. 712de Uña-Álvarez J, Meira-Machado L. Nonparametric estimation of transition probabilities in the non-Markov illness-death model: A comparative study. Biometrics. 2015;71(2):364-375. doi:10.1111/biom.12288

Transition probability estimates for non-Markov multi-state models. A C Titman, 10.1111/biom.12349Biometrics. 714Titman AC. Transition probability estimates for non-Markov multi-state models. Biometrics. 2015;71(4):1034-1041. doi:10.1111/biom.12349

Pseudo-observations in survival analysis. P K Andersen, Pohar Perme, M , 10.1177/0962280209105020Stat Methods Med Res. 191Andersen PK, Pohar Perme M. Pseudo-observations in survival analysis. Stat Methods Med Res. 2010;19(1):71-99. doi:10.1177/0962280209105020

Pohar Perme M. Inference for transition probabilities in non-Markov multi-state models. P K Andersen, Ens Wandall, 10.1007/s10985-022-09560-wLifetime Data Anal. 284Andersen PK, Wandall ENS, Pohar Perme M. Inference for transition probabilities in non- Markov multi-state models. Lifetime Data Anal. 2022;28(4):585-604. doi:10.1007/s10985- 022-09560-w

Clinical Prediction Models -A Practical Approach to Development, Validation, and Updating. E W Steyerberg, SpringerSteyerberg EW. Clinical Prediction Models -A Practical Approach to Development, Validation, and Updating. Springer; 2009.

Towards better clinical prediction models : seven steps for development and an ABCD for validation. E W Steyerberg, Y Vergouwe, 10.1093/eurheartj/ehu207Eur Heart J. 35Steyerberg EW, Vergouwe Y. Towards better clinical prediction models : seven steps for development and an ABCD for validation. Eur Heart J. 2014;35:1925-1931. doi:10.1093/eurheartj/ehu207

Robins JM, Finkelstein DM. Correcting for noncompliance and dependent censoring in an AIDS clinical trial with inverse probability of censoring weighted (IPCW) log-rank tests. A Benner, 10.1111/j.0006-341X.2000.00779.x62Biometrics. 563Multivariable Fractional PolynomialsBenner A. Multivariable Fractional Polynomials. Accessed July 24, 2018. https://cran.r- project.org/web/packages/mfp/vignettes/mfp_vignette.pdf 61. Robins JM, Finkelstein DM. Correcting for noncompliance and dependent censoring in an AIDS clinical trial with inverse probability of censoring weighted (IPCW) log-rank tests. Biometrics. 2000;56(3):779-788. doi:10.1111/j.0006-341X.2000.00779.x 62.

The VGAM Package for The VGAM Package for Categorical Data Analysis. T W Yee, 10.18637/jss.v032.i10J Stat Softw. 3210Yee TW. The VGAM Package for The VGAM Package for Categorical Data Analysis. J Stat Softw. 2010;32(10):1-34. doi:10.18637/jss.v032.i10

Using simulation studies to evaluate statistical methods. T P Morris, I R White, M J Crowther, 10.1002/sim.8086Stat Med. 3811Morris TP, White IR, Crowther MJ. Using simulation studies to evaluate statistical methods. Stat Med. 2019;38(11):2074-2102. doi:10.1002/sim.8086

GitHub repository. Manchester Predictive Healthcare Group. MRC-Multi-Outcome-Project-6-Calibration-Plots-for-Multistate-Risk-Prediction-Models. A Pate, Published online 2023Pate A. GitHub repository. Manchester Predictive Healthcare Group. MRC-Multi-Outcome- Project-6-Calibration-Plots-for-Multistate-Risk-Prediction-Models. Published online 2023.

Calculating the sample size required for developing a clinical prediction model. R D Riley, J Ensor, Kie Snell, 10.1136/bmj.m441BMJ. 368441Riley RD, Ensor J, Snell KIE. Calculating the sample size required for developing a clinical prediction model. BMJ. 2020;368:m441. doi:10.1136/bmj.m441

. The Academy of Medical Sciences. Multimorbidity: A Priority for Global Health Research. The Academy of Medical Sciences. Multimorbidity: A Priority for Global Health Research.; 2018. https://acmedsci.ac.uk/file-download/82222577

Epidemiology of multimorbidity and implications for health care, research, and medical education: A crosssectional study. K Barnett, S W Mercer, M Norbury, G Watt, S Wyke, B Guthrie, 10.1016/S0140-6736(12)60240-2Lancet. 3809836Barnett K, Mercer SW, Norbury M, Watt G, Wyke S, Guthrie B. Epidemiology of multimorbidity and implications for health care, research, and medical education: A cross- sectional study. Lancet. 2012;380(9836):37-43. doi:10.1016/S0140-6736(12)60240-2

Changes in the severity and lethality of age-related health deficit accumulation in the USA between 1999 and 2018: a population-based cohort study. J M Blodgett, K Rockwood, O Theou, 10.1016/S2666-7568(20)30059-3Lancet Heal Longev. 22Blodgett JM, Rockwood K, Theou O. Changes in the severity and lethality of age-related health deficit accumulation in the USA between 1999 and 2018: a population-based cohort study. Lancet Heal Longev. 2021;2(2):e96-e104. doi:10.1016/S2666-7568(20)30059-3

ICARE4EU: improving care for people with multiple chronic conditions in Europe. Rijken M Policies, V Struckmann, M Dyakova, M G Melchiorre, Al E , Eurohealth (Lond). 193European Observatory on Health Systems and Policies, Rijken M, Struckmann V, Dyakova M, Melchiorre MG, Al E. ICARE4EU: improving care for people with multiple chronic conditions in Europe. Eurohealth (Lond). 2013;19(3):29-31.

Multimorbidity: not just an older person's issue. A W Taylor, K Price, T K Gill, BMC Public Health. 10718Taylor AW, Price K, Gill TK, et al. Multimorbidity: not just an older person's issue. BMC Public Health. 2010;10(718):1-10.

. 10.1186/1471-2458-10-718https://bmcpublichealth.biomedcentral.com/track/pdf/10.1186/1471-2458-10-718

Multimorbidity and the inequalities of global ageing: A cross-sectional study of 28 countries using the World Health Surveys. S Afshar, P J Roderick, P Kowal, B D Dimitrov, A G Hill, 10.1186/s12889-015-2008-7BMC Public Health. 151Afshar S, Roderick PJ, Kowal P, Dimitrov BD, Hill AG. Multimorbidity and the inequalities of global ageing: A cross-sectional study of 28 countries using the World Health Surveys. BMC Public Health. 2015;15(1):1-10. doi:10.1186/s12889-015-2008-7

The impact of multimorbidity on adult physical and mental health in low-and middle-income countries: What does the study on global ageing and adult health (SAGE) reveal?. P Arokiasamy, U Uttamacharya, K Jain, 10.1186/s12916-015-0402-8BMC Med. 131Arokiasamy P, Uttamacharya U, Jain K, et al. The impact of multimorbidity on adult physical and mental health in low-and middle-income countries: What does the study on global ageing and adult health (SAGE) reveal? BMC Med. 2015;13(1):1-16. doi:10.1186/s12916-015- 0402-8

Global Multimorbidity Patterns: A Cross-Sectional, Population-Based, Multi-Country Study. N Garin, A Koyanagi, S Chatterji, 10.1093/gerona/glv128Journals Gerontol -Ser A Biol Sci Med Sci. 712Garin N, Koyanagi A, Chatterji S, et al. Global Multimorbidity Patterns: A Cross-Sectional, Population-Based, Multi-Country Study. Journals Gerontol -Ser A Biol Sci Med Sci. 2016;71(2):205-214. doi:10.1093/gerona/glv128

Economic Burden of Cardiovascular Disease in Type 2 Diabetes: A Systematic Review. Value Heal. T R Einarson, A Acs, C Ludwig, U H Panton, 10.1016/j.jval.2017.12.01921Einarson TR, Acs A, Ludwig C, Panton UH. Economic Burden of Cardiovascular Disease in Type 2 Diabetes: A Systematic Review. Value Heal. 2018;21(7):881-890. doi:10.1016/j.jval.2017.12.019

The impact of cardiovascular disease on medical care costs in subjects with and without type 2 diabetes. G A Nichols, J B Brown, 10.2337/diacare.25.3.482Diabetes Care. 253Nichols GA, Brown JB. The impact of cardiovascular disease on medical care costs in subjects with and without type 2 diabetes. Diabetes Care. 2002;25(3):482-486. doi:10.2337/diacare.25.3.482

Data resource profile: Clinical Practice Research Datalink (CPRD) Aurum. A Wolf, D Dedman, J Campbell, 10.1093/ije/dyz034Int J Epidemiol. 486Wolf A, Dedman D, Campbell J, et al. Data resource profile: Clinical Practice Research Datalink (CPRD) Aurum. Int J Epidemiol. 2019;48(6):1740-1740G. doi:10.1093/ije/dyz034

Methods for Contrasting Gap Time Hazard Functions: Application to Repeat Liver Transplantation. X Shu, D E Schaubel, 10.1007/s12561-016-9168-6Stat Biosci. 92Shu X, Schaubel DE. Methods for Contrasting Gap Time Hazard Functions: Application to Repeat Liver Transplantation. Stat Biosci. 2017;9(2):470-488. doi:10.1007/s12561-016-9168-6

Estimation of transition probabilities and bootstrap in a semiparametric markov renewal model. D Dabrowska, 10.1080/10485259508832646J Nonparametr Stat. 53Dabrowska D. Estimation of transition probabilities and bootstrap in a semiparametric markov renewal model. J Nonparametr Stat. 1995;5(3):237-259. doi:10.1080/10485259508832646

Estimation and asymptotic theory for transition probabilities in markov renewal multi-state models. C Spitoni, M Verduijn, H Putter, 10.1515/1557-4679.1375Int J Biostat. 81Spitoni C, Verduijn M, Putter H. Estimation and asymptotic theory for transition probabilities in markov renewal multi-state models. Int J Biostat. 2014;8(1). doi:10.1515/1557-4679.1375

Phases of methodological research in biostatistics -building the evidence base for new methods. G Heinze, A-L Boulesteix, M Kammer, T P Morris, I R White, 10.1002/bimj.20220022281RStudio: Integrated Development for R. RStudio Team. Published online 2020Heinze G, Boulesteix A-L, Kammer M, Morris TP, White IR. Phases of methodological research in biostatistics -building the evidence base for new methods. 2022;(December 2022):1-8. doi:10.1002/bimj.202200222 81. RStudio: Integrated Development for R. RStudio Team. Published online 2020. http://www.rstudio.com/

Simulating survival data using the simsurv R package. S L Brilleman, R Wolfe, M Moreno-Betancur, M J Crowther, 10.18637/jss.v097.i03J Stat Softw. 973Brilleman SL, Wolfe R, Moreno-Betancur M, Crowther MJ. Simulating survival data using the simsurv R package. J Stat Softw. 2021;97(3):1-27. doi:10.18637/jss.v097.i03

Multivariate Imputation by Chained Equations. S Van Buuren, K Groothuis-Oudshoorn, Mice, J Stat Softw. 453van Buuren S, Groothuis-oudshoorn K. mice: Multivariate Imputation by Chained Equations. J Stat Softw. 2011;45(3).

A General-Purpose Package for Dynamic Report Generation in R. Y Xie, Knitr, Published online 2021Xie Y. knitr: A General-Purpose Package for Dynamic Report Generation in R. Published online 2021. https://rdrr.io/github/yihui/knitr/man/knitr-package.html

Dot-and-Whisker Plots of Regression Results. F Solt, Y Hu, O Keyes, Published online 2021Solt F, Hu Y, Keyes O, et al. dotwhisker: Dot-and-Whisker Plots of Regression Results. Published online 2021. https://cran.r-project.org/web/packages/dotwhisker/index.html 86.

doParallel: Foreach Parallel Adaptor for the "parallel" Package. D Folashade, Microsoft Corporation, S Westen, D Tenenbaum, Published online 2022Folashade D, Microsoft Corporation, Westen S, Tenenbaum D. doParallel: Foreach Parallel Adaptor for the "parallel" Package. Published online 2022. https://cran.r- project.org/web/packages/doParallel/index.html

Provides Foreach Looping Construct. D Folashade, H Ooi, R Calaway, Weston S Microsoft, Foreach, Published online 2022Folashade D, Ooi H, Calaway R, Microsoft, Weston S. foreach: Provides Foreach Looping Construct. Published online 2022. https://cran.r-project.org/package=foreach

dplyr: A Grammar of Data Manipulation. H Wickham, R Francois, L Henry, K Muller, Published online 2022Wickham H, Francois R, Henry L, Muller K. dplyr: A Grammar of Data Manipulation. Published online 2022.

A package for Survival Analysis in S_. version 2.38. T M Therneau, Published online 2015Therneau TM. A package for Survival Analysis in S_. version 2.38. Published online 2015. https://cran.r-project.org/package=survival

gems: An R Package for Simulating from Disease Progression Models. N Blaser, L S Vizcaya, J Estill, J Stat Softw. 6410Blaser N, Vizcaya LS, Estill J, et al. gems: An R Package for Simulating from Disease Progression Models. J Stat Softw. 2015;64(10).

boot: Bootstrap R (S-Plus) Functions. A Canty, B Ripley, Published online 2021Canty A, Ripley B. boot: Bootstrap R (S-Plus) Functions. Published online 2021. https://cran.r- project.org/web/packages/boot/boot.pdf

Elegant Graphics for Data Analysis. H Wickham, Published online 2016Wickham H. ggplot2: Elegant Graphics for Data Analysis. Published online 2016. https://ggplot2.tidyverse.org

ggplot2" Based Publication Ready Plots. A Kassambara, Ggpubr, Published online 2020Kassambara A. ggpubr: "ggplot2" Based Publication Ready Plots. Published online 2020. https://cran.r-project.org/package=ggpubr

Cairo: R Graphics Device using Cairo Graphics Library for Creating High-Quality Bitmap (PNG, JPEG, TIFF), Vector (PDF, SVG, PostScript) and Display (X11 and Win32) Output. S Urbanek, J Horner, Published online 2022Urbanek S, Horner J. Cairo: R Graphics Device using Cairo Graphics Library for Creating High- Quality Bitmap (PNG, JPEG, TIFF), Vector (PDF, SVG, PostScript) and Display (X11 and Win32) Output. Published online 2022. https://cran.r-project.org/package=Cairo

The authors would like to thank the Research IT team for their assistance and the use of the Computational Shared Facility at The University of Manchester, on which all the simulations were run. work was supported by funding from the MRC-NIHR Methodology Research Programme. grant number: MR/T025085/1]. NIHR supports IB as Senior InvestigatorThe authors would like to thank the Research IT team for their assistance and the use of the Computational Shared Facility at The University of Manchester, on which all the simulations were run. work was supported by funding from the MRC-NIHR Methodology Research Programme [grant number: MR/T025085/1]. NIHR supports IB as Senior Investigator.

Tutorial in biostatistics: Competing risks and multi-state 79 models. H Putter, M Fiocco, R B Geskus, Stat Med. 26Putter H, Fiocco M, Geskus RB. Tutorial in biostatistics: Competing risks and multi-state 79 models. Stat Med 2007; 26: 2389-2430.

Validity of the Aalen-Johansen estimators of stage occupation 81 probabilities and Nelson-Aalen estimators of integrated transition hazards for non-Markov 82 models. S Datta, G A Satten, Stat Probab Lett. 55Datta S, Satten GA. Validity of the Aalen-Johansen estimators of stage occupation 81 probabilities and Nelson-Aalen estimators of integrated transition hazards for non-Markov 82 models. Stat Probab Lett 2001; 55: 403-411.

Robust Inference for Event Probabilities with Non-Markov Event Data. D Glidden, Biometrics. 84Glidden D V. Robust Inference for Event Probabilities with Non-Markov Event Data. 84 Biometrics 2002; 58: 361-368.

Non-parametric estimation of transition probabilities in non-Markov 86 multi-state models: The landmark Aalen-Johansen estimator. H Putter, C Spitoni, Stat Methods Med Res. 87Putter H, Spitoni C. Non-parametric estimation of transition probabilities in non-Markov 86 multi-state models: The landmark Aalen-Johansen estimator. Stat Methods Med Res 2018; 87 27: 2081-2092.

Inference for events with dependent risks in multiple endpoint studies. M S Pepe, J Am Stat 89 Assoc. 86Pepe MS. Inference for events with dependent risks in multiple endpoint studies. J Am Stat 89 Assoc 1991; 86: 770-778.

Nonparametric estimation of transition probabilities in 91 the non-Markov illness-death model: A comparative study. J De Uña-Álvarez, Meira-Machado , L , Biometrics. 71de Uña-Álvarez J, Meira-Machado L. Nonparametric estimation of transition probabilities in 91 the non-Markov illness-death model: A comparative study. Biometrics 2015; 71: 364-375. 92 7.

Transition probability estimates for non-Markov multi-state models. A C Titman, Biometrics. 93Titman AC. Transition probability estimates for non-Markov multi-state models. Biometrics 93 2015; 71: 1034-1041.

GitHub repository. Manchester Predictive Healthcare Group. A Pate, MRC-Multi-Outcome-95Pate A. GitHub repository. Manchester Predictive Healthcare Group. MRC-Multi-Outcome- 95

. Derivation-Of-Cprd, Dataset, Derivation-of-CPRD dataset., https://github.com/manchester-predictive-healthcare- 96 group/CHI-MRC-multi-outcome/tree/main/Derivation of CPRD dataset (2023).

Kidney Disease Improving Global Outcomes. KDIGO Clinical Practice Guideline for Acute 98 Kidney Injury. Off J Int Soc Nephrol. 2Kidney Disease Improving Global Outcomes. KDIGO Clinical Practice Guideline for Acute 98 Kidney Injury. Off J Int Soc Nephrol; 2, https://kdigo.org/wp- 99 content/uploads/2016/10/KDIGO-2012-AKI-Guideline-English.pdf (2012).

A New Equation to Estimate Glomerular Filtration Rate 101. A S Levey, L A Stevens, C Frcp, Levey AS, Stevens LA, Frcp C, et al. A New Equation to Estimate Glomerular Filtration Rate 101

. Andrew , Ann Intern Med. 150Andrew. Ann Intern Med 2009; 150: 604-612.

Comparison of Risk Prediction Using the CKD-EPI 103. K Matsushita, M Woodward, T H Jafar, Matsushita K, Woodward M, Jafar TH, et al. Comparison of Risk Prediction Using the CKD-EPI 103

Equation and the MDRD Study Equation for Estimated Glomerular Filtration Rate. GitHub: Annalhead/CPRD_multimorbidity_codelists. 30712Equation and the MDRD Study Equation for Estimated Glomerular Filtration Rate. 2012; 307: 104 1941-1951. 105 12. Head A. GitHub: Annalhead/CPRD_multimorbidity_codelists, 106 https://github.com/annalhead/CPRD_multimorbidity_codelists (accessed 26 November 107 2021).

Inequalities in incident and prevalent multimorbidity 109 in England, 2004-19: a population-based, descriptive study. A Head, K Fleming, C Kypridemos, Primary Care Unit CU. CPRD @ Cambridge -Code Lists. 2Lancet Heal LongevHead A, Fleming K, Kypridemos C, et al. Inequalities in incident and prevalent multimorbidity 109 in England, 2004-19: a population-based, descriptive study. Lancet Heal Longev 2021; 2: 110 e489-e497. 111 14. Primary Care Unit CU. CPRD @ Cambridge -Code Lists, 112 http://www.phpc.cam.ac.uk/pcu/cprd_cam/codelists/ (accessed 24 January 2018).

. R Mathur, Data, Compass: Risk factor codelist -Ethnicity. 114Mathur R. LSHTM Data Compass: Risk factor codelist -Ethnicity, 114 https://datacompass.lshtm.ac.uk/id/eprint/2414/ (accessed 26 November 2021).

Factors associated with excess all-cause 116 mortality in the first wave of COVID-19 pandemic in the UK: a time-series analysis using the 117 Clinical Practice Research Datalink. H Strongman, H Carreira, De Stavola, B L , 11817medRxiv 2021; 2021.06.04.21258344Strongman H, Carreira H, De Stavola BL, et al. Factors associated with excess all-cause 116 mortality in the first wave of COVID-19 pandemic in the UK: a time-series analysis using the 117 Clinical Practice Research Datalink. medRxiv 2021; 2021.06.04.21258344. 118 17.

GitHub: opensafely/ethnicity-covid-research. R Mathur, C Morton, 119Mathur R, Morton C. GitHub: opensafely/ethnicity-covid-research, 119

Ethnic differences in SARS-CoV-2 infection and 122 COVID-19-related hospitalisation, intensive care unit admission, and death in 17 million 123 adults in England: an observational cohort study using the OpenSAFELY platform. R Mathur, C T Rentsch, C E Morton, Lancet. 124Mathur R, Rentsch CT, Morton CE, et al. Ethnic differences in SARS-CoV-2 infection and 122 COVID-19-related hospitalisation, intensive care unit admission, and death in 17 million 123 adults in England: an observational cohort study using the OpenSAFELY platform. Lancet 124 2021; 397: 1711-1724.

LSHTM Data Compass: Clinical Code list -Smoking SNOMED Codes. H Forbes, 126Forbes H. LSHTM Data Compass: Clinical Code list -Smoking SNOMED Codes, 126 https://datacompass.lshtm.ac.uk/id/eprint/1603/ (accessed 26 November 2021).

Incidence of acute complications of herpes zoster 128 among immunocompetent adults in England: a matched cohort study using routine health 129 data*. H J Forbes, K Bhaskaran, D Grint, Br J Dermatol. 184Forbes HJ, Bhaskaran K, Grint D, et al. Incidence of acute complications of herpes zoster 128 among immunocompetent adults in England: a matched cohort study using routine health 129 data*. Br J Dermatol 2021; 184: 1077-1084.