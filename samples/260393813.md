# A Review of Formulations, Boundary Value Problems and Solutions for Numerical Computation of Transcranial Magnetic Stimulation Fields

CorpusID: 260393813
 
tags: #Medicine, #Engineering

URL: [https://www.semanticscholar.org/paper/4f5c9f4234fcf8fec117417467df4602abe718be](https://www.semanticscholar.org/paper/4f5c9f4234fcf8fec117417467df4602abe718be)
 
| Is Survey?        | Result          |
| ----------------- | --------------- |
| By Classifier     | True |
| By Annotator      | (Not Annotated) |

---

A Review of Formulations, Boundary Value Problems and Solutions for Numerical Computation of Transcranial Magnetic Stimulation Fields
29 July 2023

J A Pérez-Benítez 0000-0001-8867-5341
ESIME-SEPI
Laboratorio de Bio-Electromagnetismo
Instituto Politécnico Nacional
Edif. Z-407738Mexico City

CDMX
Mexico

P Martínez-Ortiz 0000-0002-6283-4399
ESIME-SEPI
Laboratorio de Bio-Electromagnetismo
Instituto Politécnico Nacional
Edif. Z-407738Mexico City

CDMX
Mexico

J Aguila-Muñoz 0000-0001-5329-6958
CONAHCYT-Centro de Nanociencias y Nanotecnología
Universidad Nacional Autónoma de México
km 107 Carretera Tijuana-Ensenada, Apartado Postal 1422800EnsenadaBCMexico

A Review of Formulations, Boundary Value Problems and Solutions for Numerical Computation of Transcranial Magnetic Stimulation Fields
29 July 2023A0AFF37F7C9CCD666B1020C098516EC710.3390/brainsci13081142Received: 29 May 2023 Revised: 22 July 2023 Accepted: 24 July 2023transcranial magnetic stimulationreviewformulationsboundary value problemsreview of numerical methods
Since the inception of the transcranial magnetic stimulation (TMS) technique, it has become imperative to numerically compute the distribution of the electric field induced in the brain.Various models of the coil-brain system have been proposed for this purpose.These models yield a set of formulations and boundary conditions that can be employed to calculate the induced electric field.However, the literature on TMS simulation presents several of these formulations, leading to potential confusion regarding the interpretation and contribution of each source of electric field.The present study undertakes an extensive compilation of widely utilized formulations, boundary value problems and numerical solutions employed in TMS fields simulations, analyzing the advantages and disadvantages associated with each used formulation and numerical method.Additionally, it explores the implementation strategies employed for their numerical computation.Furthermore, this work provides numerical expressions that can be utilized for the numerical computation of TMS fields using the finite difference and finite element methods.Notably, some of these expressions are deduced within the present study.Finally, an overview of some of the most significant results obtained from numerical computation of TMS fields is presented.The aim of this work is to serve as a guide for future research endeavors concerning the numerical simulation of TMS.

## Introduction

Transcranial magnetic stimulation (TMS) is a method that modulates brain activity using an electric field induced in the brain by potent magnetic field pulses [1][2][3][4].This method is based on the application of magnetic field pulses to the brain cortex using coils, inducing electric fields oriented along certain paths to stimulate or inhibit brain activity in these areas.Several works [5][6][7][8][9] have shown that after TMS treatments, patients show improvement in their conditions, such as depression [5], mania, obsessive-compulsive disorder, post-traumatic stress disorder and schizophrenia [6][7][8][9].TMS in combination with EEG methods [10,11] can also be used as a tool too study brain functions.However, the efficacy of TMS for treatments is highly influenced by factors such as the efficiency [12,13], focality [14][15][16][17][18][19] and convenient distribution [15] of the induced electric fields.Furthermore, these factors are determined by several parameters, such as the quantity, [16,20], arrangement [16,17,20] and geometric parameters of excitation coils [16,18,21,22]; coil distance and orientation with respect to the brain [20,23,24]; excitation current waveform [25][26][27][28][29]; and electric properties of the brain tissues [30][31][32][33][34], among others.

Based on the studies of the influence of the aforementioned parameters on TMS, previous works [35][36][37][38][39][40][41] have analyzed the general mechanisms associated with TMS.From these works, it can be deduced that to optimize the excitation parameter for each TMS application, avoiding ethical conflicts, and for a practical and cost-effective estimation of the effect of the excitation electric field on neuronal activity, it is necessary to use simulation methods.In particular, Roth and Basser [42] proposed a method for computing the electric field and its gradient along a nerve induced by a single coil.They modeled the nerve as a passive cable whose electric potential is influenced by an excitatory electric field gradient.The excitatory electric field corresponds to the primary electric field [42][43][44], which depends only on the magnetic potential vector rate [45,46], without considering the effect of the scalar potential.This approximation was used in the some of initial TMS simulation works [42][43][44] and os still widely used but for coil parameter optimization [21,22].However, it was later demonstrated [47][48][49][50][51] that a more precise estimation of the actual electric field induced in the brain tissues requires consideration of the secondary electric field equal to the negative gradient of the scalar potential.The scalar potential results from the electric charges formed at the tissue interfaces [47][48][49][50][51]. From this point, most of the works dedicated to the computation of the induced electric field [38,[52][53][54][55][56][57] have proposed increasingly more realistic models for the coils, brain geometry and tissue properties and different formulations based on quasistatic approximation of the Maxwell equations [45,46].In particular, quasistatic approximations have varied from magnetic quasi-static Laplace to magnetic quasistatic Poisson formulations, and with improvement of finite-element software, it was possible to include most of the source and potential contributions.However, the simultaneous use of complex coils, realistic brain geometry and complex formulations does not come for free, and even with the use of advanced software, the computational time increases substantially.This fact has brought forward questions such as: how much detail of the coil geometry is necessary to estimate the actual electric field induced by the real coil [58]?The development of new numerical methods such as neural networks [59] has also been motivated in order to increase the computation speed of TMS fields.Nevertheless, the most common approach has been the use of specific formulations of quasistatic approximation of Maxwell equations depending on the TMS applications, which is likely to remain the dominant approach for future TMS numerical computation, which, due to the microscopic size of neurons and nerves, requires increasing resolution and precision.Therefore, it is necessary to know the limitations and advantages of different formulations, as well as the different available numerical methods for their solutions.


## Scope and Contributions

The TMS formulations analyzed in the present work correspond to the Maxwell equation potential representations and their quasistatic approximations, which are solved using numerical methods [1][2][3][4][5][6][7][8][9].Other methods such as the impedance method [99] and neural network methods [59] are not considered in this review.The methods that start from Maxwell equations but derive non-differential equation representations such as dipole-based methods [100] are also not considered in the present analysis.

The objective of this study is to serve as a comprehensive guide for the numerical computation of TMS fields by reviewing previous works in this field.To achieve this, a series of deductions leading to various quasistatic approximations for the computation of TMS fields are presented, followed by a review of works that have utilized these approximations.Furthermore, the numerical solutions using finite difference and finite element methods are discussed in detail, drawing upon existing methods proposed in the literature.Additionally, this study deduces methods not found in the consulted literature, such as finite difference for quasistatic magnetic A-φ and Darwin models and finite element for quasistatic magnetic A-φ and Darwin models using the Galerkin method, as well as their implementation of boundary conditions applied to TMS fields.

The papers included in this review pertaining to field simulations in TMS were systematically chosen in a chronological manner, with emphasis placed on commencing with highly impactful publications based on their citation count.Additionally, works that cited these influential papers while introducing novel variants of formulations and numerical methods were also considered.It is essential to acknowledge that not all the works encompassing TMS field simulations propose new formulations or numerical methods.In fact, a significant portion of the TMS field simulation literature references the original works that introduced these methods, with their contributions primarily concentrated in the domain of applications.Every effort was made to incorporate as many of these application-oriented works as feasible.


## Field Theory of TMS


### Maxwell Equations and Their Representation Using Vector and Scalar Potentials

To reduce the computational time and facilitate the numerical computation of TMS fields, some quasistatic approximations of the Maxwell equations [45,46] or, more specifically, their vector and scalar representation have been proposed [42][43][44][47][48][49][50][51].Each of the formulations described below, some of which were used in previous TMS works, is derived from the potential representation of Maxwell equations.The classical forms of Maxwell equations are the Maxwell-Faraday, Maxwell-Ampere, Maxwell-Thompson and Maxwell-Gauss equations, expressed, in that order, as follows:
∇ × E = − ∂ B ∂t (1a) ∇ × H = J s + J ind + ∂ D ∂t (1b) ∇ • B = 0 (1c) ∇ • D = ρ (1d)
The constitutive equations should also be considered:
D = E = o r E (2a) B = µ H = µ o µ r H,(2b)
as well as Ohm's law
J = σ E(3)
which establish the relation between the current density and the electric field.The Maxwell equations could be expressed using vector and scalar potentials [45,46].Since the divergence of the curl of a vector is always zero, ∇ • ∇ × A = 0.Then, B, the divergence of which is zero according to the Maxwell-Thompson equation ( ∇ • B = 0), could be replaced by the curl of an arbitrary vector such that:
B = ∇ × A (4)
where A is the vector magnetic potential.Substituting this expression into the Maxwell-Faraday's Equation (1a) and considering the distributive and commutative properties of the curl and the partial derivative, the following expression is obtained:
∇ × E + ∂ A ∂t = 0(5)
According to Jackson [45], ∇ × − ∇φ = 0 for any scalar function as it is, for example, for the electric scalar potential (φ).Then, the term inside the curl can be expressed as E + ∂ A ∂t = − ∇φ and resolving with respect to E:
E = − ∂ A ∂t − ∇φ(6)
Substituting Equations ( 3) and ( 6) and the constitutive Equation ( 2) into the Maxwell-Ampere Equation (1b) results in:
∇ × 1 µ ∇ × A + σ ∂A ∂t + ∇φ + ∂ ∂t ∂A ∂t + ∇φ = J s(7)
Applying the divergence operator to this equation and taking into account the aforementioned identity, i.e., that the divergence of the curl of a vector is always zero, gives:
∇ • σ ∂ A ∂t + ∇φ + ∇ • ∂ ∂t ∂ A ∂t + ∇φ = ∇ • J s (8)
where J s is the external current density.Using Equations ( 7) and ( 8), the full Maxwell equations are represented using vector and scalar potentials.However, the computational cost required to solve this set of differential equations could be significantly high depending on the geometry of the domains and their electric and magnetic properties.These equations could be simplified by making some considerations valid for TMS excitation characteristics and electric and magnetic properties of brain tissue.The formulations corresponding to this approximations are referred to in the literature as quasistatic approximations.The most well-known quasistatic approximations are [45,60,61] electro-quasistatic (EQS) approximation, which enables modeling of the potentials under the influence of conduction and displacement currents, including capacitive-resistive effects, but neglects the inductive phenomena; magnetic quasistatic (MQS) approximation, which neglects displacement current and capacitive effects and considers inductive phenomena; and the Darwin model, which comprises short-off electromagnetic quasistatic approximation and allows for the inclusion of inductive phenomena, as well as capacitive effects.


### Poisson MQS φ-Formulation

The principle of TMS stimulation is that an electric field is induced in the brain by a time-varying magnetic field.The magnetic field is produced by a coil (or coils) fed by current peaks.Therefore, it is impossible to neglect inductive phenomena.Consequently, the behavior of potential can be computed using MQS.In MQS, the most restrictive formulation is the MQS-φ formulation, which is based on three approximations:

1.

The wavelength of the excitation field is significantly higher than the size of the head.For TMS pulses with a duration of τ ≥ 0.1 ms corresponding to a frequency of f ≤ 10 kHz, the corresponding wavelength is λ ≥ 300 m, which is much higher than the head dimensions; 2.

Diminishment of the capacitive effects in the brain tissue: Resulting from continuity conditions of electric currents in the interface between materials with different electric conductivities [45], the electric charges accumulate in this area, which could provoke capacitive effects.However, under this quasistatic approximation, induced charges are considered to move freely inside the brain, not allowing for static accumulation of charges that could generate capacitive effects.Furthermore, polarization effects are not considered; 3.

Neglecting the skin-effect: A time-varying magnetic field induces electric currents that oppose the magnetic field.The amplitude of the induced current is proportional to the electric conductivity.Consequently, when a magnetic field enters a medium with an electric conductivity other than zero, it decays as it penetrates in the medium.However, the electric conductivity of brain tissue is low (σ whitematter = 0.15 S/m), and together with the paramagnetic magnetic properties of these tissues, δ = 1/ π f µσ ≈ 5 m [62], which confirms this approximation.

To apply these approximations to Equations ( 7) and (8), it is important to explain the cause-effect relations in these equations.According to Equation ( 6), Ohm's Law and the constitutive equation for the electric flux density, Equation ( 7) can be expressed as:
∇ × 1 µ ∇ × A = J s + J ind + J disp(9)
where J ind = σ E = −σ ∂A ∂t + ∇φ are the induced conductive currents or eddy currents, and
J disp = ∂ D ∂t = ∂ ∂t E = − ∂ ∂ ∂A ∂t + ∇φ
are the displacement currents.This expression shows that the magnetic field is induced by an external current whose value decreases due to the induced currents.The induced currents can be computed according to Equation (8) , which can be rewritten as:
∇ • J ind + ∇ • J disp = − ∇ • J s (10)
The simplification of the MQS φ-formulation implies neglect of the effects of eddy currents on the magnetic field (no skin effect) and of the displacement currents (no capacitive effects).Consequently, this approximation implies removing J ind and J dis from Equation ( 9).This approximation does not mean that the induced current is zero but that J ind << J s .Furthermore, all the materials involved in the phenomenon are paramagnetic (µ r = 1).Therefore, Equation (9) becomes:
∇ × ∇ × A = µ 0 J s(11)
Since the vector magnetic potential is not unique, a restriction such as the Coulomb gauge (∇ • A = 0) could be used [45], which, together with the identity ∇ × ∇ × A = ∇ ∇ • A − ∇ 2 A, modifies Equation (9) as follows:
∇ 2 A = −µ 0 J s(12)
On the other hand, in the domain of the brain, neglecting the displacement current, J dis = 0, and since there is no external current, J s = 0, and Equation (10) becomes:
∇ • J ind = 0 (13) or ∇ • σ ∂ A ∂t + ∇φ = 0(14)
which could also be expressed as:
∇ • σ ∇φ = − ∇ • σ ∂ A ∂t (15)
Expressions ( 12) and ( 15) could be used to obtain A(r, t) and φ(r, t), which allow for computation of the TMS-induced electric field ( E) using Equation (6).For this purpose, the electric field is divided in two components: E = E p + E s , where:
E p = − ∂ A ∂t (16)
is called the primary electric field and
E s = −∇φ(17)
is the secondary electric field.This formulation can be called the Poisson MQS φ-formulation, since both expressions are Poisson equations.This is also a φ formulation because A and φ are only partially coupled.The scalar electric potential (φ) is produced by electric charges induced by the time variation of the vector magnetic potential ( A), but the influence of the electric field on the magnetic potential is neglected.This approximation has the advantage that it could be easily solved using numerical methods with low computational resources.However, it is necessary to consider the aforementioned limitations of the model.


### Laplace MQS φ Formulation

A further simplification of the Poisson MQS formulation consists of considering that the electric charges responsible for the secondary electric field are formed only at the brain-to-air interface.The principle of TMS stimulation is that an electric field is induced in the brain by a time-varying magnetic field.The magnetic field is produced by a coil (or coils) fed by current peaks.The accumulation of charges at the brain-to-air interface could be explained by considering the following principles: The primary electric field (E p ) is computed as if the medium were isotropic and uniform.Therefore, E p is continuous across all interfaces.
E 1 p • n = E 2 p • n = E p • n(18)
According Ohm's Law, J p i = σ i E p , and considering that electric conductivities of the interfacing areas are different, (σ 1 = σ 2 ), at the interfaces:
σ 1 E p • n = σ 2 E p • n(19)
Therefore,
J 1 p • n = J 2 p • n(20)
In the quasistatic limit, the normal component of total current crossing an interface between tissues is continuous, and it is given by the continuity law [45]:
J 1 • n = J 2 • n(21)
which seems to contradict (20).However, this law is satisfied by the formation of electric charges, which generate a secondary electric field ( E s ) and the corresponding current ( J i s = σ i E i s ).In this case, Equation ( 21) can be expressed as:
J 1 p + J 1 s • n = J 2 p + J 2 s • n(22)
or
σ 1 E p + E 1 s • n = σ 2 E p + E 2 s • n(23)
The fact that the secondary fields in the media of the interface are different compensates for the total electric field in such a way that the continuity condition holds.In the case of the brain-to-air interface, σ air = σ 2 = 0.Then, Equation (23) reduces to:
σ 1 E p + E 1 s • n = 0 (24)
or
σ 1 ∇φ • n + σ 1 ∂ A ∂t • n = 0 (25)
Since the charges and the corresponding electric currents are restricted to the brain boundary, which corresponds to the case when the brain model is made of a uniform tissue, then σ is considered to be uniform and isotropic inside the brain, and Equation (15) for the brain domain becomes:

∇ 2 φ = 0 (26) This Laplace equation can be used to compute the electric potential inside the brain domain.To obtain a unique and non-trivial solution from this equation, the Neumann boundary condition expressed by Equation ( 25) should be used.After obtaining φ from Equation (26) with the boundary condition (25) and A from Equation (12), the electric field is computed using Equation (6).


### MQS A-φ Formulation

If only capacitive effects are neglected ( J dis = 0) using the general transformations and considerations described in Section 3.2, Equations ( 7) and ( 8) can be expressed as:
σ ∂ A ∂t + ∇φ + 1 µ 0 ∇ × ∇ × A = J s (27a) ∇ • σ ∇φ + ∇ • σ ∂ A ∂t = 0 (27b)
or using the Coulomb gauge:
σ ∂ A ∂t + ∇φ − 1 µ 0 ∇ 2 A = J s (28a) ∇ • σ ∇φ + ∇ • σ ∂ A ∂t = 0 (28b)
which is the transient representation of the MQS A-φ formulation.In this case, A and φ are coupled, and the effects of the conductively induced currents on A are considered.However, due to the complexity of numerical computation of the time-dependent functions ( A(r, t) and φ(r, t)), it is more usual to use the harmonic expressions of Equations (28a) and (28b):
jωσ A + σ ∇φ + 1 µ 0 ∇ × ∇ × A = J s (29a) jω ∇ • σ A + ∇ • σ ∇φ = 0 (29b)
The harmonic formulation can be used considering that the stimulation current presents a constant frequency (ω).This approximation should be used carefully, since the stimulation peak patterns are far from having a harmonic waveform.It seems unnecessary and a waste of computational resources to consider the induction currents for TMS.However, this approach could be useful for optimizing the effect of electric conductivity and geometry of the coil on the TMS. .It could also be used for analyzing TMS in subjects with non-normative brains, such as those with brain implants.


### TMS Full Maxwell Equation Formulation and the Darwin Model

The numerical computation of the electric field can be performed without any quasistatic approximation using Equations ( 7) and ( 8), but again, the complexity of the numerical computation of these equations is substantial.Therefore, the harmonic formulation of these equations is more commonly used:
jωσ − ω 2 o r A + (σ + jω o r ) ∇φ + 1 µ 0 ∇ × ∇ × A = J s (30a) ∇ • jωσ − ω 2 o r A + ∇ • (σ + jω o r ) ∇φ = ∇ • J s (30b)
Nevertheless, apart from the harmonic stimulus limitation, this formulation still presents high computation complexity.An alternative that could be used for transient process computation is the Darwin model [61].The Darwin model is not a full Maxwell equation formulation but allows for consideration of almost all the coupled effects, except for wave propagation.Since the domain scale in TMS is significantly smaller than the wavelength of the excitation magnetic field, simulation of wave propagation is completely unnecessary.The Darwin model is based on Helmholtz decomposition [45], in which the electric field is decomposed into an irrotational component and a solenoid component: E = E irr + E sol , where ∇ × E irr = 0 and ∇ • E sol = 0.After replacing the electric field in the Maxwell equations with these approximations, neglecting the radiation effects and replacing the expression of the potentials yields:
∇ × 1 µ ∇ × A + σ ∂A ∂t + ∇φ + ∂ ∂t ∇φ = J s (31a) ∇ • σ ∂ A ∂t + ∇φ + ∇ • ∂ ∂t ∇φ = ∇ • J s(31b)
This formulation takes into account all the effects relevant for TMS included in the full Maxwell equation formulation, and it is less computationally complex than integrating the full Maxwell equations.Moreover, in this case, it seems excessive to include capacitive effects for TMS simulations, but it could be useful to optimize the stimulation devices and for analysis of TMS in subjects with non-normative brains, such as those with brain implants.


### Boundary Value Problems of TMS

Figure 1 shows the domain and boundary representation of a generic TMS setup.The meaning of the domains, their boundaries, and electric and magnetic properties are shown in Table 1.

The coil is a special domain, as the source of external current, the electric conductivity of which depends on the type of quasistatic formulation.In this case, it is not the boundary that is relevant but the integration path used to compute the magnetic potential vector, as shown latter.Table 1.Domains, their boundaries, and electric and magnetic properties.


## Domain Boundary

Applicable Properties Description
Ω Γ σ = 0, r = 1, µ r = 1
System domain that includes all other domains:
Ω = Ω a ∪ Ω c ∪ Ω b .
Its boundary is limited by the air exterior boundary:
Γ ∩ Γ a = Γ Ω a Γ a σ = 0, r = 1, µ r = 1 Air Ω c Σ c (integration path) σ = {0, σ cupper }, r = 1, µ r = 1 Coil Ω b Γ b σ = 0, r = 1, µ r = 1
The brain, composed of several brain tissues
(Ω b = n i=0 Ω i b ); its boundary is limited by the air (Γ a ∩ Γ b = Γ b ) Ω i b Γ i b σ = 0, r = 1, µ r = 1
Brain tissues.Some of these domains are considered to, partially share boundaries
(Γ i b ∩ n j=0 Γ j b = O, ∀i = j)
Based on these assumptions related to the domains, the boundary value problems(BVP) can be expressed as follows:

The Laplace MQS-φ BVP:
∇ 2 A = −µ 0 J s on Ω (32a) ∇ 2 φ = 0 on Ω b (32b) ∇ × A • n = 0 on Γ (32c) ∇φ • n = − ∂ A ∂t • n on Γ b (32d)
The Poisson MQS-φ BVP:
∇ 2 A = −µ 0 J s on Ω (33a) ∇ • σ ∇φ = − ∇ • σ ∂ A ∂t on Ω b (33b) ∇ × A • n = 0 on Γ (33c) ∇φ • n = 0 on Γ (33d)
The MQS A-φ BVP:
σ ∂ A ∂t + ∇φ − 1 µ 0 ∇ 2 A = J s on Ω (34a) ∇ • σ ∇φ = − ∇ • σ ∂ A ∂t on Ω b (34b) ∇ × A • n = 0 on Γ (34c) ∇φ • n = 0 on Γ (34d)
The Darwin model BVP:
∇ × 1 µ ∇ × A + σ ∂A ∂t + ∇φ + ∂ ∂t ∇φ = J s on Ω (35a) ∇ • σ ∂ A ∂t + ∇φ + ∇ • ∂ ∂t ∇φ = ∇ • J s on Ω (35b) ∇ × A • n = 0 on Γ (35c) ∇φ • n = 0 on Γ (35d)
Several works have used the MQS φ formulation.Table 2 lists some of these works and their models: A neurocortical neuron model and a coil [77] E p + skin effect A coil over an non-homogeneous volume conductor [54] Laplace MQS-φ A coil over a cylindrical volume conductor [43] Three types coils over a spherical volume conductor [48] An arbitrarily shaped coil over a half-plane conductor [49] A circular coil over a spherical conductor [72,88,97] A coil over a half-plane tissue [84]  A circular coil over a parallelepiped volume conductor [47,51,95] A coil over an approximate brain model [52,93] Figure-8 coil over several brain models [73] Figure-8 coil over a high-resolution brain model [74,86] Uniform and realistic E-fields and a realistic brain model [78] MQS A-φ An 8-shaped coil over a cortical sulcus [39,98] A circular coil over a realist head model [53] A custom coil over three concentric spheres [76] Figure


## Solutions of TMS Field BVPs


### Solution of MQS-φ BVP

Various methods have been proposed to address the MQS-φ formulation.In the case of the Laplace MQS-φ formulation, one of the most common solution is, first, to compute the primary field, E p = − ∂ A ∂t , where A is obtained by integrating the Poisson Equation (32a) over the volume of the coil (Ω coil ), which gives:
A(r o , t) = µ o 4π Ω coil J s (r, t) |r − r o | dV (36)
where J s (r, t) is the current density.This equation is easy to solve numerically.For example, in the case of a circular coil with uniform current density (J s (t)), a constant cross-section area (S) and a current path in a plane perpendicular to the z axis in the domain (Ω), each component of the magnetic potential vector at the position of r = r o , A(r o , t) could be computed as as:
A(r o , t) = µ o SJ s (t) 4π Σ coil 1 |r − r o | d l(37)
where Σ coil is the path.Equation ( 37) can be numerically computed as follows:
A x (r o , t) = µ o SJ s (t) 4π N−1 ∑ i=0 ∆x i (x i − x o ) 2 + (y i − y o ) 2 + (z i − z o ) 2 (38a) A y (r o , t) = µ o SJ s (t) 4π N−1 ∑ i=0 ∆y i (x i − x o ) 2 + (y i − y o ) 2 + (z i − z o ) 2 (38b) A z (r o , t) = 0, ∀r o Ω (38c) ∀ r = (x i , y i , z i ) Ω, r = r o
where
x i = X m + R cos(ψ i )(39a)y i = Y m + R sin(ψ i )(39b)
and
∆x i = x i+1 − x i , ∆y i = y i+1 − y i (40)
where S, X m and Y m are the coil cross-sectional area, the coil center position on the x axis and the coil center position on the y axis, respectively.It is possible to set up different types of excitation coils by adding coils with different parameters, positions and sizes .

Once the primary field is obtained, the secondary field can be computed using the following equation: E s = −∇φ, where φ is obtained after solving the Laplace Equation (32b) and the boundary condition (32d).

In the case of the Poisson MQS-φ formulation, A is computed using the same procedure as in the Laplace formulation, but φ is computed by solving the Poisson Equation (33b) with boundary conditions (33c) and (33d).This equation can be solved using numerical, analytical or semianalytical methods depending on the complexity of the brain model.Two of the most commonly used numerical methods are the finite difference method (FDM) [63][64][65][66][67] and the finite element method (FEM) [64,[68][69][70].

Equation (33b) for the scalar potential can be expressed as:
∇ • (σ∇φ) = ∇σ • ∇φ + σ • ∇ 2 φ = ∇ • J ind(41)
where
J ind = σ E = −σ ∂ A ∂t is the conductively induced current.
The FDM to solve this Poisson equation can be implemented using the interactive method:
φ i,j,k = 1 α [ σ i− 1 2 ,j,k φ i−1,j,k + σ i+ 1 2 ,j,k φ i+1,j,k ∆x 2 + σ i,j− 1 2 ,k φ i,j−1,k + σ i,j+ 1 2 ,k φ i,j+1,k ∆y 2 + σ i,j,k− 1 2 φ i,j,k−1 + σ i,j,k+ 1 2 φ i,j,k+1 ] ∆z 2 + 1 2α   J x i+1,j,k − J x i−1,j,k ∆x + J y i,j+1,k − J y i,j−1,k ∆y + J z i,j,k+1 − J z i,j,k−1 ∆z  (42)
where α =
σ i− 1 2 ,j,k +σ i+ 1 2 ,j,k ∆x 2 + σ i,j− 1 2 ,k +σ i,j+ 1 2 ,k ∆y 2 + σ i,j,k− 1 2 +σ i,j,k+ 1 2 ∆z 2 and J x i,j,k = σ i,j,k E x i,j,k , J y i,j,k = σ i,j,k E y i,j,k , J z i,j,k = σ i,j
,k E z i,j,k are the currents densities due to the primary electric field (E p = (E x p , E y p , E z p )), and ∆x, ∆y and ∆z are the grid intervals.This method is valid for σ = 0.

It is clear that in the case of the Laplace MQS-V formulation, the same approach as before could be used, except that J ind = 0,
φ i,j,k = 1 6 φ i−1,j,k + φ i+1,j,k + φ i,j−1,k + φ i,j+1,k + φ i,j,k−1 + φ i,j,k+1(43)
This expression should be solved using the boundary conditions (32d), which can be expressed as:
∂φ ∂x n x + ∂φ ∂y n y + ∂φ ∂z n z = E p x n x + E p y n y + E p x n z(44)
which is solved using the finite difference as: φ i,j,k =
1 nx ∆x + ny ∆y + nz ∆z E p x + φ i−1,j,k ∆x n x + E p y + φ i,j−1,k ∆y n y + E p z + φ i,j,k−1 ∆z
n z It is also important to note that the above numerical solution corresponds to an Euclidean coordinate system, and consequently, the brain should be circumscribed inside an air cube, and the boundary conditions in this case correspond to an interior boundary.From a computational coding perspective, the FDM is straightforward.However, the precision and the computation time required by this method depend on the complexity of the geometry.


#### Solutions Using FEM

The FEM usually requires much less computational time than the FDM but can be more tricky to implement.The Poisson MQS-φ BVP can be solved with FEM using different approaches: the direct minimization of energy functional and the weighted residuals or the Galerkin method .For example, Weiping Wang and Solomon R. Eisenber [95] considered the following energy functional:
W(φ) = J • E dV,(45)
which represents the energy dissipated in the conduction media during the induction process.Using the expressions of the induced current and electric fields, the resultant equation is:
W(φ) = σ ∇φ + ∂ A ∂t • ∇φ + ∂ A ∂t dV (46)
The objective is to find the potentials (φ and A) that minimize the energy functional, i.e., W(φ).The potentials at any coordinate (x, y, z) inside the domain can be obtained from the potential at the nodes of the finite elements (usually tetrahedral elements), in which the domain is divided using interpolation functions:
Φ e (x, y, z) = n n ∑ i=1 φ e i N i (x, y, z)(47a)
A e (x, y, z) =
n n ∑ i=1 A e i N i (x, y, z)(47b)
where n n is the number of nodes of the finite elements, n n = 4 represents tetrahedral elements, N i (x, y, z) are the interpolation functions and φ e i , A e i = (A x ) e i i + (A y ) e i j + (A z ) e i k are the electric scalar potential and the spacial part of the magnetic vector potential, respectively, corresponding to node i in element e.In this case, variable separation for the magnetic potential vector ( A(x, y, z, t) = A(x, y, z) • f (t)) is assumed .The interpolation functions are usually linear functions of the form N i (x 1 , x 2 , . . ., x n n ) = ∑ n n j=1 a j i x j + d.For example, in the case of tetrahedral elements (N i (x, y, z) = a i x + b i y + c i z + d), the coefficients are obtained by solving a linear equations system, considering that N i (x, y, z) = 1 for x = x i , y = y i , z = z i and N i (x, y, z) = 0 for x = x j , y = y j , z = z j , where x i , y i , z i are the coordinates of node i, and x j , y j , z j are the coordinates of the other nodes of the element.

The integral corresponding to total dissipated power for each element given by Equation (46) is divided in two parts: a voltage-dependent power and a constant term:
W e (Φ e ) = W e N (Φ e ) + W e const (48) Considering that ∂ A ∂t = ḟ A(x, y, z), ḟ = ∂ f (t) ∂t . W e N (Φ e ) = σ(∇Φ e ) 2 + 2σ ḟ A • ∇Φ e dV(49)W e const (Φ e ) = ( ḟ ) 2 σ( A) 2 dV(50)
The constant term does not influence the minimum value of the functional and is therefore removed.The potential dependent term after replacing Equations (47a) and (47b) gives:

W e N (Φ e ) = (Φ e ) T P e Φ e + (Φ e ) T Q e (51
)
where Φ e = (φ e 1 , φ e 2 , φ e 3 , φ e 4 , . . ., φ e n n ) T is the vector of scalar potentials corresponding to the nodes of the element (e), P e is a square matrix and Q e is a column vector given by:
P e ij = σ∇N i • ∇N j dV(52)
and
Q e i = 2 ḟ n n ∑ j=1 σ∇N i • A j N j dV(53)
These integrals are very easy to compute, since the interpolation functions are linear functions.For example, in the case of tetrahedral elements, the integrated expressions are:
P e ij = V e Λ x i a j + Λ y i b j + Λ z i c j(54)
and
Q e i = 2 ḟ V e 2 4 ∑ j=1 Λ x i A x j + Λ y i A y j + Λ z i A z j (55)
where V e is the volume of the element, and
Λ k i = σ kx a i + σ ky b i + σ kz c i , k = x, y, z.
Equation (51) corresponds to the power dissipated in one element.The total power is obtained as the sum of the power of all elements:
W N (Φ) = ∑ e W e N (Φ e )(56)
Nevertheless, it is worth noting that to obtain this sum, the dimensions of the vectors (Φ e and Q e ) and the matrix (P e ) should be increased such that dim(Φ e ) = n n × N e , dim(Q e ) = n n × N e and dim(P e ) = (n n × N e ) 2 , filling the rest of the components with zero and shifting the position of the vector or matrix according to the element index (e) and the number of nodes n n .For example, the new vector (Φ e ) should look like: Similarly to the vector (Q e ), the matrix (P e ) should look like:
Φ e =    (e−P e =                 (e − 1) × n n + 1 0 . . . 0 • • • 0 0 . . . . . . . . . . . . 0 • • • P e 11 • • • P e 14 • • • 0 . . . . . . . . . . . . 0 • • • P e 41 • • • P e 44 • • • 0 . . . . . . . . . . . . 0 • • • 0                            (e − 1) × n n + 1(58)
In the new space, which is called disjoint space, Equation (56) can be written as:
W dis (Φ dis ) = Φ T dis P dis Φ dis + Φ T dis Q dis (59)
The potentials in the disjointed space are represented by variables refereed to each element, which gives a large number of variables.The number of variables can be reduced significantly by considering that neighbor elements share nodes, and therefore, it is possible to use the same variable for the potential of the nodes shared by different elements.In other words, the variables can be renamed using a common global notation for all the nodes inside the domain.This process is called assembly and can be performed using a connectivity matrix (C) such that:
Φ dis = CΦ asem(60)
Substituting this equation into Equation (69) gives:
W asem (Φ asem ) = Φ T asem PΦ asem + Φ T asem Q(61)
where P = CP dis C T and Q = CQ dis .The linear equation system used to obtain the potentials at each node (Φ i ) is formed by finding the minimum of the energy with respect to each node potential:
∂W(Φ) ∂Φ i = 0 (62)
which results in the following linear equation system:
2PΦ + Q = 0(63)
Furthermore, to obtain a unique solution, it is necessary to impose an additional condition, which is usually achieved nu setting the potential of the Nth node to zero (Φ N = 0).Thus, the equation system is updated by removing the Nth row and column of matrix P and the last element of Q, resulting in a matrix (P (dim(P ) = (N − 1) × (N − 1))) and a vector (Q (dim(Q ) = 1 × (N − 1))).The solution for the equations system is:
Φ = − 1 2 P −1 Q(64)
After computing the scalar potential, it is possible to obtain the electric field using Equation (6).


#### Weighted Residual Galerkin Method

The Weighted residual Galerkin method [68,69] is one of the most widely used FEMs.In this case, the starting point is Equation (32), which considers the domain of a single element (Ω e ), and the weak formulation [68,69] and the residual for the element (e) can be written as :
r e = ∇ • σ ∇φ + ∇ • σ ∂ A ∂t (65)
If the numerical solution were exact, the residual would be zero.However, since the numerical solutions are not ideal, it is necessary to find a solution that minimizes the residual or, in the case of this method, the weighted residual.The procedure involves multiplying the residual by a weight (w), integrating this product over the volume of the element and setting the integral to zero.
Ω e w r e dV = Ω e w ∇ • σ ∇φ + ∇ • σ ∂ A ∂t dV = 0 (66)
using the identity ∇ • w A = w ∇ • A + A • ( ∇w), which implies that:
w ∇ • A = ∇ • w A − A • ( ∇w)(67)
Using this identity, Equation ( 67) can be modified as:
Ω e ∇ • wσ ∇φ dV − Ω e σ ∇φ • ∇w dV + Ω e w ∇ • σ ∂ A ∂t dV = 0 (68)
Applying the divergence theorem [45] ( Ω e ∇ • F dV = Γ e F • n dS) to the first term of Equation ( 68) and rearranging the equation yields:
− Ω e σ ∇φ • ∇w dV + Ω e w ∇ • σ ∂ A ∂t dV + Γ e w σ ∇φ • ndS = 0 (69)
The three components of this equation are the potential-dependent term, the source term and the boundary condition term, in that order.The source term can be modified by considering the induced current density (
J = − σ • ∂ A ∂t ):
−
Ω e σ ∇φ • ∇w dV − Ω e w ∇ • JdV + Γ e w σ ∇φ • ndS = 0 (70)
According to the Garlerkin formulation [68], the weight function (w) should be set equal to the interpolation functions:
w = N e i (x, y, z) = a i x + b i y + c i z + d(71)
Moreover, using Equation (47a) for the interpolation of the scalar potential (φ e ) and considering the interpolation for the induced current density values:
J e (x, y, z) = n n ∑ i=1 J e i N i (x, y, z)(72)
Equation (70) becomes a system of n n equations, where n n is the number of element nodes:
P e Φ e + Q e J e + B e = 0 (73)
where
P e ij = Ω e σ edim(P e ) = n n × n n , dim(Q e ) = n n × n n , dim(J e ) = 1 × n n , dim(B e ) = 1 × n n ,
Due to the fact that the normal vector of the faces shared by two neighbor elements has opposite directions [68,69], the integral B e cancels for interior element boundaries, and B e is different from zero only for the outer boundaries.Furthermore, if the simulation is performed considering an air box circumscribing the brain, in the air, σ = 0; therefore, B e (x, y, z) = 0, ∀(x, y, z) Ω sys .Accordingly, this term can be removed from the equation, and the equation system becomes:
P e Φ e + Q e J e = 0 (75)
On the other hand, if the brain is considered the outer boundary and the approximation of having only one tissue interface, for example, the interface between the brain and the air, the second term can also be modified using the divergence theorem, which gives:
− Ω e σ ∇φ • ∇w dV + Γ e w σ ∂ A ∂t ndS + Γ e w σ ∇φ • ndS = 0 (76) or − Ω e σ ∇φ • ∇w dV + Γ e w σ ∂ A ∂t + σ ∇φ • ndS = 0 (77)
Considering the boundary condition corresponding to Equation (32d), it is evident that the second term is zero.Therefore, for this particular case, Equation (77) becomes:
Ω e σ ∇φ • ∇w dV = 0 (78)
which gives the following linear equation system:
PΦ = 0(79)
The trivial solution (Φ = 0) is avoided, considering the boundary condition expressed by Equation (32d) for boundary nodes.This can be implemented in several forms, for example, by considering the following equation system that results from condition Equation (32d):
∂Φ ∂x = − ∂A x ∂t = E p x (80a) ∂Φ ∂y = E p y (80b) ∂Φ ∂z = E p z(80c)
The value of Φ for the boundary nodes can be obtained from these equations for each element separately, forming a 3 × 3 linear equation system:
3 ∑ i=1 Φ e i ∂N s i ∂x = (E p x ) e (81a) 3 ∑ i=1 Φ e i ∂N s i ∂y = (E p y ) e (81b) 3 ∑ i=1 Φ e i ∂N s i ∂z = (E p z ) e(81c)
where N s i represents the interpolation functions for the potential of the nodes forming the triangular face, that is, facing the outer boundary, and (E Equation (75) corresponds to one element.To solve the global equation system, it is necessary to assembly the matrices for the entire domain (Ω).This can be done again by applying a procedure similar to that explained in the previous section.The dimensions of the matrices (P e and Q e ) and the vectors (J e and Φ e ) are extended as shown in Equations ( 57) and ( 58), generating a system of linear equations in the disjointed space such that:
P dis = ∑ e Ω P e(82)Q dis = ∑ e Ω Q e(83)
and
J dis = ∑ e Ω J e . (84)
Therefore,
P dis Φ dis + Q dis J dis = 0 (85)
There is also a redundancy of variables of the disjointed space due to the presence of shared nodes between neighbor elements.To remove this redundancy, it is necessary to assemble the matrices using an assembly process as in the previous section, which can be achieved using the connectivity matrix:
Φ dis = CΦ asem(86)
J dis = CJ asem (87) and substituting in (85):
P asem Φ asem + K asem = 0 (88)
where P asem = P dis C and K asem = Q dis CJ asem , and the potential can be obtained from:
Φ asem = P −1 asem K asem (89) 4.2. Solution of MQS Φ-V BVP 4.2.1. Solution Using FDM
The FDM can be applied to solve the BVP given by Equation ( 34) using several approaches.One of the most straightforward methods is the explicit interactive method [63], which can also be applied using different considerations.For example, in the case of isotropic conductivity, Equation (34a) can be divided in three equations corresponding to each of three coordinates in the Euclidean space.If Cartesian coordinates are used:
σ ∂A x ∂t + ∂φ x ∂x − 1 µ 0 ∇ 2 A x = J s x (90a) σ ∂A y ∂t + ∂φ y ∂y − 1 µ 0 ∇ 2 A y = J s y (90b) σ ∂A z ∂t + ∂φ z ∂z − 1 µ 0 ∇ 2 A z = J s z (90c)
The procedure to obtain the electric field is described as follows:

1.

For t = 0, J = 0; therefore, Φ, A = 0; 2.

For t = t 1 , A is obtained from Equation ( 90) using the explicit interactive method in an isotropic grid (∆x = ∆y = ∆z = ∆h) as follows:
σ i,j,k (A t x ) i,j,k − (A t−∆t x ) i,j,k ∆t − 1 µ 0 (A t x ) i−1,j,k + (A t x ) i+1,j,k + (A t x ) i,j−1,k (∆h) 2 + 6 µ 0 (A t x ) i,j,k (∆h) 2 − 1 µ 0 (A t x ) i,j+1,k + (A t x ) i,j,k−1 + (A t x ) i,j,k+1 (∆h) 2 +σ i,j,k (Φ t−∆t x ) i+1,j,k − (Φ t−∆t x ) i−1,j,k 2∆h = (J s x ) i,j,k(91)
which, resolved with respect to (A t x ) i,j,k , gives:
(A t x ) i,j,k = 1 α [β (A t x ) i−1,j,k + (A t x ) i+1,j,k + (A t x ) i,j−1,k + (A t x ) i,j+1,k + (A t x ) i,j,k−1 + (A t x ) i,j,k+1 ]+ γ α (Φ t−∆t x ) i+1,j,k − (Φ t−∆t x ) i−1,j,k + θ α (A t−∆t x ) i,j,k + 1 α (J s x ) i,j,k(92)
where α =
σ i,j,k ∆t + 6 µ o (∆h) 2 , β = 1 µ o (∆h) 2 , γ = − σ i,j,k 2∆h and θ = σ i,j,k
∆t .This equation is applied recursively to all nodes, except for the boundary nodes (where the solution is already given) and given the initial condition ( A = 0) until the solution converges.The obtained value of A is replaced in Equation ( 41), which can be resolved for Φ using Equation (42); 3.

The same procedure is applied to compute A y and A z ; 4.

The values of A and Φ are used to compute the electric field using Equation (6).For the next time instant, the value of Φ is replaced in step 2, and the process is repeated.


#### Solution Using FEM (Galerkin Method)

The FEM solution can also be obtained using different approaches.Considering that electric conductivity is isotropic, Equation ( 90) can be represented as a weighted residual as follows:
Ω e w σ ∂A x ∂t + ∂φ ∂x − 1 µ 0 ∇ 2 A x − J s x dV = 0(93)
or
Ω e wσ ∂A x ∂t + wσ ∂φ ∂x − 1 µ 0 w∇ 2 A x − w J s x dV = 0 (94)
which, applying the identity a∇ 2 b = ∇ • (a∇b) − ∇a • ∇b to the third term, becomes:
Ω e wσ ∂A x ∂t + wσ ∂φ ∂x − 1 µ 0 ∇ • w ∇A x + 1 µ 0 ∇A x • ∇w − w J s x dV = 0 (95)
Using the divergence theorem as in the previous sections applied to the third term and rearranging the equation yields:
1 µ 0 Ω e ∇A x • ∇wdV + Ω e wσ ∂A x ∂t + wσ ∂φ ∂x dV − Ω e w J s x dV − 1 µ 0 Γ e w ∇A x • n dS = 0(96)
The potential at any position ((x, y, z) Ω sys ) is computed using the potential at the nodes and the interpolation functions:
A e x (x, y, z) = n n ∑ i=1 (A e x ) i N i (x, y, z) (97a) Φ e (x, y, z) = n n ∑ i=1 (Φ e ) i N i (x, y, z)(97b)
Replacing the weight function, (w) with the interpolation functions in Equation ( 96) and A x , φ with expression (97)  Equation (98) corresponds to one element and can be expanded for the disjoint space using the same procedure explained in the previous two sections, after which the equation system is assembled using the connectivity matrix.The resulting equation system considering all components of A and the potential (Φ) is:
[P + T]A t x + RΦ = −TA t−∆t x − S x (99a) [P + T]A t y + RΦ = −TA t−∆t y − S y (99b) [P + T]A t z + RΦ = −TA t−∆t z − S z(99c)P Φ = −QJ (99d) or [P + T] R 0 P A t Φ = −TA t−∆t − S −QJ (100)
where and
S v = F v + B v for v = {x, y,P ij = −µ o σ i P ij ).

#### Solution of the Darwin Model BVP

It can be seen from Equations (35a) and (35b) or their versions considering the Coulomb gauge that they can be integrated using the procedure explained in the two previous sections by adding a new source term to Equations (34a) and (34b) and considering the change of potential due to the presence of displacement currents in the second equation.Considering the Coulomb gauge and that the electric permittivity ( ) is timeindependent, Equations (35a) and (35b) can be expressed as:
− 1 µ o ∇ 2 A + σ ∂A ∂t + ∇φ + ∇ ∂φ ∂t = J s (101a) ∇ • σ ∂ A ∂t + ∇φ + ∇ • ∇ ∂φ ∂t = ∇ • J s(101b)
where the new source term for the first equation is ∇ ∂φ ∂t , and the new scalar potential term in the second equation is ∇ • ∇ ∂φ ∂t .Equations (101a) and (101b) can be further modified by approximating the scalar potential using a finite difference scheme:
− 1 µ o ∇ 2 A + σ ∂A ∂t + ∇φ t + ∆t ∇φ t − ∆t ∇φ t−∆t = J s (102a) ∇ • σ ∂ A ∂t + ∇φ + ∇ • ∆t ∇φ t − ∇ • ∆t ∇φ t−∆t = ∇ • J s(102b)
The term J dis = ∆t ∇φ t−∆t is a displacement current density that comes from the potential induced in the previous time instant.The term −σ ∂ A ∂t is the conductive current density ( J ind ), which is magnetically induced.Therefore, these equations can be rearranged as:
σ ∂A ∂t − 1 µ o ∇ 2 A + σ + ∆t ∇φ t = J s + J dis (103a) ∇ • σ + ∆t ∇φ t = ∇ • J s + J dis + J ind(103b)
which essentially have the same form as the A-Φ formulation, with an additional current source.Therefore, this equation set can be solved using the finite difference method as described in Section 3.1.


#### Solution of the Darwin Model BVP Using FEM

Houssein Taha [60] proposed the solution of the Darwin model directly using Equations (35a) and (35b) applied to electric machines.However, working with the numerical curl of vectors usually requires a high computational cost if applied to a complex geometry mesh such as the brain cortex.Based on the modification of the equations described in the previous section, the Darwin model for TMS applications can be reduced to a type of Φ-V formulation.Therefore, comparing Equations (34a) and (34b) and their FEM numerical solution (Equation ( 100)) with Equation ( 103), the FEM formulation for the Darwin model can be expressed as:
[P + T] R 0 P A t Φ = −TA t−∆t − S −QJ(104)
where P, T and Q are the same as in the Φ-V formulation solution, and
R ij = β i σ Ω ∂N i ∂x N j dV, where β i σ = σ i + i ∆t
, is constant for the nodes of each element.
P ij = −µ o β i σ P ij , S v = F v + B v for v = {x, y, z}, with F = −(J s + J dis ) Ω N i dV and J = (J s + J dis ).

### Analytical and Semianalytical Solutions

It is clear that it is very difficult-if not impossible-to obtain an analytic solution of the TMS field formulations on realistic brain cortex geometries.However, it is possible to obtain analytic solutions considering simplified geometric models of the excitation coil and the brain.The advantage of these solutions is that they serve as a calibration reference for numerical simulations.Esselle et al. [49] computed the electric field produced by an arbitrarily shaped coil above half-space tissue with a planar interface with the air.The formulation corresponds to the Laplace MQS-φ formulation:
∇ 2 A = −µ o J s , / A ⊂ Ω, ∇ × A Γ = 0 (105a) ∇ 2 φ = 0, / φ ⊂ Ω b , n 1 • J 1Γ = n 2 • J 2Γ(105b)
The solution of the magnetic vector potential generated by a coil formed by N thin wires carrying a current (I) is:
A(r o ) = µ o N I 4π Σ coil 1 |r − r o | d l(106)
The primary electric field can be computed from the magnetic potential vector; therefore:
d E p = − µ o N(dI/dt) 4π|r − r o | d l(107)
The secondary electric field ( E s ) of a coil element (d l) is computed from the scalar potential as:
d E s = − ∇φ = − ∂φ ∂x i − ∂φ ∂y j − ∂φ ∂z k(108)
Consequently, the total electric field of the coil element (d l) is given as:
d E = d E p + d E s = dE x p − ∂φ ∂x i + dE y p − ∂φ ∂y j + dE z p − ∂φ ∂z k(109)
Considering the condition of the continuity of the current in the interfaces, since the electric conductivity of the air is zero, then the current in the air-tissue interface produced by the d l element of the coil perpendicular to the tissue interface is in the z direction; therefore:
J b = σ b d E = σ b d E z = 0 (110) or d E z = 0 (111)
Therefore, it is only necessary to compute dE x and dE y .Furthermore, the boundary condition Equation ( 111) can be used to compute these components.From the boundary condition (d E z = 0), it is deduced that at the interface is z = 0:
− µ o N(dI/dt) 4π|r − r o | dz − ∂φ ∂z = 0(112)
A general solution of the Laplace Equation (105b) can also be expressed as the Bessel integral:
φ = ∞ 0 U(λ)e λz J o (λρ)dλ(113)
where ρ = x 2 + y 2 , and J o is the Bessel function of the first kind.Replacing Equation (113) in Equation ( 112) and also using the expansion of 1 |r−r o | as a function of the Bessel function (J o ), the value of φ is obtained as:
φ = − µ o N(dI/dt) 4π dl z ∞ 0 1 λ e −λ(z o −z) J o (λρ)dλ(114)
This expression is replaced in Equation ( 109) to obtain components dE x and dE y , which are given by:
dE x = dE x p − ∂φ ∂x = − µ o N(dI/dt) 4π dl x R + xdl z ρ 2 1 − z − z o R(115)
and
dE y = dE y p − ∂φ ∂y = − µ o N(dI/dt) 4π dl y R + ydl z ρ 2 1 − z − z o R(116)
The differential of the total electric field is obtained as dE = dE x i + dE y j.

Although the work by Esselle et al. [49] starts from the approximation that the tissue interface is plane, they also conclude that the result was independent of the tissue inhomogeneities inside the tissue half-plane if the conductivity of the inhomogeneous tissue changes perpendicular to the location of the interface.

A more precise geometrical model was used in the H. Eaton model [48], which proposed an analytical expression to compute the electric field and current density induced by a coil inside a homogeneous spherical coil.The author used the Laplace MSQ-V formulation as described in Section 3.3.Therefore, the solution of the magnetic potential vector is given by Equation (36).To analytically integrate this expression, the inverse of the distance term is expanded in terms of spherical harmonics:
1 |r − r o | = 4π ∞ ∑ l=0 l ∑ m=−l r l (2l + 1)r l+1 o Y * lm (θ o , φ o )Y lm (θ, φ), r o > r(117)
where Y lm (θ, φ) represents the spherical harmonic functions, and * indicates a complex conjugate.After replacing this expression in Equation (36), the value of the magnetic potential vector is:
A = µ o I ∞ ∑ l=0 l ∑ m=−l r l (2l + 1) C lm Y lm (θ, φ)(118)
where
C lm = Ω coil Y * lm (θ o , φ o ) r l+1 o d l o(119)
The values of the coefficient ( C lm ) are obtained by dividing the domain (Ω b ) into rectangular components such that:
C lm = C x lm i + C y lm j + C z lm k (120)
Moreover, φ is obtained after integrating the Laplace equation (∇ 2 φ = 0), which is the other equation of the the Laplace MQS-φ formulation, with boundary conditions given by the current continuity Equation (32d) and the electric potential outside the brain (sphere of radius (R)), vanishing (φ = 0) for r → ∞:
φ = ∞ ∑ l=0 l ∑ m=−l (F lm + G lm )Y lm (θ, φ)(121)
where for l > 0 and F oo = 0. Until this point, it is possible to obtain a semianalytical solution of the formulation by numerically integrating Equation (119) and computing A and φ using Equations ( 118) and (121), respectively, and the electric field using Equation (6).However, the authors took a step forward by replacing the analytic expressions with their corresponding spherical harmonic functions and obtaining analytical expressions for the electric field component in spherical coordinates,as described in [48].
G lm = F lm R 2l+1(122)F lm = − jωµ o I[σ + jω( − o )] l(σ + jω ) + jω o (l + 1) (−α lm D l−1,m−1 + β lm E l−1,m+1 + γ lm C z lm )(123

## Implementation of Numerical Solutions


## Review of Solutions and Implementations Presented in the Literature

Table 3 provides a comprehensive overview of the predominant BVPs employed in the simulation of TMS fields.Alongside these BVPs, we present the corresponding Simulation Tools and their respective authors who have utilized them.The term "Direct implementation" pertains to cases where the authors have custom-built their simulation codes using programming languages, tailoring them to the specific requirements of their studies.On the other hand, "Commercial general-purpose software" refers to computer simulation programs, frequently employing the finite element method, capable of simulating various multiphysics problems represented by partial differential equations and boundary conditions.


## Overview of Some of the Main TMS Simulation Results

The effectiveness and applications of TMS depend on several parameters of the coilbrain system, as mentioned in the Introduction.Some analyses using simulation methods have revealed how these parameters influence the electric field acting on the nerves.The use of different formulations, brain models and levels of numerical method precision can also influence the accuracy of estimating the field.A brief overview of some of these results is presented below.

Although it is difficult to establish a level of priority of elements that influence the electric field induced in the brain by TMS and the computation of the actual field distribution in the brain, there seems to be a consensus among works [16,18,[20][21][22][23][24] related to the simulation of the electric field induced by TMS, which analyzed the influence of the coil parameters (geometry, positioning, current waveform, etc.).Their main conclusion is that the adequate selection of these parameters is crucial for inducing the value of the electric field.In other words, the excitation parameters are the most fundamental elements for achieving the necessary value and distribution of the electric field in the brain, and the smallest variation of these parameters could have a significant impact on the excitation field.

Research conducted by Mills [20] demonstrated that the utilization of single coils for the purpose of stimulating long nerves is not advantageous.This is attributed to the presence of "hot spots" within the induced electric field generated by such coils, which possess both positive and negative fields.These hot spots can elicit contradictory effects on the nerve.Additionally, through the simulation of various coil geometries and configurations, Deng [17] established that figure-8-type coils exhibit greater focal properties compared than circular-type coils.None of the simulated coil configurations surpassed the figure-8-type coils in terms of achieving a tradeoff between depth of penetration and focal precision.Furthermore, Deng's research [17] indicated that an increase in the number of coil turns (N) amplifies coil inductance and peak voltage while reducing the necessary peak current.Theoretically, augmenting N enhances the accuracy of field replication, although this is constrained by the coil's dimensional requirements.

The impact of TMS is heavily influenced by the parameters employed for excitation.Specifically, the electric field distribution, which crucial for effective stimulation, may not always achieve the desired level of focus due to the configuration of the excitation coil in TMS.Consequently, achieving highly localized stimulation through the appropriate selection and arrangement of coils can prove challenging for specific applications.In this regard, a novel emerging technique called transcranial ultrasound stimulation (TUS) [101,102] offers several advantages, including the ability to provide highly focused excitation using an ultrasonic transducer.Moreover, the utilization of ultrasonic waves allows for deeper penetration of the stimulus into the brain, enabling access to central brain regions.Nevertheless, despite being considered a safe technique, further research is necessary to establish the long-term safety and potential risks associated with TUS.Additionally, the use of coupling gel is required for excitation in TUS.Furthermore, the indirect mechanism by which ultrasound stimulates neural activity through mechanical oscillations is more intricate compared to the direct electrical stimulation employed by TMS.

In reference to the precision of the estimation of the induced electric field, the accuracy of the coil and current parameters used in the model is very important, as well as an adequate formulation and BVP [20,23,24].In order of significance, the correct assignment of electric conductivity to each point in the brain model [30][31][32][33][34] and the selection of an appropriate numerical method for the simulations [73,90] are the subsequent key factors to be considered.Lastly, there are the details of brain model geometry, provided the use of a basic brain model including most of the fundamental parts (gyrus and sulcus) of the brain is used, although there is no clear consensus about the importance of the later.In this review , the effect of the shape and length of neurons and nerves, [103][104][105] which is also of fundamental importance, is not considered.

Petrov's study [58] reported that in the specific region where neurostimulation is typically performed, spiral wire coil models exhibited higher precision (RE < 5%) in predicting the actual induced field compared to a single circular wire coil model, which deviated from field measurements by up to 10% RE.These findings emphasize the necessity of employing a spiral winding-turns model to accurately approximate the induced field of a typical TMS coil [58].Moreover, the utilization of realistic magnetic resonance imaging (MRI)-derived head models demonstrated that differences in tissue conductivities had a negligible impact on the magnitudes of the electric field (E-field).However, the position and orientation of the coil, as well as the size of the brain, exerted significant effects on the magnitude of the E-field [24].Notably, substantial deviations in E-field magnitude were observed with respect to coil placement when considering the evaluation of effects over a 2 cm range in each direction of a two-dimensional plane of the TMS coil [24].This estimation may be regarded as conservative when assessing the disparity between the scalp location and the intended cortical target.The results highlight the extensive cortical area that may be affected when accounting for this level of positioning uncertainty, encompassing a significant portion of the dorsolateral prefrontal cortex [24].Certainly, it is feasible to reduce this uncertainty within an individual patient by developing reliable coil placement procedures combined with neuronavigation techniques [24,58].

On the other hand, in a recent study [83], it was discovered that the standard deviations in maximum electric field values resulting from uncertainties in tissue conductivities accounted for approximately 5% of the mean value in TMS.Tissue conductivity emerged as the primary factor determining the magnitudes of current density when the displacement current was insignificant [83].Conversely, with the presence of displacement currents, the permittivity became the principal determinant of current density magnitude.Furthermore, the study revealed that the existence of displacement currents could potentially increase the maximum cortical current density by an order of magnitude, assuming the extreme permittivity values reported by certain researchers prove to be accurate [83].Notably, all solutions exhibited currents that were perpendicular to the cortical interface, challenging models that propose preferential stimulation of tangentially oriented neurons based on the assumption that fields normal to the interface are negligible.Consequently, these models warrant re-examination [83].

The impact of brain models on simulation accuracy remains a contentious topic.Salvador et al. [96] demonstrated that the most consistent correspondence between the estimated electric field and motor activation was observed in realistic brain models, specifically in the crown region of the precentral gyrus.Conversely, the use of simplified head models, such as spherical head models, yielded spatially nonspecific findings [96].This study also proposed that the maximum electric field strength serves as the optimal parameter for exploring the applicability of field calculations in quantitative dosing [62,96].However, Janssen et al. [89] showed that in a highly realistic head model, variations in sulcus width (up to 3 mm) did not result in significant differences in the calculated electric field values for most brain areas.Thus, for a global estimation of the electric field, an accurate representation of sulci is of limited importance [89].Nevertheless, considerable overestimation of sulcus width led to an overestimation of local field strength in locations distant from the cortical hot spot.In contrast, Saturnino et al. [85] demonstrated that accurate anatomical representation of tissue boundaries, including sulci, significantly improved the numerical accuracy of TMS field estimation in full-head models and sulcus models.Specifically, the sulcus model highlighted the importance of higher mesh density around highly curved regions of the gray matter/cerebrospinal fluid boundary, where electric potential undergoes rapid changes.This approach helped prevent local simulation errors and emphasized that the under-representation of sulci could lead to substantial errors in the electric field [85].Moreover, modifications to cortical geometry were shown to disrupt stimulating fields, potentially impairing cortex targeting in non-normal populations [83].

Regarding numerical methods employed in simulations, it was found that the finite difference method (FDM) requires high spatial resolution in regular grids or hexahedral meshes to achieve detail comparable to that of tetrahedral meshes.However, this results in a large number of elements, necessitating lengthy computation times and significant computational resources.Therefore, the finite element method (FEM) based on tetrahedral meshes was suggested as better-suited for these calculations [90].


## Conclusions

Herein, we present a survey of the most used formulations, boundary value problems and implementations for the numerical computation of TMS fields.These aspects were analyzed, showing theirs limitations and advantages.The deduction of the formulations from the Maxwell equations and the numerical solution of the corresponding BVP were described in detail.We also induced some numerical solutions not found in the consulted literature, such as finite difference for quasistatic magnetic A-φ and Darwin models and finite element for quasistatic magnetic A-φ and Darwin models using the Galerkin method, as well as their implementation of boundary conditions applied to TMS fields.The aim of the present work was to serve as a guide for reproduction and future implementation of TMS simulations.

Several of the main results deduced from the TMS fields simulations emphasize the importance of the stimulation parameters, in particular, the coil parameters and arrangement, followed by the precision of the specification of the electrical properties of the tissue and details of the brain geometry model.Our literature analysis highlights that the most used approach is the Poisson MQS-φ formulation applied to a model consisting a figure-8-type coil and a brain model.The advantage of this method is that it does not require large computational resources and enables consideration of the effects of the formation of electric charges in the inner interfaces of the brain.In this case, computational resources can also be redirected to increase the detail of the brain model geometry.Laplace MQS approximation requires significantly fewer computational resources.However, apart from its limitation in considering the charges formed at the inner interfaces, it is practically limited in terms of setting the boundary condition in the complex brain-to-air interface, which usually requires an advance graphical interface.The use of commercial software is common practice in the reviewed works.Nevertheless, the use of software has its drawbacks, as it limits the flexibility of connection in the simulated electric field output with the input for neuron equations and models.The use of a direct implementation could solve these limitations, but there is still a considerable range of code implementations and source code styles, which limits the widening of their use.The recent development of TMS custom platforms such as SimNIBS represents a step forward in solving these drawbacks, although the tendency of the development of graphical interfaces that should be mastered could affect the effectiveness of such platforms.In that sense, it may be more useful to work towards the development of flexible toolboxes and libraries for TMS simulations.

## Figure 1 .
1
Figure 1.Domains and domain boundaries for TMS boundary value problems.




1)×n n 0, . . ., 0 , φ e 1 , φ e 2 , φ e 3 , φ e 4 , . . ., φ e n n , 0, . . .




are the components of the primary electric field in the boundary space .




)with α lm = (l+m−1)(l+m) (2l+1)(2l−1) , β lm = (l−m−1)(l−m) (2l+1)(2l−1) , γ lm = (l−m)(l+m) (2l+1)(2l−1) , D lm =




Electric scalar potential vector of element e Φ Electric scalar potential vector for all elements in the domain Γ J k i,j,k Nodal current density with the component k = {x, y, z} J e Current density vector of the element e J Current density vector of all the elements in the domain Γ A k i,j,k Nodal magnetic potential of the component k = {x, y, z} A e Magnetic potential vector for the element e A k Magnetic potential k-component for all elements in the domain Γ


## Table 2 .
2
Studies of TMS numerical simulation-based MQS-φ boundary value problems.
BVPModelPublicationsSeveral coils and coil configurations in an air box[21,50]A coil over a passive cable[42]MQS only E pFigure-8 coil over a tissue planar interface[44]A quasispherical volume conductor and a paired coil[71]

## Table 2 .
2
Cont.
BVPModelPublicationsFigure-8 coil over a realistic brain model[22,56,58,75,79-82,85,87,90-92,94]Poisson MQS-φ



Ω e N i dV and B e x = 1 µ o Ω e Ni ∂Ax ∂x n x + ∂Ax ∂y n y + ∂Ax ∂z n z dV is the boundary condition as in the previous section.
where P e ij = 1 µ o Ω e∂N i ∂x∂N j ∂x + ∂N i ∂y∂N j ∂y + ∂N i ∂z∂N j dz dV, T e ij = − σ e ∆t Ω e N i N j dV, R e ij =σ eΩ e∂N i ∂x N j dV, F e x = −(J s x ) e0(98)
gives: P e (A t x ) e + T e (A t x ) e + R e Φ + T e (A t−∆t x ) e + F e + B e =




z}, J is a row of vectors formed by the values of induced currents for each of the nodes of each element (J i = σ i ∂A i
x ∂t +∂A i y ∂t +∂A i y ∂t

## Table 3 .
3
TMS numerical simulation studies based on different BVPs.
Boundary Value ProblemSimulation ToolTypePublicationsMQS only EpMatlab Equations solved with VAX 750 and Fortran Direct implementation Direct implementation[21] [42]FEM using version 4.7 of SCIRun: A Scien-tific Computing Problem Solving Environ-Custom software[58]ment (SCI), Utah, USALaplace MQS-φFEM model using Matlab and the Get-FEM++ libraryDirect implementation[75,89]Comsol multiphysicsCommercial general purpose soft-ware[96]FEM custom-written Matlab and C++ rou-tines together with Getfem++ functionsDirect implementation[22]FEM softwareUnknown[52]Ansoft finite-element packageCommercial general-purpose soft-ware[97]SimNIBS pipelineOpen-source software for TMS sim-ulation[56,94]Poisson MQS-φSimBio software environmentOpen-source software for TMS sim-ulation[74,81,82]SimNIBSOpen-source software for TMS sim-ulation[78,79,85,93]Matlab and C++Direct implementation[80,90,91]Matlab FDMDirect implementation[92]I-DEAS FEM packageCommercial general-purpose soft-ware[95]MQS A-φFEM implemented by Comsol Multiphysics Eddy current solver from the commercial FEM package Maxwell3D from AnsoftCommercial general-purpose soft-ware Commercial software[39] [53,83,86]Full Maxwell equationsFEM implemented by Comsol MultiphysicsCommercial general-purpose soft-ware[62]
Data Availability Statement: Not applicable.Acknowledgments:The comments provided by the reviewers are deeply appreciated.Funding: This research received no external funding.Institutional Review Board Statement: Not applicable.Informed Consent Statement: Not applicable.Conflicts of Interest:The authors declare no conflict of interest.Abbreviations for Maxwell Equations
Stimulation of the cerebral cortex in the intact human subject. P A Merton, H B Morton, 10.1038/285227a0Nature. 2851980

Non-invasive magnetic stimulation of human motor cortex. A T Barker, R Jalinous, I L Freeston, 10.1016/S0140-6736(85)92413-4Lancet. 11985

Transcranial magnetic stimulation in neurology. M Kobayashi, A Pascual-Leone, 10.1016/S1474-4422(03)00321-1Lancet Neurol. 22003

Transcranial electric and magnetic stimulation: Technique and paradigms. W Paulus, A V Peterchev, M Ridding, Handb. Clin. Neurol. 1162013

Transcranial magnetic stimulation in the treatment of depression. A A Gershon, P N Dannon, L Grunhaus, 10.1176/appi.ajp.160.5.835Am. J. Psychiatry. 1602003

Transcranial magnetic stimulation as a therapeutic tool in psychiatry. W Simons, M Dierick, 10.1080/15622970510029812World J. Biol. Psychiatry. 62005

Transcranial magnetic stimulation and the human brain. M Hallett, 10.1038/35018000Nature. 4062000

Neuropsychiatric applications of transcranial magnetic stimulation: A meta analysis. T Burt, S H Lisanby, H A Sackeim, 10.1017/S1461145702002791Int. J. Neuropsychopharmacol. 52002

Transcranial magnetic stimulation: Applications for neuropsychopharmacology. S Kahkonen, R J Ilmoniemi, 10.1177/0269881104042631J. Psychopharmacol. 182004

A novel monitor for practical brain-computer interface applications based on visual evoked potential. H Maymandi, Perez, J L Benitez, F Gallegos-Funes, J A Perez Benitez, 10.1080/2326263X.2021.1900032Brain-Comput. Interfaces. 82021

Summary of over Fifty Years with Brain-Computer Interfaces-A Review. A Kawala-Sterniuk, N Browarska, A Al-Bakri, M Pelc, J Zygarlicki, M Sidikova, R Martinek, E J Gorzelanczyk, 10.3390/brainsci11010043Brain Sci. 202143

Evaluation of Transcranial Magnetic Stimulation Efficiency in Major Depressive Disorder Patients: A Magnetic Resonance Spectroscopy Study. M F Erbay, E P Zayman, L Erbay, S Ünal, 10.30773/pi.2019.07.17.3Psychiatry Investig. 162019

Redesigning existing transcranial magnetic stimulation coils to reduce energy: Application to low field magnetic stimulation. B Wang, M R Shen, Z.-D Deng, J E Smith, J J Tharayil, C J Gurrey, L J Gomez, A V Peterchev, 10.1088/1741-2552/aaa505J. Neural Eng. 15360222018

Estimation of focus of electric field in an inhomogenous medium exposed by pulsed magnetic field. K Yunokuchi, R Koyoshi, G Wang, T Yoshino, Y Tamari, H Hosaka, M Saito, Proceedings of the IEEE 1st Joint BMES/EMBS Conference Serving Humanity and Advancing Technology. the IEEE 1st Joint BMES/EMBS Conference Serving Humanity and Advancing TechnologyAtlanta, GA, USAOctober 1999

Transcranial magnetic stimulation mapping of the motor cortex in normal subjects. The representation of two intrinsic hand muscles. S A Wilson, G W Thickbroom, F L Mastaglia, 10.1016/0022-510X(93)90102-5J. Neurol. Sci. 1181993

Electric field properties of two commercial Figure-8 coils in TMS: Calculation of focality and efficiency. A Thielscher, T Kammer, 10.1016/j.clinph.2004.02.019Clin. Neurophysiol. 1152004

Electric field depth-focality tradeoff in transcranial magnetic stimulation: Simulation comparison of 50 coil designs. Z.-D Deng, S H Lisanby, A V Peterchev, 10.1016/j.brs.2012.02.005Brain Stimul. 62013

Effects of coil design on delivery of focal magnetic stimulation. L G Cohen, B J Roth, J Nilsson, N Dang, M Panizza, B Inelli, S Friauf, W Hallett, M , 10.1016/0013-4694(90)90113-XElectroencephalogr. Clin. Neurophysiol. 751990Technical considerations

Transcranial magnetic stimulation in heterogeneous brain tissue: Clinical impact on focality, reproducibility and true sham stimulation. N Toschi, T Welt, M Guerrisi, M E Keck, 10.1016/j.jpsychires.2008.04.008J. Psychiatr. Res. 432009

Magnetic brain stimulation with a double coil: The importance of coil orientation. K R Mills, S J Boniface, M Schubert, 10.1016/0168-5597(92)90096-TElectroencephalogr. Clin. Neurophysiol. 851992

Detailed 3D models of the induced electric field of transcranial magnetic stimulation coils. F S Salinas, J L Lancaster, P T Fox, 10.1088/0031-9155/52/10/016Phys. Med. Biol. 522007

Impact of the gyral geometry on the electric field induced by transcranial magnetic stimulation. A Thielscher, A Opitz, M Windhoff, 10.1016/j.neuroimage.2010.07.061Neuroimage. 542010

Scalp position and efficacy of transcranial magnetic stimulation. S Knecht, J Sommer, M Deppe, O Steinstrater, 10.1016/j.clinph.2005.04.016Clin. Neurophysiol. 1162005. 1988-1993

Transcranial magnetic stimulation and the challenge of coil placement: A comparison of conventional and stereotaxic neuronavigational strategies. R Sparing, D Buelte, I G Meister, T Paus, G R Fink, 10.1002/hbm.20360Hum. Brain Mapp. 292008

Influence of pulse sequence, polarity and amplitude on magnetic stimulation of human and porcine peripheral nerve. P J Maccabee, S S Nagarajan, V E Amassian, D M Dur, A Z Szabo, A B Ahad, R Q Cracco, K S Lai, L P Eberle, 10.1111/j.1469-7793.1998.571bb.xJ. Physiol. 5131998

A transcranial magnetic stimulator inducing near-rectangular pulses with controllable pulse width (cTMS). A V Peterchev, R Jalinous, S H Lisanby, 10.1109/TBME.2007.900540IEEE Trans Biomed. Eng. 552008

Effects of pulse width, waveform and current direction in the cortex: A combined cTMS-EEG study. E P Casula, L Rocchi, R Hannah, J C Rothwell, 10.1016/j.brs.2018.04.015Brain Stimul. 112018

Optimal stimulus duration for extracranial cortical stimulation. L A Geddes, 10.1097/00006123-198701000-00023Neurosurgery. 201987

Stimulus waveform influences the efficacy of repetitive transcranial magnetic stimulation. J L Taylor, C K Loo, 10.1016/j.jad.2006.06.027J. Affect. Disord. 972007

Dielectric properties of tissues. K R Foster, H P Schwan, Biological Effects of Electromagnetic Fields. Boca Raton, FL, USACRC Press1996

The specific resistance of biological material: A compendium of data for the biomedical engineer and physiologist. L A Geddes, L E Baker, 10.1007/BF02474537Med. Biol. Eng. 51967

The passive electrical properties of biological systems: Their significance in physiology, biophysics, and biotechnology. R Pethig, D B Kell, 10.1088/0031-9155/32/8/001Phys. Med. Biol. 321987

Interface phenomena and dielectric properties of biological tissue. O G Martinsen, S Grimmes, H P Schwan, Encyclopedia of Surface and Colloid Science. Marcel Dekker; New York, NY, USA2002

The dielectric properties of biological tissues: II. Measurements in the frequency range 10 Hz to 20 GHz. S Gabriel, R Lau, C Gabriel, 10.1088/0031-9155/41/11/002Phys. Med. Biol. 411996

Mechanisms for electrical stimulation of excitable tissue. B J Roth, Crit. Rev. Biomed. Eng. 221994

The Safety of TMS Consensus Group, Safety, ethical considerations, and application guidelines for the use of transcranial magnetic stimulation in clinical practice and research. S Rossi, M Hallett, P M Rossini, A Pascual-Leone, 10.1016/j.clinph.2009.08.016Clin. Neurophysiol. 1202009. 2008-2039

Fundamentals of transcranial electric and magnetic stimulation dose: Definition, selection, and reporting practices. A V Peterchev, T A Wagner, P C Miranda, M A Nitsche, W Paulus, S H Lisanby, A Pascual-Leone, M Bikson, 10.1016/j.brs.2011.10.001Brain Stimul. 52012

The development and modelling of devices and paradigms for transcranial magnetic stimulation. S M Goetz, Z D Deng, 10.1080/09540261.2017.1305949Int. Rev. Psychiatry. 292017

Elucidating the mechanisms and loci of neuronal excitation by transcranial magnetic stimulation using a finite element model of a cortical sulcus. S Silva, P Basser, P Miranda, 10.1016/j.clinph.2008.07.248Clin. Neurophysiol. 1192008

Physical principles for transcranial magnetic stimulation. J Ruohonen, R J Ilmoniemi, Handbook of Transcranial Magnetic Stimulation. Arnold; London, UK2002

Brain stimulation using electromagnetic sources: Theoretical aspects. L Heller, D B Van Hulsteyn, Biophys. J. 631992

A Model of the Stimulation of a nerve fiber by Electromagnetic Induction. B J Roth, P J Basser, 10.1109/10.55662IEEE Trans. Biomed. Eng. 371990

A theoretical calculation of the electric field induced in the cortex during magnetic stimulation. B J Roth, J M Saypol, M Hallett, L G Cohen, 10.1002/mus.880130812Muscle Nerve. 131990

Modeling of magnetic field stimulation of bent neurons. M A Abdeen, M A Stuchly, IEEE Trans. Biomed. Eng. 411994

. J D Jackson, Classical Electrodynamics. 

. John Wiley, & Sons, 2012Hoboken, NJ, USA

. M A Plonus, Applied Electromagnetics. 

. John Wiley, & Sons, 2012Hoboken, NJ, USA

Prediction of magnetically induced electric fields in biological tissue. K Davey, C H Cheng, C M Epstein, 10.1109/10.81560IEEE Trans. Biomed. Eng. 384184221991

Electric field induced in a spherical volume conductor from arbitrary coils: Application to magnetic stimulation and MEG. H Eaton, 10.1007/BF02446182Med. Biol. Eng. Comput. 301992

Neural Stimulation with Magnetic Fields: Analysis of Induced Electric Fields. K P Esselle, M A Stuchly, 10.1109/10.142644IEEE Trans. Biomed. Eng. 391992

Magnetic-stimulation of the motor cortex-Theoretical considerations. F Grandori, P Ravazzani, 10.1109/10.76385IEEE Trans. Biomed. Eng. 381991

Effects of surface boundary on neuronal magnetic stimulation. D Durand, A S Ferguson, T Dalbasti, 10.1109/10.108128IEEE Trans. Biomed. Eng. 371992

Numerical investigation of the electric field distribution induced in the brain by transcranial magnetic stimulation. D H Kim, J K Sykulski, N Loukaides, G E Georghiou, 10.1049/ip-smt:20040861IEE Proc. Sci. Meas. Technol. 1512004

Current density threshold for the stimulation of neurons in the motor cortex area. T Kowalski, J Silny, H Buchner, 10.1002/bem.10036200223

Magnetic stimulation for non-homogeneous biological structures. V T Krasteva, S P Papazov, I K Daskalov, 10.1186/1475-925X-1-3Biomed. Eng. 120023 [CrossRef

The electric field induced in the brain by magnetic stimulation: A 3-D finite-element analysis of the effect of tissue heterogeneity and anisotropy. P C Miranda, M Hallett, P J Basser, 10.1109/TBME.2003.816079IEEE Trans. Biomed. Eng. 502003

Where does TMS stimulate the motor cortex? Combining electrophysiological measurements and realistic field estimates to reveal the affected cortex position. A Bungert, A Antunes, S Espenhahn, A Thielscher, Cereb. Cortex. 272017

Review on biophysical modelling and simulation studies for transcranial magnetic stimulation. J Gomez-Tames, I Laakso, A Hirata, 10.1088/1361-6560/aba40dPhys. Med. Biol. 652020

How much detail is needed in modeling a transcranial magnetic stimulation figure-8 coil: Measurements and brain simulations. P I Petrov, S Mandija, I E Sommer, Van Den, C A Berg, S F Neggers, 10.1371/journal.pone.0178952PLoS ONE. 122017

Computation of transcranial magnetic stimulation electric fields using self-supervised deep learning. H Li, Z.-D Deng, D Oathes, Y Fan, 10.1016/j.neuroimage.2022.119705NeuroImage. 2642022. 119705

Implementation of Darwin's Model by the Finite Element Method in Order to Model Electrical Machines at Intermediate Frequencies. H Taha, 2021Lille, FranceUniversité de LillePh.D. Thesis

Electromagnetics from a quasistatic perspective. J Larsson, 10.1119/1.2397095Am. J. Phys. 752006

Numerical Modelling in Transcranial Magnetic Stimulation. R N B F Salvador, 2009Lisboa, PortugalUniversidade de LisboaPh.D. Thesis

R J Leveque, Finite Methods for Ordinary and Partial Differential Equations: Steady-State and Time-Dependent Problems. Philadelphia, PA, USASociety for Industrial and Applied Mathematics2007

A comparative study of state-of-the-art Poisson solvers for uniform and nonuniform grids in the unit cube. A Gholami, D Malhotra, H Sundar, G Biros, Fmm Fft, Multigrid, 10.1137/15M1010798SIAM J. Sci. Comput. 382016

A reconstruction of the conductive phenomena elicited by transcranial magnetic stimulation in heterogeneous brain tissue. N Toschi, T Welt, M Guerrisi, M E Keck, 10.1016/j.ejmp.2008.01.005Phys. Medica. 242008

An accurate 3-D model for magnetic stimulation of the brain cortex. G Cerri, R D Leo, F Moglie, A Schiavoni, 10.3109/03091909509030264J. Med. Eng. Technol. 191995

An introduction to Computer Simulation. M M Woolfson, G J Pert, 1999Oxford University PressOxford, UK

Introduction to the Finite Element Method in Electromagnetics. A C Polycarpou, Synthesis Lectures on Computational Electromagnetics Series. 

J.-M Jin, The Finite Element Method in Electromagnetics. Hoboken, NJ, USAJohn Wiley & Sons20143rd ed.

Application of the finite-element method to electromagnetic and electrical topics. J P Webb, Rep. Prog. Phys. 581995

Localized stimulation of neural tissues in the brain by means of a paired configuration of time-varying magnetic fields. S Ueno, T Tashiro, K Harada, 10.1063/1.342181J. Appl. Phys. 641988

Analysis of the distribution of currents induced by a changing magnetic field in a volume conductor. N M Branston, P S Tofts, 10.1088/0031-9155/36/2/001Phys. Med. Biol. 361991

Uncertainty quantification in transcranial magnetic stimulation via high dimensional model representation. L J Gomez, A C Yucel, L Hernandez-Garcia, S F Taylor, E Michielssen, 10.1109/TBME.2014.2353993IEEE Trans Biomed. Eng. 622015

Influence of anisotropic electrical conductivity in white matter tissue on the EEG/MEG forward and inverse solution.A high-resolution whole head simulation study. D Güllmar, J Haueisen, J R Reichenbach, 10.1016/j.neuroimage.2010.02.014Neuroimage. 512010

How the brain tissue shapes the electric field induced by transcranial magnetic stimulation. A Opitz, M Windhoff, R M Heidemann, R Turner, A Thielscher, 10.1016/j.neuroimage.2011.06.069NeuroImage. 582011

Numerical Investigation of the Magnetic and Electric Field Distributions Produced by Biconical Transcranial Magnetic Stimulation Coil for Optimal Design. Y X Wu, H Y Yu, Z W Liu, 10.1109/TMAG.2018.2850915IEEE Trans. Magn. 54112018

A model of magnetic stimulation of neocortical neurons. Y Kamitani, V M Bhalodia, Y Kubota, S Shimojo, 10.1016/S0925-2312(01)00447-7Neurocomputing. 382001

Relation between the electric field and activation of cortical neurons in transcranial electrical stimulation. H Seo, S C Jun, 10.1016/j.brs.2018.11.004Brain Stimul. 122019

Neural effects of transcranial magnetic stimulation at the single-cell level. M C Romero, M Davare, M Armendariz, P Janssen, 10.1038/s41467-019-10638-7Nat. Commun. 1026422019CrossRef

Where and what TMS activates: Experiments and modeling. I Laakso, T Murakami, A Hirata, Y Ugawa, 10.1016/j.brs.2017.09.011Brain Stimul. 112018

Simulation of transcranial magnetic stimulation in head model with morphologically-realistic cortical neurons. A S Aberra, B Wang, W M Grill, A V Peterchev, 10.1016/j.brs.2019.10.002Brain Stimul. 132020

Comparative performance of the finite element method and the boundary element fast multipole method for problems mimicking transcranial magnetic stimulation (TMS). A T Htet, G B Saturnino, E H Burnham, G Noetscher, A Nummenmaa, S N Makarov, 10.1088/1741-2552/aafbb9J. Neural. Eng. 162019. 024001

Three-dimensional head model simulation of transcranial magnetic stimulation. T A Wagner, M Zahn, A J Grodzinsky, A P Pascual-Leone, 10.1109/TBME.2004.827925IEEE Trans. Biomed. Eng. 512004

The distribution of induced currents in magnetic stimulation of the nervous system. P S Tofts, Phys. Med. Biol. 351990

Electric field simulations for transcranial brain stimulation using FEM: An efficient implementation and error analysis. G B Saturnino, K H Madsen, A Thielscher, 10.1088/1741-2552/ab41baJ. Neural. Eng. 16660322019

A structurally detailed finite element human head model for simulation of transcranial magnetic stimulation. M Chen, D J Mogul, 10.1016/j.jneumeth.2009.01.010J. Neurosci. Meth. 1792009

A Comparison between an A-V and V Formulation in Transcranial Magnetic Stimulation. B Granula, K Porzig, H Toepfer, M Gacanovic, Proceedings of the 2013 COMSOL Conference. the 2013 COMSOL ConferenceRotterdam, The NetherlandsOctober 2013

A Theoretical Calculation of the Electric Field Induced by Magnetic Stimulation of a Peripheral Nerve. B J Roth, L G Cohen, M Hallett, W Friauf, A P J Basser, 10.1002/mus.880130812Muscle Nerve. 131990

The influence of sulcus width on simulated electric fields induced by transcranial magnetic stimulation. A M Janssen, S M Rampersad, F Lucka, B Lanfer, S Lew, C H Aydin; Wolters, D F Stegeman, T F Oostendorp, 10.1088/0031-9155/58/14/4881Phys. Med. Biol. 582013

Electric Field Calculations in Brain Stimulation Based on Finite Elements: An Optimized Processing Pipeline for the Generation and Usage of Accurate Individual Head Models. M Windhoff, A Opitz, A Thielscher, Hum. Brain Mapp. 342013

Fast multigrid-based computation of the induced electric field for transcranial magnetic stimulation. I Laakso, A Hirata, 10.1088/0031-9155/57/23/7753Phys. Med. Biol. 572012

Numerical Analyses of Transcranial Magnetic Stimulation Based on Individual Brain Models by Using a Scalar-Potential Finite-Difference Method. K Yamamoto, Y Takiyama, Y Saitoh, M Sekino, 10.1109/TMAG.2016.2519443IEEE Trans. Magn. 5272016

Conditions for numerically accurate TMS electric field simulation. L J Gomez, M Dannhauer, L M Koponen, A V Peterchev, 10.1016/j.brs.2019.09.015Brain Stimul. 132020

Field modeling for transcranial magnetic stimulation: A useful tool to understand the physiological effects of TMS?. A Thielscher, A Antunes, G B Saturnino, Proceedings of the 37th Annual International Conference of the IEEE Engineering in Medicine and Biology Society (EMBC). the 37th Annual International Conference of the IEEE Engineering in Medicine and Biology Society (EMBC)Milan, ItalyAugust 2015

A Three-Dimensional Finite Element Method for Computing Magnetically Induced Currents in Tissues. W Wang, S R Eisenberg, IEEE Trans. Magn. 1994, 30, 6

Modeling the electric field induced in a high resolution realistic head model during transcranial current stimulation. R Salvador, A Mekonnen, G Ruffini, P C Miranda, Proceedings of the 2010 Annual International Conference of the IEEE Engineering in Medicine and Biology. the 2010 Annual International Conference of the IEEE Engineering in Medicine and BiologyBuenos Aires, Argentina31 August-4 September 2010

Tissue heterogeneity as a mechanism for localized neural stimulation by applied electric fields. P C Miranda, L Correia, R Salvador, P J Basser, 10.1088/0031-9155/52/18/009Phys. Med. Biol. 522007

A theoretical comparison of electric and magnetic stimulation of the brain. J M Saypol, B J Roth, L G Cohen, M Hallett, 10.1007/BF02584306Ann. Biomed. Eng. 191991

Computation of electric and magnetic stimulation in human head using the 3-D impedance method. M Nadeem, T Thorlin, O Gandhi, M Persson, 10.1109/TBME.2003.813548IEEE Trans. Biomed. Eng. 502003

Rapid computation of TMS-induced E-fields using a dipole-based magnetic stimulation profile approach. M Daneshzanda, S N Makarova, L I N De Lara, B Guerin, J Mcnab, B R Rosen, M S Hamalainen, T Raij, A Nummenmaa, 10.1016/j.neuroimage.2021.118097NeuroImage. 2372021. 1180897

Efects of transcranial focused ultrasound on human primary motor cortex using 7T fMRI: A pilot study. L Ai, P Bansal, J K Mueller, W Legon, 10.1186/s12868-018-0456-6BMC Neurosci. 192018

Antidepressant-Like Effect of Low-Intensity Transcranial Ultrasound Stimulation. D Zhang, H Li, J Sun, W Hu, W Jin, S Li, S Tong, 10.1109/TBME.2018.2845689IEEE Trans. Biomed. Eng. 662019

A generalized cable equation for magnetic stimulation of axons. S S Nagarajan, D M Dur, 10.1109/10.486288IEEE Trans. Biomed. Eng. 431996

Coupling magnetically induced electric fields to neurons: Longitudinal and transverse activation. B Wang, W M Grill, A V Peterchev, 10.1016/j.bpj.2018.06.004Biophys. J. 1152018

Cortical neuron activation induced by electromagnetic stimulation: A quantitative analysis via modeling and simulation. T Wu, J Fan, K S Lee, X Li, 10.1007/s10827-015-0585-1J. Comput. Neurosci. 402016

Disclaimer/Publisher's Note: The statements, opinions and data contained in all publications are solely those of the individual author(s) and contributor(s) and not of MDPI and/or the editor(s). MDPI and/or the editor(s) disclaim responsibility for any injury to people or property resulting from any ideas, methods. instructions or products referred to in the content